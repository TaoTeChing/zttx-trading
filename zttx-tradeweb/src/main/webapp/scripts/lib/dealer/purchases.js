define(function(require,exports,module){var a=require("dialog"),b=require("template"),c=require("pagination"),d=require("setNumber");b.helper("$formatPrice",function(a){return null==a?0:a.toFixed(2)}),b.helper("$formatNumber",function(a){return $.isNumeric(a)?1e4>a?a:a/1e4+"万":void 0==a?0:a}),b.helper("$getImageDomainPathFn",function(a,b,c){return getImageDomainPath(a,b,c)}),b.helper("$handelBate",function(a){return getCharLength(a)>20?trimLongString(a,20):a}),window.quickFormSubmit=function(a,b){$("#addlist-form-quick").append($('<input type="hidden">').attr("name","productsId").val(a)),$("#addlist-form-quick").append($('<input type="hidden">').attr("name","productsType").val(b)).submit()};var e={init:function(a){this.beforeVersion(a),this.initQuickOrder(),this.showOrderDialog()},beforeVersion:function(a){$(document).on("mouseenter mouseleave",".product-item dl",function(a){"mouseenter"==a.type?$(this).find(".item-pic .btn-joinorder:not('.cantuse')").show():"mouseleave"==a.type&&$(this).find(".item-pic .btn-joinorder:not('.cantuse')").hide()}),$("#sel-brands").change(function(a){var b=$.trim($("#sel-brands").val());""==b?($("#sel-category").empty().append('<option value="" selected="selected">全部类别</option>'),renderSelect("#sel-category")):$.post("${ctx}/dealer/shopper/dealsolrConfig/dics",{brandsId:b},function(a){if(126e3==a.code){var b=template.render("category-template",a);$("#category_div span").html("全部类别"),$("#sel-category").empty().append(b)}},"json")});var b=$(".order-bar ul li").click(function(){b.not($(this).addClass("on")).removeClass("on"),"grid"==$(this).data("order")?$(".panel-order").removeClass("panel-list").addClass("panel-grid"):$(".panel-order").removeClass("panel-grid").addClass("panel-list")});window.g_pagination=new c({url:a.url,elem:"#pagination",form:$("#filter-form"),method:a.method||"get",handleData:function(a){var b=template.render("products-template",a);0==a.rows.length?($("#btn-addlist").hide(),$("#product-item").empty().append('<div style="text-align: center" ><img src="'+window.IMAGE_DOMIAN+'/images/common/null.png" /></div>')):($("#product-item").empty().append(b),$("#btn-addlist").show(),$(".js_img_center,.js-img-center").each(function(){$("<span></span>").appendTo($(this))}))}})},initQuickOrder:function(){function a(a){$.post("/dealer/dealerShoper/quickCart",{keyWord:a},function(b){if(126e3==b.code){var c=b.rows;if(c.length>0&&a.length>0){var d=$(".search-result").html("<ul></ul>").show().hover(null,function(){$(this).hide()});for(var e in c){var f=c[e].productId,g=c[e].productNo.replace(new RegExp(a,"gi"),"<b>"+a+"</b> "),h=c[e].isAdd,i=0;c[e].isCredit&&(type=1);var j=$("<li>").appendTo($(d).find("ul")),k=$("<div>").appendTo(j);$(h?'<a href="javascript:void(0)" class="disable">已加入进货单</a>':"<a href=\"javascript:quickFormSubmit('"+f+"','"+i+"')\">加入进货单</a>").appendTo(k),$("<span>").html(g).appendTo(k)}$(d).find("div").hover(function(){$(this).toggleClass("on")})}else $(".search-result").hide()}},"json")}var b=0;$("#key").keyup(function(){clearTimeout(b);var c=$(this).val();c.length>0&&(b=setTimeout(function(){a(c)},618))})},showOrderDialog:function(){var c=this,e=new a({width:540,zIndex:1e3}),f=function(a,c){dialogLoading(function(c){$.ajax({url:"/dealer/dealerShoper/listSkuIds",type:"POST",data:{productId:a},dataType:"json",success:function(a){var d=b.render("joinOrderTpl",a.object);e.set("content",d).show(),c.hide()}})},"正在请求数据请稍后...")};$(document).on("click",".btn-joinorder",function(){var a=$(this).data("product-id"),b=$(this).data("product-type");f(a,b)}),$(document).on("click",".set_comfirm",function(){var a=$("#joinOrderForm").serialize();$.ajax({url:"/dealer/dealerShoper/addCart",type:"POST",data:a,dataType:"json",success:function(a){126e3==a.code?(remind("success","成功加入进货单"),e.hide()):remind("error",a.message)}})}),new d({callback:c._countAllPrice})},_countAllPrice:function(){var a=0,b=0;$("#orderTableBody tr").each(function(){var c=parseFloat($(this).find(".js-xk-price").text()),d=parseFloat($(this).find(".js-sx-price").text()),e=parseInt($(this).find(".num-amount").val())||0;a+=c*e,b+=d*e}),$("#xk_price").text(a.toFixed(2)),$("#sx_price").text(b.toFixed(2))}};module.exports=e});