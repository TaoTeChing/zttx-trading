!function($){function a(a,b,c){var d=parseInt(a.css("top"),10);if("left"==b){var e="-"+this.image_wrapper_height+"px";a.css("top",this.image_wrapper_height+"px")}else{var e=this.image_wrapper_height+"px";a.css("top","-"+this.image_wrapper_height+"px")}return c&&(c.css("bottom","-"+c[0].offsetHeight+"px"),c.animate({bottom:0},2*this.settings.animation_speed)),this.current_description&&this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},2*this.settings.animation_speed),{old_image:{top:e},new_image:{top:d}}}function b(a,b,c){var d=parseInt(a.css("left"),10);if("left"==b){var e="-"+this.image_wrapper_width+"px";a.css("left",this.image_wrapper_width+"px")}else{var e=this.image_wrapper_width+"px";a.css("left","-"+this.image_wrapper_width+"px")}return c&&(c.css("bottom","-"+c[0].offsetHeight+"px"),c.animate({bottom:0},2*this.settings.animation_speed)),this.current_description&&this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},2*this.settings.animation_speed),{old_image:{left:e},new_image:{left:d}}}function c(a,b,c){var d=a.width(),e=a.height(),f=parseInt(a.css("left"),10),g=parseInt(a.css("top"),10);return a.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2}),{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:d,height:e,top:g,left:f}}}function d(a,b,c){return a.css("opacity",0),{old_image:{opacity:0},new_image:{opacity:1}}}function e(a,b,c){return a.css("opacity",0),{old_image:{opacity:0},new_image:{opacity:1},speed:0}}function f(a,b){this.init(a,b)}function g(a,b){this.init(a,b)}$.fn.adGallery=function(a){var b={loader_image:"img/loader.gif",start_at_index:0,description_wrapper:!1,thumb_opacity:.7,animate_first_image:!1,animation_speed:400,width:!1,height:!1,display_next_and_prev:!0,display_back_and_forward:!0,scroll_jump:0,slideshow:{enable:!0,autostart:!1,speed:5e3,start_label:"Start",stop_label:"Stop",stop_on_scroll:!0,countdown_prefix:"(",countdown_sufix:")",onStart:!1,onStop:!1},effect:"slide-hori",enable_keyboard_move:!0,cycle:!0,callbacks:{init:!1,afterImageVisible:!1,beforeImageVisible:!1}},c=$.extend(!1,b,a);a&&a.slideshow&&(c.slideshow=$.extend(!1,b.slideshow,a.slideshow)),c.slideshow.enable||(c.slideshow.autostart=!1);var d=[];return $(this).each(function(){var a=new f(this,c);d[d.length]=a}),d},f.prototype={wrapper:!1,image_wrapper:!1,gallery_info:!1,nav:!1,loader:!1,preloads:!1,thumbs_wrapper:!1,scroll_back:!1,scroll_forward:!1,next_link:!1,prev_link:!1,slideshow:!1,image_wrapper_width:0,image_wrapper_height:0,current_index:0,current_image:!1,current_description:!1,nav_display_width:0,settings:!1,images:!1,in_transition:!1,animations:!1,init:function(a,b){var c=this;this.wrapper=$(a),this.settings=b,this.setupElements(),this.setupAnimations(),this.settings.width?(this.image_wrapper_width=this.settings.width,this.image_wrapper.width(this.settings.width),this.wrapper.width(this.settings.width)):this.image_wrapper_width=this.image_wrapper.width(),this.settings.height?(this.image_wrapper_height=this.settings.height,this.image_wrapper.height(this.settings.height)):this.image_wrapper_height=this.image_wrapper.height(),this.nav_display_width=this.nav.width(),this.current_index=0,this.current_image=!1,this.current_description=!1,this.in_transition=!1,this.findImages(),this.settings.display_next_and_prev&&this.initNextAndPrev();var d=function(a){return c.nextImage(a)};this.slideshow=new g(d,this.settings.slideshow),this.controls.append(this.slideshow.create()),this.settings.slideshow.enable?this.slideshow.enable():this.slideshow.disable(),this.settings.display_back_and_forward&&this.initBackAndForward(),this.settings.enable_keyboard_move&&this.initKeyEvents();var e=parseInt(this.settings.start_at_index,10);window.location.hash&&0===window.location.hash.indexOf("#ad-image")&&(e=window.location.hash.replace(/[^0-9]+/g,""),1*e!=e&&(e=this.settings.start_at_index)),this.loading(!0),this.showImage(e,function(){c.settings.slideshow.autostart&&(c.preloadImage(e+1),c.slideshow.start())}),this.fireCallback(this.settings.callbacks.init)},setupAnimations:function(){this.animations={"slide-vert":a,"slide-hori":b,resize:c,fade:d,none:e}},setupElements:function(){this.controls=this.wrapper.find(".ad-controls"),this.gallery_info=$('<p class="ad-info"></p>'),this.controls.append(this.gallery_info),this.image_wrapper=this.wrapper.find(".ad-image-wrapper"),this.image_wrapper.empty(),this.nav=this.wrapper.find(".ad-nav"),this.thumbs_wrapper=this.nav.find(".ad-thumbs"),this.preloads=$('<div class="ad-preloads"></div>'),this.loader=$('<img class="ad-loader" src="'+this.settings.loader_image+'">'),this.image_wrapper.append(this.loader),this.loader.hide(),$(document.body).append(this.preloads)},loading:function(a){a?this.loader.show():this.loader.hide()},addAnimation:function(a,b){$.isFunction(b)&&(this.animations[a]=b)},findImages:function(){var a=this;this.images=[];var b=0,c=0,d=this.thumbs_wrapper.find("a"),e=d.length;this.settings.thumb_opacity<1&&d.find("img").css("opacity",this.settings.thumb_opacity),d.each(function(d){var e=$(this),f=e.attr("href"),g=e.find("img");a.isImageLoaded(g[0])?(b+=g[0].parentNode.parentNode.offsetWidth,c++):g.load(function(){b+=this.parentNode.parentNode.offsetWidth,c++}),e.addClass("ad-thumb"+d),e.click(function(){return a.showImage(d),a.slideshow.stop(),!1}).hover(function(){!$(this).is(".ad-active")&&a.settings.thumb_opacity<1&&$(this).find("img").fadeTo(300,1),a.preloadImage(d)},function(){!$(this).is(".ad-active")&&a.settings.thumb_opacity<1&&$(this).find("img").fadeTo(300,a.settings.thumb_opacity)});var e=!1;g.data("ad-link")?e=g.data("ad-link"):g.attr("longdesc")&&g.attr("longdesc").length&&(e=g.attr("longdesc"));var h=!1;g.data("ad-desc")?h=g.data("ad-desc"):g.attr("alt")&&g.attr("alt").length&&(h=g.attr("alt"));var i=!1;g.data("ad-title")?i=g.data("ad-title"):g.attr("title")&&g.attr("title").length&&(i=g.attr("title")),a.images[d]={thumb:g.attr("src"),image:f,error:!1,preloaded:!1,desc:h,title:i,size:!1,link:e}});var f=setInterval(function(){if(e==c){b-=100;var d=a.nav.find(".ad-thumb-list");d.css("width",b+"px");for(var g=1,h=d.height();201>g&&(d.css("width",b+g+"px"),h==d.height());)h=d.height(),g++;clearInterval(f)}},100)},initKeyEvents:function(){var a=this;$(document).keydown(function(b){39==b.keyCode?(a.nextImage(),a.slideshow.stop()):37==b.keyCode&&(a.prevImage(),a.slideshow.stop())})},initNextAndPrev:function(){this.next_link=$('<div class="ad-next"><div class="ad-next-image"></div></div>'),this.prev_link=$('<div class="ad-prev"><div class="ad-prev-image"></div></div>'),this.image_wrapper.append(this.next_link),this.image_wrapper.append(this.prev_link);var a=this;this.prev_link.add(this.next_link).mouseover(function(b){$(this).css("height",a.image_wrapper_height),$(this).find("div").show()}).mouseout(function(a){$(this).find("div").hide()}).click(function(){$(this).is(".ad-next")?(a.nextImage(),a.slideshow.stop()):(a.prevImage(),a.slideshow.stop())}).find("div").css("opacity",.7)},initBackAndForward:function(){var a=this;this.scroll_forward=$('<div class="ad-forward"></div>'),this.scroll_back=$('<div class="ad-back"></div>'),this.nav.append(this.scroll_forward),this.nav.prepend(this.scroll_back);var b=0,c=!1;$(this.scroll_back).add(this.scroll_forward).click(function(){var b=a.nav_display_width-50;if(a.settings.scroll_jump>0)var b=a.settings.scroll_jump;if($(this).is(".ad-forward"))var c=a.thumbs_wrapper.scrollLeft()+b;else var c=a.thumbs_wrapper.scrollLeft()-b;return a.settings.slideshow.stop_on_scroll&&a.slideshow.stop(),a.thumbs_wrapper.animate({scrollLeft:c+"px"}),!1}).css("opacity",.6).hover(function(){var d="left";$(this).is(".ad-forward")&&(d="right"),c=setInterval(function(){b++,b>30&&a.settings.slideshow.stop_on_scroll&&a.slideshow.stop();var c=a.thumbs_wrapper.scrollLeft()+1;"left"==d&&(c=a.thumbs_wrapper.scrollLeft()-1),a.thumbs_wrapper.scrollLeft(c)},10),$(this).css("opacity",1)},function(){b=0,clearInterval(c),$(this).css("opacity",.6)})},_afterShow:function(){this.gallery_info.html(this.current_index+1+" / "+this.images.length),this.settings.cycle||(this.prev_link.show().css("height",this.image_wrapper_height),this.next_link.show().css("height",this.image_wrapper_height),this.current_index==this.images.length-1&&this.next_link.hide(),0==this.current_index&&this.prev_link.hide()),this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(a,b){if(b>this.image_wrapper_height){var c=a/b;b=this.image_wrapper_height,a=this.image_wrapper_height*c}if(a>this.image_wrapper_width){var c=b/a;a=this.image_wrapper_width,b=this.image_wrapper_width*c}return{width:a,height:b}},_centerImage:function(a,b,c){if(a.css("top","0px"),c<this.image_wrapper_height){var d=this.image_wrapper_height-c;a.css("top",d/2+"px")}if(a.css("left","0px"),b<this.image_wrapper_width){var d=this.image_wrapper_width-b;a.css("left",d/2+"px")}},_getDescription:function(a){var b=!1;if(a.desc.length||a.title.length){var c="";a.title.length&&(c='<strong class="ad-description-title">'+a.title+"</strong>");var b="";a.desc.length&&(b="<span>"+a.desc+"</span>"),b=$('<p class="ad-image-description">'+c+b+"</p>")}return b},showImage:function(a,b){if(this.images[a]&&!this.in_transition){var c=this,d=this.images[a];this.in_transition=!0,d.preloaded?this._showWhenLoaded(a,b):(this.loading(!0),this.preloadImage(a,function(){c.loading(!1),c._showWhenLoaded(a,b)}))}},_showWhenLoaded:function(a,b){if(this.images[a]){var c=this,d=this.images[a],e=$(document.createElement("div")).addClass("ad-image"),f=$(new Image).attr("src",d.image);if(d.link){var g=$('<a href="'+d.link+'" target="_blank"></a>');g.append(f),e.append(g)}else e.append(f);this.image_wrapper.prepend(e);var h=this._getContainedImageSize(d.size.width,d.size.height);f.attr("width",h.width),f.attr("height",h.height),e.css({width:h.width+"px",height:h.height+"px"}),this._centerImage(e,h.width,h.height);var i=this._getDescription(d,e);if(i)if(this.settings.description_wrapper)this.settings.description_wrapper.append(i);else{e.append(i);var j=h.width-parseInt(i.css("padding-left"),10)-parseInt(i.css("padding-right"),10);i.css("width",j+"px")}this.highLightThumb(this.nav.find(".ad-thumb"+a));var k="right";if(this.current_index<a&&(k="left"),this.fireCallback(this.settings.callbacks.beforeImageVisible),this.current_image||this.settings.animate_first_image){var l=this.settings.animation_speed,m="swing",n=this.animations[this.settings.effect].call(this,e,k,i);if("undefined"!=typeof n.speed&&(l=n.speed),"undefined"!=typeof n.easing&&(m=n.easing),this.current_image){var o=this.current_image,p=this.current_description;o.animate(n.old_image,l,m,function(){o.remove(),p&&p.remove()})}e.animate(n.new_image,l,m,function(){c.current_index=a,c.current_image=e,c.current_description=i,c.in_transition=!1,c._afterShow(),c.fireCallback(b)})}else this.current_index=a,this.current_image=e,c.current_description=i,this.in_transition=!1,c._afterShow(),this.fireCallback(b)}},nextIndex:function(){if(this.current_index==this.images.length-1){if(!this.settings.cycle)return!1;var a=0}else var a=this.current_index+1;return a},nextImage:function(a){var b=this.nextIndex();return b===!1?!1:(this.preloadImage(b+1),this.showImage(b,a),!0)},prevIndex:function(){if(0==this.current_index){if(!this.settings.cycle)return!1;var a=this.images.length-1}else var a=this.current_index-1;return a},prevImage:function(a){var b=this.prevIndex();return b===!1?!1:(this.preloadImage(b-1),this.showImage(b,a),!0)},preloadAll:function(){function a(){c<b.images.length&&(c++,b.preloadImage(c,a))}var b=this,c=0;b.preloadImage(c,a)},preloadImage:function(a,b){if(this.images[a]){var c=this.images[a];if(this.images[a].preloaded)this.fireCallback(b);else{var d=$(new Image);if(d.attr("src",c.image),this.isImageLoaded(d[0]))c.preloaded=!0,c.size={width:d[0].width,height:d[0].height},this.fireCallback(b);else{this.preloads.append(d);var e=this;d.load(function(){c.preloaded=!0,c.size={width:this.width,height:this.height},e.fireCallback(b)}).error(function(){c.error=!0,c.preloaded=!1,c.size=!1})}}}},isImageLoaded:function(a){return"undefined"==typeof a.complete||a.complete?"undefined"!=typeof a.naturalWidth&&0==a.naturalWidth?!1:!0:!1},highLightThumb:function(a){this.thumbs_wrapper.find(".ad-active").removeClass("ad-active"),a.addClass("ad-active"),this.settings.thumb_opacity<1&&(this.thumbs_wrapper.find("a:not(.ad-active) img").fadeTo(300,this.settings.thumb_opacity),a.find("img").fadeTo(300,1));var b=a[0].parentNode.offsetLeft;b-=this.nav_display_width/2-a[0].offsetWidth/2,this.thumbs_wrapper.animate({scrollLeft:b+"px"})},fireCallback:function(a){$.isFunction(a)&&a.call(this)}},g.prototype={start_link:!1,stop_link:!1,countdown:!1,controls:!1,settings:!1,nextimage_callback:!1,enabled:!1,running:!1,countdown_interval:!1,init:function(a,b){this.nextimage_callback=a,this.settings=b},create:function(){this.start_link=$('<span class="ad-slideshow-start">'+this.settings.start_label+"</span>"),this.stop_link=$('<span class="ad-slideshow-stop">'+this.settings.stop_label+"</span>"),this.countdown=$('<span class="ad-slideshow-countdown"></span>'),this.controls=$('<div class="ad-slideshow-controls"></div>'),this.controls.append(this.start_link).append(this.stop_link).append(this.countdown),this.countdown.hide();var a=this;return this.start_link.click(function(){a.start()}),this.stop_link.click(function(){a.stop()}),$(document).keydown(function(b){83==b.keyCode&&(a.running?a.stop():a.start())}),this.controls},disable:function(){this.enabled=!1,this.stop(),this.controls.hide()},enable:function(){this.enabled=!0,this.controls.show()},toggle:function(){this.enabled?this.disable():this.enable()},start:function(){if(this.running||!this.enabled)return!1;return this.running=!0,this.controls.addClass("ad-slideshow-running"),this._next(),this.fireCallback(this.settings.onStart),!0},stop:function(){return this.running?(this.running=!1,this.countdown.hide(),this.controls.removeClass("ad-slideshow-running"),clearInterval(this.countdown_interval),this.fireCallback(this.settings.onStop),!0):!1},_next:function(){var a=this,b=this.settings.countdown_prefix,c=this.settings.countdown_sufix;clearInterval(a.countdown_interval),this.countdown.show().html(b+this.settings.speed/1e3+c);var d=0;this.countdown_interval=setInterval(function(){if(d+=1e3,d>=a.settings.speed){var e=function(){a.running&&a._next(),d=0};a.nextimage_callback(e)||a.stop(),d=0}var f=parseInt(a.countdown.text().replace(/[^0-9]/g,""),10);f--,f>0&&a.countdown.html(b+f+c)},1e3)},fireCallback:function(a){$.isFunction(a)&&a.call(this)}}}(jQuery);