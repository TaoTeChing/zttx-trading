$(function(){$.ajaxSetup({cache:!0}),$.browser.msie6()||$.browser.msie7()?$.getScript("/scripts/market/masonry.min2.js",function(){$(".bricks").masonry({itemSelector:".brick",columnWidth:230,isFitWidth:!0})}):$.getScript("/scripts/market/masonry.min.js",function(){$(".bricks").masonry({itemSelector:".brick",columnWidth:230,isFitWidth:!0})});var a=null,b=0,c=0,d=0;$(".brick:not(.userActive)").click(function(){a=$(this);var e=$(this).attr("data-src"),f=new Image;f.onload=function(){var a=f.width,e=f.height,g=$(window).height(),h=$(window).width();c=f.height,d=f.width,e>g&&(e=f.height=g-20,a=f.width=g*a/c);var i=parseInt(h-a)/2,j=parseInt(g-e)/2;$.browser.msie6()?(b=$("html,body").scrollTop(),$(".photo-modal").css({height:parseInt(g+b)+"px"}),$("html,body").css({overflow:"hidden"}),$(".gamma-nav a").css({top:parseInt(g-100)/2+b+"px"}),$(".close-view").css({top:parseInt(30+b)+"px"}),$(f).css({left:i+"px",top:parseInt(j+b)+"px"})):$(f).css({left:i+"px",top:j+"px"}),$(".photo-modal,.view-content").show()},f.src=e,$(".view-content").append(f)}),$(".gamma-nav a").click(function(){var e=null;if($(this).hasClass("gamma-prev")?(e=a.prev(),e.hasClass("userActive")&&(e=e.prev())):(e=a.next(),e.hasClass("userActive")&&(e=e.next())),0==e.length)return!1;var f=e.attr("data-src"),g=$(window).width(),h=$(window).height();$(".view-content img").fadeOut(300,function(){$(this).remove();var a=new Image;$.browser.msie6()?a.onload=function(){var e=a.width,f=a.height;c=a.height,d=a.width,f>h&&(f=a.height=h-20,e=a.width=h*e/c);var i=parseInt(g-e)/2,j=parseInt(h-f)/2;$(this).animate({left:i+"px",top:parseInt(j+b)+"px"})}:a.onload=function(){var b=a.width,e=a.height;c=a.height,d=a.width,e>h&&(e=a.height=h-20,b=a.width=h*b/c);var f=parseInt(g-b)/2,i=parseInt(h-e)/2;$(this).animate({left:f+"px",top:i+"px"})},a.src=f,$(".view-content").append(a)}),a=e}),$(document).keydown(function(a){if(!$(".view-content").is(":hidden"))switch(a.which){case 37:$(".gamma-prev").click();break;case 39:$(".gamma-next").click();break;case 27:$(".close-view").click()}}),$(window).resize(function(){if(!$(".view-content").is(":hidden")){var a=$(".view-content img"),b=$(window).height(),e=$(window).width();c>b?(a.height(b-20),a.width(b*d/c)):(a.height(c),a.width(d));var f=a[0].height,g=a[0].width;a.stop().animate({left:parseInt(e-g)/2+"px",top:parseInt(b-f)/2+"px"})}}),$(".close-view").click(function(){$(".photo-modal,.view-content").hide(),$(".view-content img").remove(),$.browser.msie6()&&$("html,body").css({overflow:"auto"})}),$(".brick").hover(function(){$(this).hasClass("userActive")||$(this).addClass("hover")},function(){$(this).removeClass("hover")})});