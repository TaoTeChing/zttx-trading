define(function(require,exports,module){var $=require("$"),a=require("carousel"),b=require("popup"),c=require("gallery/lazyLoad/1.0.0/lazyLoad"),d=require("template"),e=require("dialog"),f=require("setNumber");d.helper("$formatPrice",function(a){return a.toFixed(2)});var g={ajaxMethod:function(){window.addCart=function(a,b){$.ajax({url:"/dealer/dealerShoper/productAddCar?csrfToken="+$("input[name=csrfToken]").val(),method:"POST",data:{productId:a,productType:b,skuIds:"",amounts:""},async:!1,dataType:"json",success:function(a){if(126e3==a.code)remind("success","此产品已成功");else if(126013==a.code){var b="?redirect="+encodeURIComponent(location.href);jumpToLogin(b)}else remind("error",a.message)}})},window.addFavorite=function(a){$.ajax({url:"/dealer/dealerFavorite/addFavorite?csrfToken="+$("input[name=csrfToken]").val(),method:"POST",async:!1,data:{productId:a},dataType:"json",success:function(a){if(126e3==a.code)remind("success","已加入收藏夹");else if(126013==a.code){var b="?redirect="+encodeURIComponent(location.href);jumpToLogin(b)}else remind("error",a.message)}})},window.applyJoin=function(a,b){$.ajax({url:"/dealer/joinManage/apply/join?csrfToken="+$("input[name=csrfToken]").val(),method:"POST",async:!1,data:{productId:a,inviteText:"申请加盟",brandsId:b},dataType:"json",success:function(a){if(126e3==a.code)remind("success","已提交加盟申请");else if(126013==a.code){var b="?redirect="+encodeURIComponent(location.href);jumpToLogin(b)}else remind("error",a.message)}})},window.addCollection=function(a){$.ajax({url:"/market/brand/attentionNum/add",method:"GET",async:!1,data:{brandesId:a},dataType:"json",success:function(b){if(126e3==b.code)remind("success","收藏成功"),$("#collect_"+a).html("已收藏");else if(126013==b.code){var c="?redirect="+encodeURIComponent(location.href);jumpToLogin(c)}else remind("error",b.message)}})}},lazyLoad:function(){new c},searchLogic:function(){$("#searchBtn").click(function(){if($("#searchForm").length>0){var a=$("#searchTxt").val();$("#searchFormQ").val(a),$("#searchForm").submit()}else $("#headerSearch").submit();return!1})}},h={init:function(){g.searchLogic(),this.typeMove(),this.banner(),this.goodBrand(),this.hall(),this.news(),g.ajaxMethod()},typeMove:function(){var a=null;$(".type-item").mouseenter(function(){var b=$(this);a=setTimeout(function(){$(".type-item .type-item-sub").removeClass("hover"),b.find(".type-item-sub").addClass("hover"),b.find(".type-item-sub").stop(!1,!1).fadeIn("normal",function(){$(".type-item .type-item-sub").not(b.find(".type-item-sub")).stop(!1,!1).fadeOut()})},328)}),$(".type-item").mouseleave(function(){clearTimeout(a)}),$(".type-box").mouseleave(function(){setTimeout(function(){$(".type-item .type-item-sub").stop().fadeOut()},328)})},banner:function(){$("#focus").length>0&&new a({element:"#focus",panels:"#focus .ts-banner-item",effect:"fade",prevBtn:$("#focus").find(".prev"),nextBtn:$("#focus").find(".next"),autoplay:!0}),$("#brand-list-con .brand-list-item").length>0&&new a({element:"#brand-list-con",panels:"#brand-list-con .brand-list-item",effect:"scrollx",prevBtn:".brand-list .prev",nextBtn:".brand-list .next",step:5,autoplay:!0,circular:!1,interval:5400}),$("#card-hd").length>0},cardTab:function(){$("#card-tab li").hover(function(){var a=$(this).index();$("#card-tab li").removeClass("current").eq(a).addClass("current"),$("#card-tab-content .card-news").hide().eq(a).show()})},goodBrand:function(){},hall:function(){$(".hall-focus").length>0&&($(".hall-focus").each(function(){$(this).find(".hall-focus-list").length>0&&new a({element:$(this).find(".hall-focus-content"),panels:$(this).find(".hall-focus-list"),effect:"fade",prevBtn:$(this).find(".prev"),nextBtn:$(this).find(".next"),autoplay:!0})}),$(".hall-focus,.focus").hover(function(){$(this).find(".prev").stop().animate({left:0},128),$(this).find(".next").stop().animate({right:0},128)},function(){$(this).find(".prev").stop().animate({left:-30},128),$(this).find(".next").stop().animate({right:-30},128)}))},news:function(){$("#news-pic").length>0&&new a({element:"#news-pic",panels:"#news-pic .news-pic-item",effect:"fade",viewSize:[365,250],autoplay:!0})}},i={init:function(){this.selectOperation(),this.removeResults(),this.listImgHover(),this.controlBrandMore(),this.delaySetPrice(),g.searchLogic(),g.lazyLoad(),this.joinShopSku()},selectOperation:function(){var a=!1,c=!0,d='收起<i class="icon-close"></i>',e='更多<i class="icon-close-down"></i>',f='显示筛选<i class="icon-close-down"></i>',g='收起筛选<i class="icon-close"></i>';$(".js-slide-filter").click(function(){$(this).find(".icon-close").length>0?($(".m-brand").stop().fadeOut("fast"),$(".m-cates").stop().fadeOut("fast"),$(".js-slide-filter").html(f)):($(".m-brand").stop().fadeIn("fast"),$(".m-cates").stop().fadeIn("fast"),$(".js-slide-filter").html(g))}),$("#select_duo").click(function(){$(this).hide(),$("#brand_btns").show(),a=!0}),$("#select_more").click(function(){c?($("#selected_brand").css("height","auto"),$(this).html(d),c=!1):($("#selected_brand").css("height",52),$(this).html(e),c=!0)}),$(".brand_btns_cancel").click(function(){$("#select_duo").show(),$("#brand_search").hide(),$("#brand_btns").hide(),$("#selected_brand").css("height",52),$("#select_more").html(e),$("#brand_list li .hover").remove(),$("#brand_list li .selected").remove(),$(".brand_btns_confirm").addClass("disabled"),a=!1,c=!0}),$(".brand_btns_confirm").click(function(){if(!$(this).hasClass("disabled")){var a="";$("#selected_brand li.current").each(function(){var b=$(this).find("a").data("cache");a+=""===a?b:","+b}),$("input[name=brandsId]").val(a),$("#currentPage").val("1"),$("#searchForm").submit()}}),$("#brand_list li").hover(function(){var a=$(this).find(".hover"),b=a.length;if(0>=b){var c=trimLongString($(this).find("a").attr("title"),100)||"null",d=$('<span class="hover" title="'+c+'">'+c+"</span>");$(this).append(d)}else a.show()},function(){$(this).find(".hover").hide()}),$(".js-cates-more").click(function(){var a=$(this).parents(".m-mod");a.hasClass("mod-height")?(a.removeClass("mod-height"),$(this).html(d)):(a.addClass("mod-height"),$(this).html(e))}),$("#brand_list li").click(function(){if(a){var b=($(this).find(".hover"),$(this).find(".selected")),c=$('<span class="selected"></span>');b.length<=0?($(this).addClass("current"),$(this).append(c)):($(this).removeClass("current"),b.remove()),$("#brand_list .selected").length>0?$(".brand_btns_confirm").removeClass("disabled"):$(".brand_btns_confirm").addClass("disabled")}else{var d=$(this).find("a").data("cache");$("input[name=brandsId]").val(d),$("#currentPage").val("1"),$("#searchForm").submit()}});for(var h="cate,dealId filter,skuColor,skuSize,otherAttr".split(" "),i=h.length,j=0;i>j;j++)!function(a){var b=h[a].split(",");"filter"===b[0]?$("#selected_"+b[0]+" li a").click(function(){var a=$(this).data("cache"),c=$(this).parents("li").index()+1;return a&&($("input[name="+b[c]+"]").val(a),$("#searchForm").submit()),!1}):$("#selected_"+b[0]+" .list a").click(function(){var a=$(this).data("cache");return $("input[name="+b[1]+"]").val(a),$("#currentPage").val("1"),$("#searchForm").submit(),!1})}(j);$("#sort_price").length>0&&new b({trigger:"#sort_price",element:"#sort_price_pop",align:{baseXY:[0,0]}}),$(".m-filter li.m-f-1").not("#sort_price").click(function(){var a=$(this).find("a").data("type");$("input[name=sorts]").val(a),$("input[name=orderBy]").val("desc"),$("#searchForm").submit()}),$(".m-recom label input").click(function(){var a=$(this).data("type"),b=this.checked;switch(a){case 0:$("input[name=recom]").val(b);break;case 1:$("input[name=samples]").val(b);break;case 2:$("input[name=authorize]").val(b);break;case 3:$("input[name=credit]").val(b)}$("#searchForm").submit()}),$("#change_st a").click(function(){var a=$(this).data("type");$("input[name=st]").val(a),$("#currentPage").val("1"),$("#searchForm").submit()})},removeResults:function(){for(var a=["remove_q","remove_brandsId","remove_dealId"],b=0;b<a.length;b++)!function(b){var c=a[b].split("_")[1];$("."+a[b]).click(function(){$("input[name="+c+"]").val(""),$("#searchForm").submit()})}(b)},listImgHover:function(){$(".m-list li").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})},controlBrandMore:function(){var a=$("#selected_brand li");a.length<10&&$("#more1").hide();var b=$("#selected_cate .list").height();40>=b&&$("#more2").hide()},delaySetPrice:function(){var a=$("#product_list li").length,b=[],c=10,e=a%c>0?a/c+1:a/c;$("#product_list li").each(function(a){var c=$(this).data("refrenceid");b.push(c)});for(var f=0;e>f;f++)!function(){$.ajax({url:"/getAuthPrice",type:"post",data:{productIds:b.splice(0,10).toString()},dataType:"json",success:function(a){if(a.rows&&a.rows.length>0)for(var b=0;b<a.rows.length;b++){var c=a.rows[b].productId,e=d.render("join_tpl",a.rows[b]),f=d.render("price_tpl",a.rows[b]);$("#operate_"+c).append(e),$("#price_"+c).html(f)}}})}(f);g.ajaxMethod()},joinShopSku:function(){function a(){var a=0,b=0;$("#orderTableBody tr").each(function(){var c=parseFloat($(this).find(".js-xk-price").text()),d=parseFloat($(this).find(".js-sx-price").text()),e=parseInt($(this).find(".num-amount").val())||0;a+=c*e,b+=d*e}),$("#xk_price").text(a.toFixed(2)),$("#sx_price").text(b.toFixed(2))}if($("#joinOrderTpl").length<=0)return!1;var b=new e({width:500,content:$("#joinOrderTpl").html()});window.joinShop=function(a,c){$.ajax({url:"/dealer/dealerShoper/listSkuIds?csrfToken="+$("input[name=csrfToken]").val(),method:"POST",async:!1,data:{productId:a},dataType:"json",success:function(a){if(126013==a.code){var c=location.href;location.href="/common/login?loginType=1&redirect="+encodeURIComponent(c)}else if(126e3==a.code){var e=d.render("joinOrderTpl",a.object);b.set("content",e).show(),b.show()}else remind("error",a.message)}})},$(document).on("click",".set_comfirm",function(){var a=$("#joinOrderForm").serialize();$.ajax({url:"/dealer/dealerShoper/addCart?"+a+"&csrfToken="+$("input[name=csrfToken]").val(),method:"POST",dataType:"JSON",success:function(a){126e3==a.code?(remind("success","成功加入进货单"),b.hide()):remind("error",a.message)}})}),new f({callback:a})}};return{index:h,index_product_list:i}});