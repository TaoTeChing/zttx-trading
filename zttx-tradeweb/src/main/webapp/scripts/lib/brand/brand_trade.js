var TradePurorder={init:function(){this.initCalendar(),this.tabsMenu(),this.extensionTime(),this.updateCash(),this.handleRemark(),this.closeTrade(),this.sendMessage(),this.remindDealer(),this.handleShipping()},tabsMenu:function(){var a=$("div.js_trador_menu ul li");a.click(function(){$(this).addClass("selected").siblings().removeClass("selected");var b=a.index(this);$("div.js_trador_con > div.js_trador_conbox").eq(b).show().siblings().hide()})},initCalendar:function(){$("#start-cal").length>0&&$("#end-cal").length>0&&rangeCalendar("start-cal","end-cal")},extensionTimeFn:function(a,b){b.hide()},extensionTime:function(){var a=this,b=null,c=0,d="";seajs.use(["dialog","template"],function(a,e){b=new a({content:$("#extension_tpl").html(),width:256}).after("show",function(){c||($(".extension_select").SelectBox(),console.log(c)),c++}),$(document).on("click",".js_extension_time",function(){var a=this;b.before("show",function(){var b=$(a);d=b.data("orderid")}),b.after("show",function(){var b=($(a),$(a).parents(".orderbox").find('input[name="outActTime"]').val());if(!b||""!=b){var c="收货期限:   "+b+"点之前";$(".qixian_text").text(c)}}),b.show()})}),$(document).on("click",".extension_dialog .confirm_btn",function(){a.extensionTimeFn(d,b)}),$(document).on("click",".extension_dialog .cancel_btn",function(){b.hide()})},beforeUpdatePop:function(a,b){},confirmUpdatePop:function(a,b,c,d){c.hide()},updateCash:function(){var a,b,c=null,d=this,e="",f="",g="",h=1;seajs.use(["dialog","template"],function(a,i){i.helper("$formatNumber",function(a){return isNaN(a)?a:parseFloat(a).toFixed(2)}),c=new a({width:726}).after("show",function(){$(".discount,.wuliuprice,.nprice").isPrice(),$("#privilege_select").SelectBox(),d.beforeUpdatePop(e,g),1==$("#privilege_select").val()&&(h=-1)}),$(document).on("click",".js_update_cash",function(){var a=this;c.before("show",function(){var c=$(a);e=c.data("orderid"),brandsId=c.data("brandsid"),f=c.data("ordertype"),g=c.data("type"),b=c.attr("data-payState");var d=c.parents("tr"),h=d.find(".product_info").html(),j=d.find(".product_num").html(),k=d.find(".product_price").html(),l=d.find(".brand_name").html(),m=d.parents(".orderbox"),n=m.find('[name="adjustFreight"]').val(),o=n;n=""==n?"0.00":n;var p=m.find('[name="adjustPrice"]').val(),q=Math.abs(m.find('[name="adjustPrice"]').val()).toFixed(2),r={};"price"==g?r={type:"price",title:"修改金额",info:h,brand:l,num:j,price:parseFloat(k).toFixed(2),totalprice:(parseFloat(k)+parseFloat(p)+parseFloat(n)).toFixed(2),oldAdjustPrice:p,adjustPrice:q,address:$.trim(m.find('[name="address"]').val()),adjustFreight:n,oldAdjustFreight:o,dealerOrderType:f}:"fare"==g&&(r={type:"fare",title:"修改运费",info:h,brand:l,num:j,price:parseFloat(k).toFixed(2),discount:function(){if(p>0)return"";if(0==p)return 0;var a=(parseFloat(k)+parseFloat(p))/k*10;return a.toFixed(2)}(),totalprice:(parseFloat(k)+parseFloat(p)+parseFloat(n)).toFixed(2),oldAdjustPrice:p,adjustFreight:n,adjustPrice:q,payState:b,address:$.trim(m.find('[name="address"]').val()),oldAdjustFreight:o,dealerOrderType:f});var s=i.render("update_cash_tpl",r);this.element.html(s)}),c.show()})}),$(document).on("click",".cash_info .free_shipping",function(){$(".wuliuprice").val("0"),$(".wuliuprice").trigger("keyup"),d.handleShippingFn}),$(document).on("click",".cash_info .confirm",function(){d.confirmUpdatePop(e,g,c,a,b,brandsId)}),$(document).on("click",".cash_info .cancel",function(){c.hide()}),$(document).on("click","#privilege_select",function(){var a=this;h=1==$(this).val()?-1:1,-1==h?$("#updatePrice .discount").attr("readonly","readonly"):$("#updatePrice .discount").removeAttr("readonly"),$(".cash_info .symbol").html(function(){return 1==$(a).val()?"+":"-"}),$(".cash_info .symbol").html(function(){return 1==$(a).val()?"+":"-"}),$(".cash_info .symbol_text").html(function(){return 1==$(a).val()?"加价":"优惠"});var b=parseFloat($(".cash_info .price").html()),c=parseFloat($(".cash_info .total_discount").html()),d=parseFloat($(".cash_info .total_wuliu").html()),e=$(".cash_info .total_price");e.html(parseFloat(b-c*h+d).toFixed(2))}),$(document).on("change","#privilege_select",function(){$(".discount").val("")}),$(document).on("keyup keydown",".discount,.wuliuprice,.nprice",function(b){"13"==b.keyCode&&b.preventDefault();var c=$(b.target).hasClass("discount"),d=$(b.target).hasClass("nprice"),e=$(this).parents("tr"),f=parseFloat(e.find(".yprice").html()),g=e.find(".nprice");a=e.find(".discount").val();var i=e.find(".wuliuprice"),j=$(".cash_info .total_discount"),k=$(".cash_info .price"),l=$(".cash_info .total_price"),m=$(".cash_info .total_wuliu"),n=0;if(j.html("0"),d&&e.find(".discount").val(""),!isNaN($.trim(a))&&""!=a&&c){var o=0;0!=a&&(o=f*a/10-f),n=Math.abs(o).toFixed(2),g.val(n),j.html(n)}if(!isNaN(g.val())&&""!=g.val()){var p=parseFloat(g.val());n=p,j.html(p)}""==a&&""==g.val()&&(n=0,j.html(0)),""==m.html()&&m.html("0"),isNaN(i.val())||""==i.val()||m.html(parseFloat(i.val()).toFixed(2)),""==i.val()&&m.html("0"),k=parseFloat(k.html()),m=parseFloat(m.html()),l.html(parseFloat(k-n*h+m).toFixed(2))})},handleRemarkFn:function(a,b,c){console.log(b)},handleRemark:function(){function a(a){c.set("content",a),c.show()}var b=this,c=null,d=null,e=[];seajs.use(["popup","template","dialog"],function(f,g,h){c=new h({width:500}),$(document).on("click",".remarks",function(){var b=$(this).data("id"),c=$(this).data("colorindex"),f=$(this).data("text"),h=$(this).parents(".orderbox"),i=h.find('[name="refrenceId"]').val();e=[],e.push(i);var j={id:b,colorIndex:c,text:f},k=g.render("dialogRemark",j);a(k),d=$(this)}),$(".batch_remark").on("click",function(){var b=$(".orderbox .js_chk:checked").length;if(e=[],b>0){$(".orderbox .js_chk:checked").each(function(){var a=$(this).parents(".orderbox"),b=a.find('[name="refrenceId"]').val();e.push(b)});var c={id:"batch"},d=g.render("dialogRemark",c);a(d)}else alert("请先选择交易的订单")}),$(document).on("click",".remark_pop .update_btn",function(){var b=$(this).data("id"),c=$(this).data("colorindex"),d=$(this).data("text"),e={id:b,colorIndex:c,text:d},f=g.render("dialogRemark",e);a(f)}),$(document).on("click",".remark_dialog .confirm_btn",function(){b.handleRemarkFn(d,e,c)}),$(document).on("click",".remark_dialog .cancel_btn",function(){c.hide()})})},closeTradeFn:function(a,b,c,d){alert(a)},closeTrade:function(){var a=this,b=null,c=0,d="",e="",f="";seajs.use(["dialog"],function(a){b=new a({content:$("#closePanel_tpl").html(),width:455}).after("show",function(){c||$(".reason-select").SelectBox(),c++})}),$(document).on("click",".js_close_order",function(){var a=this;b.before("show",function(){var b=$(a);d=b.data("orderid"),b.data("brandsid")&&(e=b.data("brandsid")),b.data("brandsname")&&(f=b.data("brandsname"))}),b.show()}),$(document).on("click",".closePanel .confirm_btn",function(){a.closeTradeFn(d,b,e,f)}),$(document).on("click",".closePanel .cancel_btn",function(){b.hide()})},sendMessageFn:function(a,b,c){alert("发送")},sendMessage:function(){var a=this,b=null,c="",d="";seajs.use(["dialog"],function(a){b=new a({content:$("#message_tpl").html(),width:300})}),$(document).on("click",".js_message",function(){var a=this;b.before("show",function(){var b=$(a);d=b.data("dealerid"),c=b.data("name")}),b.show()}),$(document).on("click",".message_dialog .cancel_btn",function(){b.hide()}),$(document).on("click",".message_dialog .confirm_btn",function(){a.sendMessageFn(d,c,b)})},remindDealer:function(){$(document).on("click",".js_remind_dealer",function(){remind("success","提醒已发送")})},handleShippingFn:function(a,b){console.log(a),b.hide()},handleShipping:function(){var a=this;$(".betch_freeshipping").on("click",function(){var b=$(".orderbox .js_chk:checked").length,c=[];b>0?($(".orderbox .js_chk:checked").each(function(){var a=$(this).parents(".orderbox"),b=a.find('[name="refrenceId"]').val();c.push(b)}),confirmDialog("是否免邮",function(b){a.handleShippingFn(c,b)},"false")):alert("请先选择交易的订单")})},handleAddressFn:function(a,b,c){a.hide()},handleAddress:function(){var a=this,b=null;seajs.use(["dialog"],function(a){b=new a({content:"#updateAddress_tpl",width:720})}),$(document).on("click",".js_updateAddress",function(){var c=this;b.before("show",function(){var a=$(c);orderId=a.data("orderid")}),b.after("show",function(){$("#updateAddress_tpl").show()}),b.show(),$(document).on("click",".updateAddress_dialog .cancel_btn",function(){b.hide()}),$(document).on("click",".updateAddress_dialog .confirm_btn",function(){a.handleAddressFn(b,orderId)});var d=$(this).data("areano"),e=1e4*parseInt(d/1e4),f=100*parseInt(d/100);selProCity($("#addressprovince"),$("#addresscity"),$("#addresscounty"),e,f,d),renderSelect(["#addressprovince","#addresscity","#addresscounty"])})}};