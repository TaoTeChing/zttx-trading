define(function(n){function h(n,t,i){var r;return t=t.toLowerCase(),(r=n.__allListeners||i&&(n.__allListeners={}))&&(r[t]||i&&(r[t]=[]))}var l=$=n("$"),o,v,y,p;UMEDITOR_CONFIG=window.UMEDITOR_CONFIG||{};window.UM={plugins:{},commands:{},I18N:{},version:"1.0.0"};var f=UM.dom={},i=UM.browser=function(){var i=navigator.userAgent.toLowerCase(),u=window.opera,n={ie:!!window.ActiveXObject,opera:!!u&&u.version,webkit:i.indexOf(" applewebkit/")>-1,mac:i.indexOf("macintosh")>-1,quirks:document.compatMode=="BackCompat"},t,r;return n.gecko=navigator.product=="Gecko"&&!n.webkit&&!n.opera,t=0,n.ie&&(t=parseFloat(i.match(/msie (\d+)/)[1]),n.ie9Compat=document.documentMode==9,n.ie8=!!document.documentMode,n.ie8Compat=document.documentMode==8,n.ie7Compat=t==7&&!document.documentMode||document.documentMode==7,n.ie6Compat=t<7||n.quirks,n.ie9above=t>8,n.ie9below=t<9),n.gecko&&(r=i.match(/rv:([\d\.]+)/),r&&(r=r[1].split("."),t=r[0]*1e4+(r[1]||0)*100+(r[2]||0)*1)),/chrome\/(\d+\.\d)/i.test(i)&&(n.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(i)&&!/chrome/i.test(i)&&(n.safari=+(RegExp.$1||RegExp.$2)),n.opera&&(t=parseFloat(u.version())),n.webkit&&(t=parseFloat(i.match(/ applewebkit\/(\d+)/)[1])),n.version=t,n.isCompatible=!n.mobile&&(n.ie&&t>=6||n.gecko&&t>=10801||n.opera&&t>=9.5||n.air&&t>=1||n.webkit&&t>=522||!1),n}(),e=i.ie,w=i.webkit,b=i.gecko,k=i.opera,r=UM.utils={each:function(n,t,i){var r,f,u;if(n!=null)if(n.length===+n.length){for(r=0,f=n.length;r<f;r++)if(t.call(i,n[r],r,n)===!1)return!1}else for(u in n)if(n.hasOwnProperty(u)&&t.call(i,n[u],u,n)===!1)return!1},makeInstance:function(n){var t=new Function;return t.prototype=n,n=new t,t.prototype=null,n},extend:function(n,t,i){if(t)for(var r in t)i&&n.hasOwnProperty(r)||(n[r]=t[r]);return n},extend2:function(n){for(var r,t,u=arguments,i=1;i<u.length;i++){r=u[i];for(t in r)n.hasOwnProperty(t)||(n[t]=r[t])}return n},inherits:function(n,t){var u=n.prototype,i=r.makeInstance(t.prototype);return r.extend(i,u,!0),n.prototype=i,i.constructor=n},bind:function(n,t){return function(){return n.apply(t,arguments)}},defer:function(n,t,i){var r;return function(){i&&clearTimeout(r);r=setTimeout(n,t)}},indexOf:function(n,t,i){var r=-1;return i=this.isNumber(i)?i:0,this.each(n,function(n,u){if(u>=i&&n===t)return r=u,!1}),r},removeItem:function(n,t){for(var i=0,r=n.length;i<r;i++)n[i]===t&&(n.splice(i,1),i--)},trim:function(n){return n.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(n){if(!n)return{};n=r.isArray(n)?n:n.split(",");for(var u=0,t,i={};t=n[u++];)i[t.toUpperCase()]=i[t]=1;return i},unhtml:function(n,t){return n?n.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(n,t){return t?n:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[n]}):""},html:function(n){return n?n.replace(/&((g|l|quo)t|amp|#39);/g,function(n){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[n]}):""},cssStyleToDomStyle:function(){var n=document.createElement("div").style,t={float:n.cssFloat!=undefined?"cssFloat":n.styleFloat!=undefined?"styleFloat":"float"};return function(n){return t[n]||(t[n]=n.toLowerCase().replace(/-./g,function(n){return n.charAt(1).toUpperCase()}))}}(),loadFile:function(){function t(t,i){try{for(var u=0,r;r=n[u++];)if(r.doc===t&&r.url==(i.src||i.href))return r}catch(f){return null}}var n=[];return function(i,r,u){var e=t(i,r),s,f,o;if(e){e.ready?u&&u():e.funs.push(u);return}if(n.push({doc:i,url:r.src||r.href,funs:[u]}),!i.body){s=[];for(o in r)o!="tag"&&s.push(o+'="'+r[o]+'"');i.write("<"+r.tag+" "+s.join(" ")+" ><\/"+r.tag+">");return}if(!r.id||!i.getElementById(r.id)){f=i.createElement(r.tag);delete r.tag;for(o in r)f.setAttribute(o,r[o]);f.onload=f.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(e=t(i,r),e.funs.length>0){e.ready=1;for(var n;n=e.funs.pop();)n()}f.onload=f.onreadystatechange=null}};f.onerror=function(){throw Error("The load "+(r.href||r.src)+" fails,check the url settings of file umeditor.config.js ");};i.getElementsByTagName("head")[0].appendChild(f)}}}(),isEmptyObject:function(n){if(n==null)return!0;if(this.isArray(n)||this.isString(n))return n.length===0;for(var t in n)if(n.hasOwnProperty(t))return!1;return!0},fixColor:function(n,t){var r,u,i;if(/color/i.test(n)&&/rgba?/.test(t)){if(r=t.split(","),r.length>3)return"";for(t="#",u=0;i=r[u++];)i=parseInt(i.replace(/[^\d]/gi,""),10).toString(16),t+=i.length==1?"0"+i:i;t=t.toUpperCase()}return t},clone:function(n,t){var u,i;t=t||{};for(i in n)n.hasOwnProperty(i)&&(u=n[i],typeof u=="object"?(t[i]=r.isArray(u)?[]:{},r.clone(n[i],t[i])):t[i]=u);return t},transUnitToPx:function(n){if(!/(pt|cm)/.test(n))return n;var t;n.replace(/([\d.]+)(\w+)/,function(i,r,u){n=r;t=u});switch(t){case"cm":n=parseFloat(n)*25;break;case"pt":n=Math.round(parseFloat(n)*96/72)}return n+(n?"px":"")},domReady:function(){function n(n){n.isReady=!0;for(var i;i=t.pop();i());}var t=[];return function(r,u){u=u||window;var f=u.document;r&&t.push(r);f.readyState==="complete"?n(f):(f.isReady&&n(f),i.ie?(function(){if(!f.isReady){try{f.documentElement.doScroll("left")}catch(t){setTimeout(arguments.callee,0);return}n(f)}}(),u.attachEvent("onload",function(){n(f)})):(f.addEventListener("DOMContentLoaded",function(){f.removeEventListener("DOMContentLoaded",arguments.callee,!1);n(f)},!1),u.addEventListener("load",function(){n(f)},!1)))}}(),cssRule:i.ie?function(n,t,i){var r,f,u;if(i=i||document,r=i.indexList?i.indexList:i.indexList={},r[n])u=i.styleSheets[r[n]];else{if(t===undefined)return"";u=i.createStyleSheet("",f=i.styleSheets.length);r[n]=f}if(t===undefined)return u.cssText;u.cssText=t||""}:function(n,t,i){i=i||document;var u=i.getElementsByTagName("head")[0],r;if(!(r=i.getElementById(n))){if(t===undefined)return"";r=i.createElement("style");r.id=n;u.appendChild(r)}if(t===undefined)return r.innerHTML;t!==""?r.innerHTML=t:u.removeChild(r)}};r.each(["String","Function","Array","Number","RegExp","Object"],function(n){UM.utils["is"+n]=function(t){return Object.prototype.toString.apply(t)=="[object "+n+"]"}});o=UM.EventBase=function(){};o.prototype={addListener:function(n,t){n=r.trim(n).split(" ");for(var u=0,i;i=n[u++];)h(this,i,!0).push(t)},removeListener:function(n,t){n=r.trim(n).split(" ");for(var u=0,i;i=n[u++];)r.removeItem(h(this,i)||[],t)},fireEvent:function(){for(var u=arguments[0],f,t,e,n,i,u=r.trim(u).split(" "),o=0;f=u[o++];){if(t=h(this,f),t)for(i=t.length;i--;)if(t[i]){if(n=t[i].apply(this,arguments),n===!0)return n;n!==undefined&&(e=n)}(n=this["on"+f.toLowerCase()])&&(e=n.apply(this,arguments))}return e}};var u=f.dtd=function(){function n(n){for(var t in n)n[t.toUpperCase()]=n[t];return n}var i=r.extend2,h=n({isindex:1,fieldset:1}),a=n({input:1,button:1,select:1,textarea:1,label:1}),v=i(n({a:1}),a),c=i({iframe:1},v),e=n({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),y=n({ins:1,del:1,script:1,style:1}),p=i(n({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),y),w=i(n({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),p),o=i(n({p:1}),w),b=i(n({iframe:1}),w,a),k=n({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),t=i(n({a:0}),b),l=n({tr:1}),f=n({"#":1}),d=i(n({param:1}),k),u=i(n({form:1}),h,c,e,o),s=n({li:1,ol:1,ul:1}),it=n({style:1,script:1}),g=n({base:1,link:1,meta:1,title:1}),rt=i(g,it),nt=n({head:1,body:1}),ut=n({html:1}),tt=n({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),ft=n({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return n({$nonBodyContent:i(ut,nt,g),$block:tt,$inline:t,$inlineWithA:i(n({a:1}),t),$body:i(n({script:1,style:1}),tt),$cdata:n({script:1,style:1}),$empty:ft,$nonChild:n({iframe:1,textarea:1}),$listItem:n({dd:1,dt:1,li:1}),$list:n({ul:1,ol:1,dl:1}),$isNotEmpty:n({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:n({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:n({p:1,div:1}),$tableContent:n({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:n({pre:1,script:1,style:1,textarea:1}),html:nt,head:rt,style:f,script:f,body:u,base:{},link:{},meta:{},title:f,col:{},tr:n({td:1,th:1}),img:{},embed:{},colgroup:n({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:u,td:u,br:{},th:u,center:u,kbd:t,button:i(o,e),basefont:{},h5:t,h4:t,samp:t,h6:t,ol:s,h1:t,h3:t,option:f,h2:t,form:i(h,c,e,o),select:n({optgroup:1,option:1}),font:t,ins:t,menu:s,abbr:t,label:t,table:n({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:t,tfoot:l,cite:t,li:u,input:{},iframe:u,strong:t,textarea:f,noframes:u,big:t,small:t,span:n({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:t,dt:t,sub:t,optgroup:n({option:1}),param:{},bdo:t,"var":t,div:u,object:d,sup:t,dd:u,strike:t,area:{},dir:s,map:i(n({area:1,form:1,p:1}),h,y,e),applet:d,dl:n({dt:1,dd:1}),del:t,isindex:{},fieldset:i(n({legend:1}),k),thead:l,ul:s,acronym:t,b:t,a:i(n({a:1}),b),blockquote:i(n({td:1,tr:1,tbody:1,li:1}),u),caption:t,i:t,u:t,tbody:l,s:t,address:i(c,o),tt:t,legend:t,q:t,pre:i(p,v),p:i(n({a:1}),t),em:t,dfn:t})}(),c=e&&i.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},a=r.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),t=f.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:e&&i.version=="6"?"﻿":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},breakParent:function(n,i){var r,f=n,o=n,u,e;do{for(f=f.parentNode,u?(r=f.cloneNode(!1),r.appendChild(u),u=r,r=f.cloneNode(!1),r.appendChild(e),e=r):(u=f.cloneNode(!1),e=u.cloneNode(!1));r=o.previousSibling;)u.insertBefore(r,u.firstChild);while(r=o.nextSibling)e.appendChild(r);o=f}while(i!==f);return r=i.parentNode,r.insertBefore(u,i),r.insertBefore(e,i),r.insertBefore(n,e),t.remove(i),n},trimWhiteTextNode:function(n){function i(i){for(var r;(r=n[i])&&r.nodeType==3&&t.isWhitespace(r);)n.removeChild(r)}i("firstChild");i("lastChild")},getPosition:function(n,t){var i,r,u,f;if(n===t)return 0;for(r=[n],u=[t],i=n;i=i.parentNode;){if(i===t)return 10;r.push(i)}for(i=t;i=i.parentNode;){if(i===n)return 20;u.push(i)}if(r.reverse(),u.reverse(),r[0]!==u[0])return 1;for(f=-1;f++,r[f]===u[f];);for(n=r[f],t=u[f];n=n.nextSibling;)if(n===t)return 4;return 2},getNodeIndex:function(n,t){for(var i=n,r=0;i=i.previousSibling;){if(t&&i.nodeType==3){i.nodeType!=i.nextSibling.nodeType&&r++;continue}r++}return r},inDoc:function(n,i){return t.getPosition(n,i)==10},findParent:function(n,i,r){if(n&&!t.isBody(n))for(n=r?n:n.parentNode;n;){if(!i||i(n)||t.isBody(n))return i&&!i(n)&&t.isBody(n)?null:n;n=n.parentNode}return null},findParentByTagName:function(n,i,u,f){return i=r.listToMap(r.isArray(i)?i:[i]),t.findParent(n,function(n){return i[n.tagName]&&!(f&&f(n))},u)},findParents:function(n,i,r,u){for(var f=i&&(r&&r(n)||!r)?[n]:[];n=t.findParent(n,r);)f.push(n);return u?f:f.reverse()},insertAfter:function(n,t){return n.parentNode.insertBefore(t,n.nextSibling)},remove:function(n,t){var i=n.parentNode,r;if(i){if(t&&n.hasChildNodes())while(r=n.firstChild)i.insertBefore(r,n);i.removeChild(n)}return n},isBookmarkNode:function(n){return n.nodeType==1&&n.id&&/^_baidu_bookmark_/i.test(n.id)},getWindow:function(n){var t=n.ownerDocument||n;return t.defaultView||t.parentWindow},split:function(n,r){var e=n.ownerDocument,o,u,f;return i.ie&&r==n.nodeValue.length?(o=e.createTextNode(""),t.insertAfter(n,o)):(u=n.splitText(r),i.ie8&&(f=e.createTextNode(""),t.insertAfter(u,f),t.remove(f)),u)},isWhitespace:function(n){return!new RegExp("[^ \t\n\r"+t.fillChar+"]").test(n.nodeValue)},getXY:function(n){for(var t=0,i=0;n.offsetParent;)i+=n.offsetTop,t+=n.offsetLeft,n=n.offsetParent;return{x:t,y:i}},on:function(n,t,i){var o=r.isArray(t)?t:[t],f=o.length,u,e;if(f)while(f--)t=o[f],n.addEventListener?n.addEventListener(t,i,!1):(i._d||(i._d={els:[]}),u=t+i.toString(),e=r.indexOf(i._d.els,n),i._d[u]&&e!=-1||(e==-1&&i._d.els.push(n),i._d[u]||(i._d[u]=function(n){return i.call(n.srcElement,n||window.event)}),n.attachEvent("on"+t,i._d[u])));n=null},un:function(n,t,i){var o=r.isArray(t)?t:[t],f=o.length,u,e;if(f)while(f--)if(t=o[f],n.removeEventListener)n.removeEventListener(t,i,!1);else{u=t+i.toString();try{n.detachEvent("on"+t,i._d?i._d[u]:i)}catch(s){}i._d&&i._d[u]&&(e=r.indexOf(i._d.els,n),e!=-1&&i._d.els.splice(e,1),i._d.els.length==0&&delete i._d[u])}},isEmptyInlineElement:function(n){if(n.nodeType!=1||!u.$removeEmpty[n.tagName])return 0;for(n=n.firstChild;n;){if(t.isBookmarkNode(n)||n.nodeType==1&&!t.isEmptyInlineElement(n)||n.nodeType==3&&!t.isWhitespace(n))return 0;n=n.nextSibling}return 1},isBlockElm:function(n){return n.nodeType==1&&(u.$block[n.tagName]||a[t.getComputedStyle(n,"display")])&&!u.$nonChild[n.tagName]},getElementsByTagName:function(n,t,i){var e,u,o,s,h,c,f;for(i&&r.isString(i)&&(e=i,i=function(n){var t=!1;return $.each(r.trim(e).replace(/[ ]{2,}/g," ").split(" "),function(i,r){if($(n).hasClass(r))return t=!0,!1}),t}),t=r.trim(t).replace(/[ ]{2,}/g," ").split(" "),u=[],o=0;s=t[o++];)for(h=n.getElementsByTagName(s),c=0;f=h[c++];)(!i||i(f))&&u.push(f);return u},unSelectable:e||i.opera?function(n){n.onselectstart=function(){return!1};n.onclick=n.onkeyup=n.onkeydown=function(){return!1};n.unselectable="on";n.setAttribute("unselectable","on");for(var i=0,t;t=n.all[i++];)switch(t.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:t.unselectable="on";n.setAttribute("unselectable","on")}}:function(n){n.style.MozUserSelect=n.style.webkitUserSelect=n.style.KhtmlUserSelect="none"},removeAttributes:function(n,t){t=r.isArray(t)?t:r.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var f=0,u;u=t[f++];){u=c[u]||u;switch(u){case"className":n[u]="";break;case"style":n.style.cssText="";i.ie||n.removeAttributeNode(n.getAttributeNode("style"))}n.removeAttribute(u)}},createElement:function(n,i,r){return t.setAttributes(n.createElement(i),r)},setAttributes:function(n,t){var i,r;for(i in t)if(t.hasOwnProperty(i)){r=t[i];switch(i){case"class":n.className=r;break;case"style":n.style.cssText=n.style.cssText+";"+r;break;case"innerHTML":n[i]=r;break;case"value":n.value=r;break;default:n.setAttribute(c[i]||i,r)}}return n},getComputedStyle:function(n,t){return r.transUnitToPx(r.fixColor(t,$(n).css(t)))},preventDefault:function(n){n.preventDefault?n.preventDefault():n.returnValue=!1},getStyle:function(n,t){var i=n.style[r.cssStyleToDomStyle(t)];return r.fixColor(t,i)},setStyle:function(n,t,i){n.style[r.cssStyleToDomStyle(t)]=i;r.trim(n.style.cssText)||this.removeAttributes(n,"style")},removeDirtyAttr:function(n){for(var i=0,t,r=n.getElementsByTagName("*");t=r[i++];)t.removeAttribute("_moz_dirty");n.removeAttribute("_moz_dirty")},getChildCount:function(n,t){var r=0,i=n.firstChild;for(t=t||function(){return 1};i;)t(i)&&r++,i=i.nextSibling;return r},isEmptyNode:function(n){return!n.firstChild||t.getChildCount(n,function(n){return!t.isBr(n)&&!t.isBookmarkNode(n)&&!t.isWhitespace(n)})==0},isBr:function(n){return n.nodeType==1&&n.tagName=="BR"},isFillChar:function(n,i){return n.nodeType==3&&!n.nodeValue.replace(new RegExp((i?"^":"")+t.fillChar),"").length},isEmptyBlock:function(n,r){if(n.nodeType!=1||(r=r||new RegExp("[ \t\r\n"+t.fillChar+"]","g"),n[i.ie?"innerText":"textContent"].replace(r,"").length>0))return 0;for(var f in u.$isNotEmpty)if(n.getElementsByTagName(f).length)return 0;return 1},isCustomeNode:function(n){return n.nodeType==1&&n.getAttribute("_ue_custom_node_")},fillNode:function(n,r){var u=i.ie?n.createTextNode(t.fillChar):n.createElement("br");r.innerHTML="";r.appendChild(u)},isBoundaryNode:function(n,i){for(var r;!t.isBody(n);)if(r=n,n=n.parentNode,r!==n[i])return!1;return!0},isFillChar:function(n,i){return n.nodeType==3&&!n.nodeValue.replace(new RegExp((i?"^":"")+t.fillChar),"").length}},s=new RegExp(t.fillChar,"g");(function(){function a(n){n.collapsed=n.startContainer&&n.endContainer&&n.startContainer===n.endContainer&&n.startOffset==n.endOffset}function v(n){return!n.collapsed&&n.startContainer.nodeType==1&&n.startContainer===n.endContainer&&n.endOffset-n.startOffset==1}function h(n,i,r,f){return i.nodeType==1&&(u.$empty[i.tagName]||u.$nonChild[i.tagName])&&(r=t.getNodeIndex(i)+(n?0:1),i=i.parentNode),n?(f.startContainer=i,f.startOffset=r,f.endContainer||f.collapse(!0)):(f.endContainer=i,f.endOffset=r,f.startContainer||f.collapse(!1)),a(f),f}function l(r,u){try{if(n&&t.inDoc(n,r))if(n.nodeValue.replace(s,"").length)n.nodeValue=n.nodeValue.replace(s,"");else{var f=n.parentNode;for(t.remove(n);f&&t.isEmptyInlineElement(f)&&(i.safari?!(t.getPosition(f,u)&t.POSITION_CONTAINS):!f.contains(u));)n=f.parentNode,t.remove(f),f=n}}catch(e){}}function r(n,i){var r;for(n=n[i];n&&t.isFillChar(n);)r=n[i],t.remove(n),n=r}function y(n,i){var r=n.startContainer,o=n.endContainer,s=n.startOffset,w=n.endOffset,l=n.document,b=l.createDocumentFragment(),k,d,f,y,h,p;if(r.nodeType==1&&(r=r.childNodes[s]||(k=r.appendChild(l.createTextNode("")))),o.nodeType==1&&(o=o.childNodes[w]||(d=o.appendChild(l.createTextNode("")))),r===o&&r.nodeType==3)return b.appendChild(l.createTextNode(r.substringData(s,w-s))),i&&(r.deleteData(s,w-s),n.collapse(!0)),b;var u,a,e=b,c=t.findParents(r,!0),v=t.findParents(o,!0);for(f=0;c[f]==v[f];)f++;for(h=f;y=c[h];h++){for(u=y.nextSibling,y==r?k||(n.startContainer.nodeType==3?(e.appendChild(l.createTextNode(r.nodeValue.slice(s))),i&&r.deleteData(s,r.nodeValue.length-s)):e.appendChild(i?r:r.cloneNode(!0))):(a=y.cloneNode(!1),e.appendChild(a));u;){if(u===o||u===v[h])break;y=u.nextSibling;e.appendChild(i?u:u.cloneNode(!0));u=y}e=a}for(e=b,c[f]||(e.appendChild(c[f-1].cloneNode(!1)),e=e.firstChild),h=f;p=v[h];h++){if(u=p.previousSibling,p==o?d||n.endContainer.nodeType!=3||(e.appendChild(l.createTextNode(o.substringData(0,w))),i&&o.deleteData(0,w)):(a=p.cloneNode(!1),e.appendChild(a)),h!=f||!c[f])while(u){if(u===r)break;p=u.previousSibling;e.insertBefore(i?u:u.cloneNode(!0),e.firstChild);u=p}e=a}return i&&n.setStartBefore(v[f]?c[f]?v[f]:c[f-1]:v[f-1]).collapse(!0),k&&t.remove(k),d&&t.remove(d),b}var o=0,e=t.fillChar,n,c=f.Range=function(n,t){var i=this;i.startContainer=i.startOffset=i.endContainer=i.endOffset=null;i.document=n;i.collapsed=!0;i.body=t};c.prototype={deleteContents:function(){var n;return this.collapsed||y(this,1),i.webkit&&(n=this.startContainer,n.nodeType!=3||n.nodeValue.length||(this.setStartBefore(n).collapse(!0),t.remove(n))),this},inFillChar:function(){var n=this.startContainer;return this.collapsed&&n.nodeType==3&&n.nodeValue.replace(new RegExp("^"+t.fillChar),"").length+1==n.nodeValue.length?!0:!1},setStart:function(n,t){return h(!0,n,t,this)},setEnd:function(n,t){return h(!1,n,t,this)},setStartAfter:function(n){return this.setStart(n.parentNode,t.getNodeIndex(n)+1)},setStartBefore:function(n){return this.setStart(n.parentNode,t.getNodeIndex(n))},setEndAfter:function(n){return this.setEnd(n.parentNode,t.getNodeIndex(n)+1)},setEndBefore:function(n){return this.setEnd(n.parentNode,t.getNodeIndex(n))},setStartAtFirst:function(n){return this.setStart(n,0)},setStartAtLast:function(n){return this.setStart(n,n.nodeType==3?n.nodeValue.length:n.childNodes.length)},setEndAtFirst:function(n){return this.setEnd(n,0)},setEndAtLast:function(n){return this.setEnd(n,n.nodeType==3?n.nodeValue.length:n.childNodes.length)},selectNode:function(n){return this.setStartBefore(n).setEndAfter(n)},selectNodeContents:function(n){return this.setStart(n,0).setEndAtLast(n)},cloneRange:function(){var n=this;return new c(n.document).setStart(n.startContainer,n.startOffset).setEnd(n.endContainer,n.endOffset)},collapse:function(n){var t=this;return n?(t.endContainer=t.startContainer,t.endOffset=t.startOffset):(t.startContainer=t.endContainer,t.startOffset=t.endOffset),t.collapsed=!0,t},shrinkBoundary:function(n){function f(n){return n.nodeType==1&&!t.isBookmarkNode(n)&&!u.$empty[n.tagName]&&!u.$nonChild[n.tagName]}for(var i=this,r,e=i.collapsed;i.startContainer.nodeType==1&&(r=i.startContainer.childNodes[i.startOffset])&&f(r);)i.setStart(r,0);if(e)return i.collapse(!0);if(!n)while(i.endContainer.nodeType==1&&i.endOffset>0&&(r=i.endContainer.childNodes[i.endOffset-1])&&f(r))i.setEnd(r,r.childNodes.length);return i},trimBoundary:function(n){var f;this.txtToElmBoundary();var u=this.startContainer,i=this.startOffset,e=this.collapsed,r=this.endContainer;return u.nodeType==3&&(i==0?this.setStartBefore(u):i>=u.nodeValue.length?this.setStartAfter(u):(f=t.split(u,i),u===r?this.setEnd(f,this.endOffset-i):u.parentNode===r&&(this.endOffset+=1),this.setStartBefore(f)),e)?this.collapse(!0):(n||(i=this.endOffset,r=this.endContainer,r.nodeType==3&&(i==0?this.setEndBefore(r):(i<r.nodeValue.length&&t.split(r,i),this.setEndAfter(r)))),this)},txtToElmBoundary:function(n){function t(n,t){var i=n[t+"Container"],r=n[t+"Offset"];i.nodeType==3&&(r?r>=i.nodeValue.length&&n["set"+t.replace(/(\w)/,function(n){return n.toUpperCase()})+"After"](i):n["set"+t.replace(/(\w)/,function(n){return n.toUpperCase()})+"Before"](i))}return(n||!this.collapsed)&&(t(this,"start"),t(this,"end")),this},insertNode:function(n){var t=n,r=1;n.nodeType==11&&(t=n.firstChild,r=n.childNodes.length);this.trimBoundary(!0);var i=this.startContainer,f=this.startOffset,u=i.childNodes[f];return u?i.insertBefore(n,u):i.appendChild(n),t.parentNode===this.endContainer&&(this.endOffset=this.endOffset+r),this.setStartBefore(t)},setCursor:function(n,t){return this.collapse(!n).select(t)},createBookmark:function(n,t){var i,r=this.document.createElement("span");return r.style.cssText="display:none;line-height:0px;",r.appendChild(this.document.createTextNode("‍")),r.id="_baidu_bookmark_start_"+(t?"":o++),this.collapsed||(i=r.cloneNode(!0),i.id="_baidu_bookmark_end_"+(t?"":o++)),this.insertNode(r),i&&this.collapse().insertNode(i).setEndBefore(i),this.setStartAfter(r),{start:n?r.id:r,end:i?n?i.id:i:null,id:n}},moveToBookmark:function(n){var r=n.id?this.document.getElementById(n.start):n.start,i=n.end&&n.id?this.document.getElementById(n.end):n.end;return this.setStartBefore(r),t.remove(r),i?(this.setEndBefore(i),t.remove(i)):this.collapse(!0),this},adjustmentBoundary:function(){if(!this.collapsed){while(!t.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length)this.setStartAfter(this.startContainer);while(!t.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length)this.setEndBefore(this.endContainer)}return this},getClosedNode:function(){var i,t,n;return this.collapsed||(t=this.cloneRange().adjustmentBoundary().shrinkBoundary(),v(t)&&(n=t.startContainer.childNodes[t.startOffset],n&&n.nodeType==1&&(u.$empty[n.tagName]||u.$nonChild[n.tagName])&&(i=n))),i},select:i.ie?function(i,u){var f,a,h,o,y,v,c,s;if(this.collapsed||this.shrinkBoundary(),a=this.getClosedNode(),a&&!u){try{f=this.document.body.createControlRange();f.addElement(a);f.select()}catch(p){}return this}h=this.createBookmark();o=h.start;f=this.document.body.createTextRange();f.moveToElementText(o);f.moveStart("character",1);this.collapsed?i||this.startContainer.nodeType==3||(c=this.document.createTextNode(e),s=this.document.createElement("span"),s.appendChild(this.document.createTextNode(e)),o.parentNode.insertBefore(s,o),o.parentNode.insertBefore(c,o),l(this.document,c),n=c,r(s,"previousSibling"),r(o,"nextSibling"),f.moveStart("character",-1),f.collapse(!0)):(v=this.document.body.createTextRange(),y=h.end,v.moveToElementText(y),f.setEndPoint("EndToEnd",v));this.moveToBookmark(h);s&&t.remove(s);try{f.select()}catch(p){}return this}:function(u){function v(n){function t(t,i,r){t.nodeType==3&&t.nodeValue.length<i&&(n[r+"Offset"]=t.nodeValue.length)}t(n.startContainer,n.startOffset,"start");t(n.endContainer,n.endOffset,"end")}var a=t.getWindow(this.document),c=a.getSelection(),o,s,h,f;if(i.gecko?this.body.focus():a.focus(),c){if(c.removeAllRanges(),this.collapsed&&!u&&(s=this.startContainer,f=s,s.nodeType==1&&(f=s.childNodes[this.startOffset]),s.nodeType==3&&this.startOffset||(f?f.previousSibling&&f.previousSibling.nodeType==3:s.lastChild&&s.lastChild.nodeType==3)||(o=this.document.createTextNode(e),this.insertNode(o),l(this.document,o),r(o,"previousSibling"),r(o,"nextSibling"),n=o,this.setStart(o,i.webkit?1:0).collapse(!0))),h=this.document.createRange(),this.collapsed&&i.opera&&this.startContainer.nodeType==1)if(f=this.startContainer.childNodes[this.startOffset],f){while(f&&t.isBlockElm(f))if(f.nodeType==1&&f.childNodes[0])f=f.childNodes[0];else break;f&&this.setStartBefore(f).collapse(!0)}else f=this.startContainer.lastChild,f&&t.isBr(f)&&this.setStartBefore(f).collapse(!0);v(this);h.setStart(this.startContainer,this.startOffset);h.setEnd(this.endContainer,this.endOffset);c.addRange(h)}return this},createAddress:function(n,i){function f(n){for(var e,o,u,f=n?r.startContainer:r.endContainer,l=t.findParents(f,!0,function(n){return!t.isBody(n)}),h=[],a=0,c;c=l[a++];)h.push(t.getNodeIndex(c,i));if(e=0,i)if(f.nodeType==3){for(o=f.previousSibling;o&&o.nodeType==3;)e+=o.nodeValue.replace(s,"").length,o=o.previousSibling;e+=n?r.startOffset:r.endOffset}else if(f=f.childNodes[n?r.startOffset:r.endOffset],f)e=t.getNodeIndex(f,i);else for(f=n?r.startContainer:r.endContainer,u=f.firstChild;u;){if(t.isFillChar(u)){u=u.nextSibling;continue}if(e++,u.nodeType==3)while(u&&u.nodeType==3)u=u.nextSibling;else u=u.nextSibling}else e=n?t.isFillChar(f)?0:r.startOffset:r.endOffset;return e<0&&(e=0),h.push(e),h}var u={},r=this;return u.startAddress=f(!0),n||(u.endAddress=r.collapsed?[].concat(u.startAddress):f()),u},moveToAddress:function(n,t){function r(n,t){for(var r=i.body,u,f,e=0,o,s=n.length;e<s;e++)if(o=n[e],u=r,r=r.childNodes[o],!r){f=o;break}t?r?i.setStartBefore(r):i.setStart(u,f):r?i.setEndBefore(r):i.setEnd(u,f)}var i=this;return r(n.startAddress,!0),!t&&n.endAddress&&r(n.endAddress),i},equals:function(n){for(var t in this)if(this.hasOwnProperty(t)&&this[t]!==n[t])return!1;return!0},scrollIntoView:function(){var t=$('<span style="padding:0;margin:0;display:block;border:0">&nbsp;<\/span>');this.cloneRange().insertNode(t.get(0));var i=$(window).scrollTop(),r=$(window).height(),n=t.offset().top;(n<i-r||n>i+r)&&(n>i+r?window.scrollTo(0,n-r+t.height()):window.scrollTo(0,i-n));t.remove()}}})(),function(){function r(n,i){var l=t.getNodeIndex,e,o,y,p;if(n=n.duplicate(),n.collapse(i),e=n.parentElement(),!e.hasChildNodes())return{container:e,offset:0};for(var s=e.children,r,h=n.duplicate(),a=0,v=s.length-1,c=-1,f;a<=v;)if(c=Math.floor((a+v)/2),r=s[c],h.moveToElementText(r),o=h.compareEndPoints("StartToStart",n),o>0)v=c-1;else if(o<0)a=c+1;else return{container:e,offset:l(r)};if(c==-1){if(h.moveToElementText(e),h.setEndPoint("StartToStart",n),f=h.text.replace(/(\r\n|\r)/g,"\n").length,s=e.childNodes,!f)return r=s[s.length-1],{container:r,offset:r.nodeValue.length};for(y=s.length;f>0;)f-=s[--y].nodeValue.length;return{container:s[y],offset:-f}}if(h.collapse(o>0),h.setEndPoint(o>0?"StartToStart":"EndToStart",n),f=h.text.replace(/(\r\n|\r)/g,"\n").length,!f)return u.$empty[r.tagName]||u.$nonChild[r.tagName]?{container:e,offset:l(r)+(o>0?0:1)}:{container:r,offset:o>0?0:r.childNodes.length};while(f>0)try{p=r;r=r[o>0?"previousSibling":"nextSibling"];f-=r.nodeValue.length}catch(w){return{container:e,offset:l(p)}}return{container:r,offset:o>0?-f:r.nodeValue.length+f}}function e(n,t){if(n.item)t.selectNode(n.item(0));else{var i=r(n,!0);t.setStart(i.container,i.offset);n.compareEndPoints("StartToEnd",n)!=0&&(i=r(n,!1),t.setEnd(i.container,i.offset))}return t}function n(n,t){var i,r;try{i=n.getNative(t).createRange()}catch(u){return null}return(r=i.item?i.item(0):i.parentElement(),(r.ownerDocument||r)===n.document)?i:null}var o=f.Selection=function(r,u){var f=this;if(f.document=r,f.body=u,i.ie9below){t.on(u,"beforedeactivate",function(){f._bakIERange=f.getIERange()});t.on(u,"activate",function(){try{var t=n(f);t&&f.rangeInBody(t)||!f._bakIERange||f._bakIERange.select()}catch(i){}f._bakIERange=null})}};o.prototype={hasNativeRange:function(){var t,r;if(!i.ie||i.ie9above){if(r=this.getNative(),!r.rangeCount)return!1;t=r.getRangeAt(0)}else t=n(this);return this.rangeInBody(t)},getNative:function(n){var r=this.document;try{return r?i.ie9below||n?r.selection:t.getWindow(r).getSelection():null}catch(u){return null}},getIERange:function(t){var i=n(this,t);return(!i||!this.rangeInBody(i,t))&&this._bakIERange?this._bakIERange:i},rangeInBody:function(n,r){var u=i.ie9below||r?n.item?n.item():n.parentElement():n.startContainer;return u===this.body||t.inDoc(u,this.body)},cache:function(){this.clear();this._cachedRange=this.getRange();this._cachedStartElement=this.getStart();this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var n=this.getStart();return n?t.findParents(n,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){return this.hasNativeRange()},getRange:function(){function o(n){for(var t=r.body.firstChild,i=n.collapsed;t&&t.firstChild;)n.setStart(t,0),t=t.firstChild;n.startContainer||n.setStart(r.body,0);i&&n.collapse(!0)}var r=this,n,s,u,h,c;if(r._cachedRange!=null)return this._cachedRange;if(n=new f.Range(r.document,r.body),i.ie9below)if(s=r.getIERange(),s&&this.rangeInBody(s))try{e(s,n)}catch(l){o(n)}else o(n);else if(u=r.getNative(),u&&u.rangeCount&&r.rangeInBody(u.getRangeAt(0)))h=u.getRangeAt(0),c=u.getRangeAt(u.rangeCount-1),n.setStart(h.startContainer,h.startOffset).setEnd(c.endContainer,c.endOffset),n.collapsed&&t.isBody(n.startContainer)&&!n.startOffset&&o(n);else{if(this._bakRange&&(this._bakRange.startContainer===this.body||t.inDoc(this._bakRange.startContainer,this.body)))return this._bakRange;o(n)}return this._bakRange=n},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var t=i.ie9below?this.getIERange():this.getRange(),r,n,u,f;if(i.ie9below){if(!t)return this.document.body.firstChild;if(t.item)return t.item(0);for(r=t.duplicate(),r.text.length>0&&r.moveStart("character",1),r.collapse(1),n=r.parentElement(),f=u=t.parentElement();u=u.parentNode;)if(u==n){n=f;break}}else if(n=t.startContainer,n.nodeType==1&&n.hasChildNodes()&&(n=n.childNodes[Math.min(n.childNodes.length-1,t.startOffset)]),n.nodeType==3)return n.parentNode;return n},getText:function(){var n,t;return this.isFocus()&&(n=this.getNative())?(t=i.ie9below?n.createRange():n.getRangeAt(0),i.ie9below?t.text:t.toString()):""}}}(),function(){function n(n,i){var u,e,f,o;if(i.textarea)if(r.isString(i.textarea)){for(e=0,o=t.getElementsByTagName(n,"textarea");f=o[e++];)if(f.id=="umeditor_textarea_"+i.options.textarea){u=f;break}}else u=i.textarea;u||(n.appendChild(u=t.createElement(document,"textarea",{name:i.options.textarea,id:"umeditor_textarea_"+i.options.textarea,style:"display:none"})),i.textarea=u);u.value=i.hasContents()?i.options.allHtmlEnabled?i.getAllHtml():i.getContent(null,null,!0):""}function h(n){for(var t in UM.plugins)UM.plugins[t].call(n);n.langIsReady=!0;n.fireEvent("langReady")}function a(n){for(var t in n)return t}var l=0,s,c=UM.Editor=function(n){var t=this;t.uid=l++;o.call(t);t.commands={};t.options=r.extend(r.clone(n||{}),UMEDITOR_CONFIG,!0);t.shortcutkeys={};t.inputRules=[];t.outputRules=[];t.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,enterTag:"p",lang:"zh-cn",langPath:t.options.UMEDITOR_HOME_URL+"lang/",theme:"default",themePath:t.options.UMEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,autoSyncData:!0,autoHeightEnabled:!0});r.isEmptyObject(UM.I18N)?r.loadFile(document,{src:t.options.langPath+t.options.lang+"/"+t.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){h(t)}):(t.options.lang=a(UM.I18N),h(t))};c.prototype={ready:function(n){var t=this;n&&(t.isReady?n.apply(t):t.addListener("ready",n))},setOpt:function(n,t){var i={};r.isString(n)?i[n]=t:i=n;r.extend(this.options,i,!0)},getOpt:function(n){return this.options[n]||""},destroy:function(){var n=this,r,i,u;n.fireEvent("destroy");r=n.container.parentNode;r===document.body&&(r=n.container);i=n.textarea;i?i.style.display="":(i=document.createElement("textarea"),r.parentNode.insertBefore(i,r));i.style.width=n.body.offsetWidth+"px";i.style.height=n.body.offsetHeight+"px";i.value=n.getContent();i.id=n.key;r.contains(i)&&$(i).insertBefore(r);r.innerHTML="";t.remove(r);UM.clearCache(n.id);for(u in n)n.hasOwnProperty(u)&&delete this[u]},initialCont:function(n){if(n){if(n.getAttribute("name")&&(this.options.textarea=n.getAttribute("name")),n&&/script|textarea/ig.test(n.tagName)){var t=document.createElement("div");n.parentNode.insertBefore(t,n);this.options.initialContent=UM.htmlparser(n.value||n.innerHTML||this.options.initialContent).toHtml();n.className&&(t.className=n.className);n.style.cssText&&(t.style.cssText=n.style.cssText);/textarea/i.test(n.tagName)?(this.textarea=n,this.textarea.style.display="none"):(n.parentNode.removeChild(n),n.id&&(t.id=n.id));n=t;n.innerHTML=""}return n}return null},render:function(n){var e=this,t=e.options,f=function(t){return parseInt($(n).css(t))},u;r.isString(n)&&(n=document.getElementById(n));n&&(this.id=n.getAttribute("id"),UM.setEditor(this),r.cssRule("umeditor_body_css",e.options.initialStyle,document),n=this.initialCont(n),n.className+=" edui-body-container",t.minFrameWidth=t.initialFrameWidth?t.initialFrameWidth:t.initialFrameWidth=$(n).width()||UM.defaultWidth,t.initialFrameHeight?t.minFrameHeight=t.initialFrameHeight:t.initialFrameHeight=t.minFrameHeight=$(n).height()||UM.defaultHeight,n.style.width=/%$/.test(t.initialFrameWidth)?"100%":t.initialFrameWidth-f("padding-left")-f("padding-right")+"px",u=/%$/.test(t.initialFrameHeight)?"100%":t.initialFrameHeight-f("padding-top")-f("padding-bottom"),this.options.autoHeightEnabled?(n.style.minHeight=u+"px",n.style.height="",i.ie&&i.version<=6&&(n.style.height=u,n.style.setExpression("height","this.scrollHeight <= "+u+' ? "'+u+'px" : "auto"'))):$(n).height(u),n.style.zIndex=t.zIndex,this._setup(n))},_setup:function(r){var u=this,e=u.options,s,o,h;for(r.contentEditable=!0,document.body.spellcheck=!1,u.document=document,u.window=document.defaultView||document.parentWindow,u.body=r,u.$body=$(r),t.isBody=function(n){return n===r},u.selection=new f.Selection(document,u.body),i.gecko&&(s=this.selection.getNative())&&s.removeAllRanges(),this._initEvents(),o=r.parentNode;o&&!t.isBody(o);o=o.parentNode)if(o.tagName=="FORM"){if(u.form=o,u.options.autoSyncData)t.on(r,"blur",function(){n(o,u)});else t.on(o,"submit",function(){n(this,u)});break}if(e.initialContent&&(e.autoClearinitialContent?(h=u.execCommand,u.execCommand=function(){return u.fireEvent("firstBeforeExecCommand"),h.apply(u,arguments)},this._setDefaultContent(e.initialContent)):this.setContent(e.initialContent,!1,!0)),t.isEmptyNode(u.body)&&(u.body.innerHTML="<p>"+(i.ie?"":"<br/>")+"<\/p>"),e.focus&&setTimeout(function(){u.focus(u.options.focusInEnd);u.options.autoClearinitialContent||u._selectionChange()},0),u.container||(u.container=r.parentNode),u._bindshortcutKeys(),u.isReady=1,u.fireEvent("ready"),e.onready&&e.onready.call(u),!i.ie||i.ie9above)t.on(u.body,["blur","focus"],function(n){var t=u.selection.getNative();if(n.type=="blur")t.rangeCount>0&&(u._bakRange=t.getRangeAt(0));else{try{u._bakRange&&t.addRange(u._bakRange)}catch(n){}u._bakRange=null}});e.isShow||u.setHide();e.readonly&&u.setDisabled()},sync:function(i){var r=this,u=i?document.getElementById(i):t.findParent(r.body.parentNode,function(n){return n.tagName=="FORM"},!0);u&&n(u,r)},setHeight:function(n,t){t||(this.options.initialFrameHeight=n);this.options.autoHeightEnabled?($(this.body).css({"min-height":n+"px"}),i.ie&&i.version<=6&&this.container&&(this.container.style.height=n,this.container.style.setExpression("height","this.scrollHeight <= "+n+' ? "'+n+'px" : "auto"'))):$(this.body).height(n)},setWidth:function(n){this.$container&&this.$container.width(n);$(this.body).width(n-$(this.body).css("padding-left").replace("px","")*1-$(this.body).css("padding-right").replace("px","")*1)},addshortcutkey:function(n,t){var i={};t?i[n]=t:i=n;r.extend(this.shortcutkeys,i)},_bindshortcutKeys:function(){var n=this,i=this.shortcutkeys;n.addListener("keydown",function(r,u){var h=u.keyCode||u.which,e,c,l,f,o,s;for(e in i)for(c=i[e].split(","),l=0;f=c[l++];)f=f.split(":"),o=f[0],s=f[1],(/^(ctrl)(\+shift)?\+(\d+)$/.test(o.toLowerCase())||/^(\d+)$/.test(o))&&((RegExp.$1=="ctrl"?u.ctrlKey||u.metaKey:0)&&(RegExp.$2!=""?u[RegExp.$2.slice(1)+"Key"]:1)&&h==RegExp.$3||h==RegExp.$1)&&(n.queryCommandState(e,s)!=-1&&n.execCommand(e,s),t.preventDefault(u))})},getContent:function(n,t,i,u,f){var e=this,o;return(n&&r.isFunction(n)&&(t=n,n=""),t?!t():!this.hasContents())?"":(e.fireEvent("beforegetcontent"),o=UM.htmlparser(e.body.innerHTML,u),e.filterOutputRule(o),e.fireEvent("aftergetcontent",o),o.toHtml(f))},getAllHtml:function(){var n=this,u=[],t;return n.fireEvent("getAllHtml",u),i.ie&&i.version>8&&(t="",r.each(n.document.styleSheets,function(n){t+=n.href?'<link rel="stylesheet" type="text/css" href="'+n.href+'" />':"<style>"+n.cssText+"<\/style>"}),r.each(n.document.getElementsByTagName("script"),function(n){t+=n.outerHTML})),"<html><head>"+(n.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+n.options.charset+'"/>':"")+(t||n.document.getElementsByTagName("head")[0].innerHTML)+u.join("\n")+"<\/head><body "+(e&&i.version<9?'class="view"':"")+">"+n.getContent(null,null,!0)+"<\/body><\/html>"},getPlainTxt:function(){var i=new RegExp(t.fillChar,"g"),n=this.body.innerHTML.replace(/[\n\r]/g,"");return n=n.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(n,t,i){return u.$block[i]?"\n":t?t:""}),n.replace(i,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var n=new RegExp(t.fillChar,"g");return this.body[i.ie?"innerText":"textContent"].replace(n,"").replace(/\u00a0/g," ")},setContent:function(r,f,e){function v(n){return n.tagName=="DIV"&&n.getAttribute("cdata_tag")}var s=this,c,o,l,h,a;if(s.fireEvent("beforesetcontent",r),c=UM.htmlparser(r),s.filterInputRule(c),r=c.toHtml(),s.body.innerHTML=(f?s.body.innerHTML:"")+r,s.options.enterTag=="p")if(o=this.body.firstChild,!o||o.nodeType==1&&(u.$cdata[o.tagName]||v(o)||t.isCustomeNode(o))&&o===this.body.lastChild)this.body.innerHTML="<p>"+(i.ie?"&nbsp;":"<br/>")+"<\/p>"+this.body.innerHTML;else for(h=s.document.createElement("p");o;){while(o&&(o.nodeType==3||o.nodeType==1&&u.p[o.tagName]&&!u.$cdata[o.tagName]))l=o.nextSibling,h.appendChild(o),o=l;if(h.firstChild)if(o)o.parentNode.insertBefore(h,o),h=s.document.createElement("p");else{s.body.appendChild(h);break}o=o.nextSibling}s.fireEvent("aftersetcontent");s.fireEvent("contentchange");e||s._selectionChange();s._bakRange=s._bakIERange=s._bakNativeRange=null;i.gecko&&(a=this.selection.getNative())&&a.removeAllRanges();s.options.autoSyncData&&s.form&&n(s.form,s)},focus:function(n){try{var t=this,i=t.selection.getRange();n?i.setStartAtLast(t.body.lastChild).setCursor(!1,!0):i.select(!0);this.fireEvent("focus")}catch(r){}},blur:function(){var n=this.selection.getNative();n.empty?n.empty():n.removeAllRanges();this.fireEvent("blur")},isFocus:function(){return this.selection.isFocus()},_initEvents:function(){var n=this,i=n.body;n._proxyDomEvent=r.bind(n._proxyDomEvent,n);t.on(i,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],n._proxyDomEvent);t.on(i,["focus","blur"],n._proxyDomEvent);t.on(i,["mouseup","keydown"],function(t){t.type=="keydown"&&(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)||t.button!=2&&n._selectionChange(250,t)})},_proxyDomEvent:function(n){return this.fireEvent(n.type.replace(/^on/,""),n)},_selectionChange:function(n,t){var r=this,u=!1,f,e,o;i.ie&&i.version<9&&t&&t.type=="mouseup"&&(o=this.selection.getRange(),o.collapsed||(u=!0,f=t.clientX,e=t.clientY));clearTimeout(s);s=setTimeout(function(){var n,i;if(r.selection.getNative()){if(u&&r.selection.getNative().type=="None"){n=r.document.body.createTextRange();try{n.moveToPoint(f,e)}catch(o){n=null}}n&&(i=r.selection.getIERange,r.selection.getIERange=function(){return n});r.selection.cache();i&&(r.selection.getIERange=i);r.selection._cachedRange&&r.selection._cachedStartElement&&(r.fireEvent("beforeselectionchange"),r.fireEvent("selectionchange",!!t),r.fireEvent("afterselectionchange"),r.selection.clear())}},n||50)},_callCmdFn:function(n,t){t=Array.prototype.slice.call(t,0);var u=t.shift().toLowerCase(),i,r;if(i=this.commands[u]||UM.commands[u],r=i&&i[n],i&&r||n!="queryCommandState"){if(r)return r.apply(this,[u].concat(t))}else return 0},execCommand:function(n){var r,t,u,i;return(this.isFocus()||(r=this.selection._bakRange,r?r.select():this.focus(!0)),n=n.toLowerCase(),t=this,i=t.commands[n]||UM.commands[n],!i||!i.execCommand)?null:(i.notNeedUndo||t.__hasEnterExecCommand?(u=this._callCmdFn("execCommand",arguments),t._ignoreContentChange||t.fireEvent("contentchange")):(t.__hasEnterExecCommand=!0,t.queryCommandState.apply(t,arguments)!=-1&&(t.fireEvent("beforeexeccommand",n),u=this._callCmdFn("execCommand",arguments),t._ignoreContentChange||t.fireEvent("contentchange"),t.fireEvent("afterexeccommand",n)),t.__hasEnterExecCommand=!1),t._ignoreContentChange||t._selectionChange(),u)},queryCommandState:function(){try{return this._callCmdFn("queryCommandState",arguments)}catch(n){return 0}},queryCommandValue:function(){try{return this._callCmdFn("queryCommandValue",arguments)}catch(n){return null}},hasContents:function(n){var i,r,u,f,e;if(n)for(i=0;r=n[i++];)if(this.body.getElementsByTagName(r).length>0)return!0;if(!t.isEmptyBlock(this.body))return!0;for(n=["div"],i=0;r=n[i++];)for(u=t.getElementsByTagName(this.body,r),f=0;e=u[f++];)if(t.isCustomeNode(e))return!0;return!1},reset:function(){this.fireEvent("reset")},setEnabled:function(){var n=this,t;if(n.body.contentEditable=="false"){n.body.contentEditable=!0;t=n.selection.getRange();try{t.moveToBookmark(n.lastBk);delete n.lastBk}catch(i){t.setStartAtFirst(n.body).collapse(!0)}t.select(!0);n.bkqueryCommandState&&(n.queryCommandState=n.bkqueryCommandState,delete n.bkqueryCommandState);n.fireEvent("selectionchange")}},enable:function(){return this.setEnabled()},setDisabled:function(n){var t=this;n=n?r.isArray(n)?n:[n]:[];t.body.contentEditable=="true"&&(t.lastBk||(t.lastBk=t.selection.getRange().createBookmark(!0)),t.body.contentEditable=!1,t.bkqueryCommandState=t.queryCommandState,t.queryCommandState=function(i){return r.indexOf(n,i)!=-1?t.bkqueryCommandState.apply(t,arguments):-1},t.fireEvent("selectionchange"))},disable:function(n){return this.setDisabled(n)},_setDefaultContent:function(){function n(){var t=this;t.document.getElementById("initContent")&&(t.body.innerHTML="<p>"+(e?"":"<br/>")+"<\/p>",t.removeListener("firstBeforeExecCommand focus",n),setTimeout(function(){t.focus();t._selectionChange()},0))}return function(t){var i=this;i.body.innerHTML='<p id="initContent">'+t+"<\/p>";i.addListener("firstBeforeExecCommand focus",n)}}(),setShow:function(){var n=this,t=n.selection.getRange();if(n.container.style.display=="none"){try{t.moveToBookmark(n.lastBk);delete n.lastBk}catch(i){t.setStartAtFirst(n.body).collapse(!0)}setTimeout(function(){t.select(!0)},100);n.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var n=this;n.lastBk||(n.lastBk=n.selection.getRange().createBookmark(!0));n.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(n){var t=UM.I18N[this.options.lang],i,r;if(!t)throw Error("not import language file");for(n=(n||"").split("."),i=0;r=n[i++];)if(t=t[r],!t)break;return t},getContentLength:function(n,t){var i=this.getContent(!1,!1,!0).length,r,u;if(n)for(t=(t||[]).concat(["hr","img","iframe"]),i=this.getContentTxt().replace(/[\t\r\n]+/g,"").length,r=0;u=t[r++];)i+=this.body.getElementsByTagName(u).length;return i},addInputRule:function(n,t){n.ignoreUndo=t;this.inputRules.push(n)},filterInputRule:function(n,t){for(var r=0,i;i=this.inputRules[r++];)t&&i.ignoreUndo||i.call(this,n)},addOutputRule:function(n,t){n.ignoreUndo=t;this.outputRules.push(n)},filterOutputRule:function(n,t){for(var r=0,i;i=this.outputRules[r++];)t&&i.ignoreUndo||i.call(this,n)}};r.inherits(c,o)}();v=UM.filterWord=function(){function t(n){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<v:)/ig.test(n)}function n(n){return n.replace(/[\d.]+\w+/g,function(n){return r.transUnitToPx(n)})}function u(t){return t.replace(/[\t\r\n]+/g,"").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(t){if(i.opera)return"";try{var r=t.match(/width:([ \d.]*p[tx])/i)[1],u=t.match(/height:([ \d.]*p[tx])/i)[1],f=t.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+n(r)+'" height="'+n(u)+'" src="'+f+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1<\/strong><\/p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(n,t,i,r){return t=="class"&&r=="MsoListParagraph"?n:""}).replace(/<(font|span)[^>]*>\s*<\/\1>/gi,"").replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(t,i,r,u){for(var s,f,h,e=[],l=u.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),o=0,c;c=l[o];o++)if(h=c.split(":"),h.length==2){if(s=h[0].toLowerCase(),f=h[1].toLowerCase(),/^(background)\w*/.test(s)&&f.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(s)&&/^0\w+$/.test(f))continue;switch(s){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(i)||(e[o]=s.replace(/^mso-|-alt$/g,"")+":"+n(f));continue;case"horiz-align":e[o]="text-align:"+f;continue;case"vert-align":e[o]="vertical-align:"+f;continue;case"font-color":case"mso-foreground":e[o]="color:"+f;continue;case"mso-background":case"mso-highlight":e[o]="background:"+f;continue;case"mso-default-height":e[o]="min-height:"+n(f);continue;case"mso-default-width":e[o]="min-width:"+n(f);continue;case"mso-padding-between-alt":e[o]="border-collapse:separate;border-spacing:"+n(f);continue;case"text-line-through":(f=="single"||f=="double")&&(e[o]="text-decoration:line-through");continue;case"mso-zero-height":f=="yes"&&(e[o]="display:none");continue;case"margin":if(!/[1-9]/.test(f))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(s)||/text\-indent|padding|margin/.test(s)&&/\-[\d.]+/.test(f))continue;e[o]=s+":"+h[1]}return i+(e.length?' style="'+e.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(n){return r.transUnitToPx(n)})}return function(n){return t(n)?u(n):n}}(),function(){function t(n,t,i){return n.push(c),t+(i?1:-1)}function i(n,t){for(var i=0;i<t;i++)n.push(h)}function f(n,r,e,o){switch(n.type){case"root":for(var h=0,s;s=n.children[h++];)e&&s.type=="element"&&!u.$inlineWithA[s.tagName]&&h>1&&(t(r,o,!0),i(r,o)),f(s,r,e,o);break;case"text":l(n,r);break;case"element":a(n,r,e,o);break;case"comment":v(n,r,e)}return r}function l(n,t){t.push(n.parentNode.tagName=="pre"?n.data:n.data.replace(/[ ]{2}/g," &nbsp;"))}function a(n,r,e,o){var s="",h,c,a,l;if(n.attrs){s=[];h=n.attrs;for(c in h)s.push(c+(h[c]!==undefined?'="'+h[c]+'"':""));s=s.join(" ")}if(r.push("<"+n.tagName+(s?" "+s:"")+(u.$empty[n.tagName]?"/":"")+">"),e&&!u.$inlineWithA[n.tagName]&&n.tagName!="pre"&&n.children&&n.children.length&&(o=t(r,o,!0),i(r,o)),n.children&&n.children.length)for(a=0;l=n.children[a++];)e&&l.type=="element"&&!u.$inlineWithA[l.tagName]&&a>1&&(t(r,o),i(r,o)),f(l,r,e,o);u.$empty[n.tagName]||(e&&!u.$inlineWithA[n.tagName]&&n.tagName!="pre"&&n.children&&n.children.length&&(o=t(r,o),i(r,o)),r.push("<\/"+n.tagName+">"))}function v(n,t){t.push("<!--"+n.data+"-->")}function e(n,t){var i,r,u;if(n.type=="element"&&n.getAttr("id")==t)return n;if(n.children&&n.children.length)for(r=0;u=n.children[r++];)if(i=e(u,t))return i}function o(n,t,i){if(n.type=="element"&&n.tagName==t&&i.push(n),n.children&&n.children.length)for(var u=0,r;r=n.children[u++];)o(r,t,i)}function s(n,t){if(n.children&&n.children.length)for(var r=0,i;i=n.children[r];)s(i,t),i.parentNode&&(i.children&&i.children.length&&t(i),i.parentNode&&r++);else t(n)}var n=UM.uNode=function(n){this.type=n.type;this.data=n.data;this.tagName=n.tagName;this.parentNode=n.parentNode;this.attrs=n.attrs||{};this.children=n.children},h="    ",c="\n";n.createElement=function(t){return/[<>]/.test(t)?UM.htmlparser(t).children[0]:new n({type:"element",children:[],tagName:t})};n.createText=function(n,t){return new UM.uNode({type:"text",data:t?n:r.unhtml(n||"")})};n.prototype={toHtml:function(n){var t=[];return f(this,t,n,0),t.join("")},innerHTML:function(n){var i,t,f;if(this.type!="element"||u.$empty[this.tagName])return this;if(r.isString(n)){if(this.children)for(i=0;t=this.children[i++];)t.parentNode=null;for(this.children=[],f=UM.htmlparser(n),i=0;t=f.children[i++];)this.children.push(t),t.parentNode=this;return this}return f=new UM.uNode({type:"root",children:this.children}),f.toHtml()},innerText:function(t,i){if(this.type!="element"||u.$empty[this.tagName])return this;if(t){if(this.children)for(var f=0,r;r=this.children[f++];)r.parentNode=null;return this.children=[],this.appendChild(n.createText(t,i)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return this.type=="element"?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var t=this.parentNode,n=0,i;i=t.children[n];n++)if(i===this)return n==0?null:t.children[n-1]},nextSibling:function(){for(var n=this.parentNode,t=0,i;i=n.children[t++];)if(i===this)return n.children[t]},replaceChild:function(n,t){if(this.children){n.parentNode&&n.parentNode.removeChild(n);for(var i=0,r;r=this.children[i];i++)if(r===t)return this.children.splice(i,1,n),t.parentNode=null,n.parentNode=this,n}},appendChild:function(n){if(this.type=="root"||this.type=="element"&&!u.$empty[this.tagName]){this.children||(this.children=[]);n.parentNode&&n.parentNode.removeChild(n);for(var t=0,i;i=this.children[t];t++)if(i===n){this.children.splice(t,1);break}return this.children.push(n),n.parentNode=this,n}},insertBefore:function(n,t){if(this.children){n.parentNode&&n.parentNode.removeChild(n);for(var i=0,r;r=this.children[i];i++)if(r===t)return this.children.splice(i,0,n),n.parentNode=this,n}},insertAfter:function(n,t){if(this.children){n.parentNode&&n.parentNode.removeChild(n);for(var i=0,r;r=this.children[i];i++)if(r===t)return this.children.splice(i+1,0,n),n.parentNode=this,n}},removeChild:function(n,t){var r,i,u,f;if(this.children)for(r=0;i=this.children[r];r++)if(i===n){if(this.children.splice(r,1),i.parentNode=null,t&&i.children&&i.children.length)for(u=0;f=i.children[u];u++)this.children.splice(r+u,0,f),f.parentNode=this;return i}},getAttr:function(n){return this.attrs&&this.attrs[n.toLowerCase()]},setAttr:function(n,t){if(!n){delete this.attrs;return}if(this.attrs||(this.attrs={}),r.isObject(n))for(var i in n)n[i]?this.attrs[i.toLowerCase()]=n[i]:delete this.attrs[i];else t?this.attrs[n.toLowerCase()]=t:delete this.attrs[n]},getIndex:function(){for(var i=this.parentNode,n=0,t;t=i.children[n];n++)if(t===this)return n;return-1},getNodeById:function(n){var t,i,r;if(this.children&&this.children.length)for(i=0;r=this.children[i++];)if(t=e(r,n))return t},getNodesByTagName:function(n){n=r.trim(n).replace(/[ ]{2,}/g," ").split(" ");var i=[],t=this;return r.each(n,function(n){if(t.children&&t.children.length)for(var u=0,r;r=t.children[u++];)o(r,n,i)}),i},getStyle:function(n){var i=this.getAttr("style"),r,t;return i?(r=new RegExp("(^|;)\\s*"+n+":([^;]+)","i"),t=i.match(r),t&&t[0])?t[2]:"":""},setStyle:function(n,t){function f(n,t){var u=new RegExp("(^|;)\\s*"+n+":([^;]+;?)","gi");i=i.replace(u,"$1");t&&(i=n+":"+r.unhtml(t)+";"+i)}var i=this.getAttr("style"),u;if(i||(i=""),r.isObject(n))for(u in n)f(u,n[u]);else f(n,t);this.setAttr("style",r.trim(i))},traversal:function(n){return this.children&&this.children.length&&s(this,n),this}}}();y=UM.htmlparser=function(n,i){function h(n,t){if(a[n.tagName]){var i=o.createElement(a[n.tagName]);n.appendChild(i);i.appendChild(o.createText(t));n=i}else n.appendChild(o.createText(t))}function v(n,t,i){var f,e,l,h,c,s;if(f=k[t]){for(e=n;e.type!="root";){if(r.isArray(f)?r.indexOf(f,e.tagName)!=-1:f==e.tagName){n=e;l=!0;break}e=e.parentNode}l||(n=v(n,r.isArray(f)?f[0]:f))}if(h=new o({parentNode:n,type:"element",tagName:t.toLowerCase(),children:u.$empty[t]?null:[]}),i){for(c={};s=w.exec(i);)c[s[1].toLowerCase()]=r.unhtml(s[2]||s[3]||s[4]);h.attrs=c}return n.children.push(h),u.$empty[t]?n:h}function d(n,t){n.children.push(new o({type:"comment",data:t,parentNode:n}))}var l=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,w=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,b={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1},p;n=n.replace(new RegExp(t.fillChar,"g"),"");i||(n=n.replace(new RegExp("[\\r\\t\\n"+(i?"":" ")+"]*<\/?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(i?"":" ")+"]*","g"),function(n,t){return t&&b[t.toLowerCase()]?n.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):n.replace(new RegExp("^[\\r\\n"+(i?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(i?"":" ")+"]+$"),"")}));for(var o=UM.uNode,k={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},a={ol:"li",ul:"li"},e,c=0,s=0,y=new o({type:"root",children:[]}),f=y;e=l.exec(n);){c=e.index;try{if(c>s&&h(f,n.slice(s,c)),e[3])u.$cdata[f.tagName]?h(f,e[0]):f=v(f,e[3].toLowerCase(),e[4]);else if(e[1]){if(f.type!="root")if(u.$cdata[f.tagName]&&!u.$cdata[e[1]])h(f,e[0]);else{for(p=f;f.type=="element"&&f.tagName!=e[1].toLowerCase();)if(f=f.parentNode,f.type=="root"){f=p;throw"break";}f=f.parentNode}}else e[2]&&d(f,e[2])}catch(g){}s=l.lastIndex}return s<n.length&&h(f,n.slice(s)),y};p=UM.filterNode=function(){function n(t,i){var s,h,v,a,o,y,c,l,f,e;switch(t.type){case"element":if(s=i[t.tagName])if(s==="-")t.parentNode.removeChild(t);else if(r.isFunction(s))if(c=t.parentNode,l=t.getIndex(),s(t),t.parentNode){if(t.children)for(f=0;e=t.children[f];)n(e,i),e.parentNode&&f++}else for(f=l;e=c.children[f];)n(e,i),e.parentNode&&f++;else{if(h=s.$,h&&t.attrs){v={};for(o in h)a=t.getAttr(o),o=="style"&&r.isArray(h[o])&&(y=[],r.each(h[o],function(n){var i;(i=t.getStyle(n))&&y.push(n+":"+i)}),a=y.join(";")),a&&(v[o]=a);t.attrs=v}if(t.children)for(f=0;e=t.children[f];)n(e,i),e.parentNode&&f++}else if(u.$cdata[t.tagName])t.parentNode.removeChild(t);else for(c=t.parentNode,l=t.getIndex(),t.parentNode.removeChild(t,!0),f=l;e=c.children[f];)n(e,i),e.parentNode&&f++;break;case"comment":t.parentNode.removeChild(t)}}return function(t,i){var e,u,f;if(r.isEmptyObject(i))return t;for((e=i["-"])&&r.each(e.split(" "),function(n){i[n]="-"}),u=0;f=t.children[u];)n(f,i),f.parentNode&&u++;return t}}();UM.commands.inserthtml={execCommand:function(n,f,e){var a=this,o,b,k,c,h,p,w,d,v,g,y,tt,l,nt;if(f&&a.fireEvent("beforeinserthtml",f)!==!0){if(o=a.selection.getRange(),b=o.document.createElement("div"),b.style.display="inline",e||(k=UM.htmlparser(f),a.options.filterRules&&UM.filterNode(k,a.options.filterRules),a.filterInputRule(k),f=k.toHtml()),b.innerHTML=r.trim(f),!o.collapsed&&(c=o.startContainer,t.isFillChar(c)&&o.setStartBefore(c),c=o.endContainer,t.isFillChar(c)&&o.setEndAfter(c),o.txtToElmBoundary(),o.endContainer&&o.endContainer.nodeType==1&&(c=o.endContainer.childNodes[o.endOffset],c&&t.isBr(c)&&o.setEndAfter(c)),o.startOffset==0&&(c=o.startContainer,t.isBoundaryNode(c,"firstChild")&&(c=o.endContainer,o.endOffset==(c.nodeType==3?c.nodeValue.length:c.childNodes.length)&&t.isBoundaryNode(c,"lastChild")&&(a.body.innerHTML="<p>"+(i.ie?"":"<br/>")+"<\/p>",o.setStart(a.body.firstChild,0).collapse(!0)))),o.collapsed||o.deleteContents(),o.startContainer.nodeType==1&&(h=o.startContainer.childNodes[o.startOffset],h&&t.isBlockElm(h)&&(l=h.previousSibling)&&t.isBlockElm(l)))){for(o.setEnd(l,l.childNodes.length).collapse();h.firstChild;)l.appendChild(h.firstChild);t.remove(h)}for(d=0,o.inFillChar()&&(h=o.startContainer,t.isFillChar(h)?(o.setStartBefore(h).collapse(!0),t.remove(h)):t.isFillChar(h,!0)&&(h.nodeValue=h.nodeValue.replace(s,""),o.startOffset--,o.collapsed&&o.collapse(!0)));h=b.firstChild;){if(d){for(g=a.document.createElement("p");h&&(h.nodeType==3||!u.$block[h.tagName]);)v=h.nextSibling,g.appendChild(h),h=v;g.firstChild&&(h=g)}if(o.insertNode(h),v=h.nextSibling,!d&&h.nodeType==t.NODE_ELEMENT&&t.isBlockElm(h)&&(p=t.findParent(h,function(n){return t.isBlockElm(n)}),p&&p.tagName.toLowerCase()!="body"&&!(u[p.tagName][h.nodeName]&&h.parentNode===p))){if(u[p.tagName][h.nodeName])for(w=h.parentNode;w!==p;)l=w,w=w.parentNode;else l=p;t.breakParent(h,l||w);l=h.previousSibling;t.trimWhiteTextNode(l);l.childNodes.length||t.remove(l);!i.ie&&(y=h.nextSibling)&&t.isBlockElm(y)&&y.lastChild&&!t.isBr(y.lastChild)&&y.appendChild(a.document.createElement("br"));d=1}if(y=h.nextSibling,!b.firstChild&&y&&t.isBlockElm(y)){o.setStart(y,0).collapse(!0);break}o.setEndAfter(h).collapse()}if(h=o.startContainer,v&&t.isBr(v)&&t.remove(v),t.isBlockElm(h)&&t.isEmptyNode(h))if(v=h.nextSibling)t.remove(h),v.nodeType==1&&u.$block[v.tagName]&&o.setStart(v,0).collapse(!0).shrinkBoundary();else try{h.innerHTML=i.ie?t.fillChar:"<br/>"}catch(it){o.setStartBefore(h);t.remove(h)}try{i.ie9below&&o.startContainer.nodeType==1&&!o.startContainer.childNodes[o.startOffset]&&(tt=o.startContainer,l=tt.childNodes[o.startOffset-1],l&&l.nodeType==1&&u.$empty[l.tagName]&&(nt=this.document.createTextNode(t.fillChar),o.insertNode(nt).setStart(nt,0).collapse(!0)));o.select(!0)}catch(it){}setTimeout(function(){o=a.selection.getRange();o.scrollIntoView();a.fireEvent("afterinserthtml")},200)}}};UM.commands.insertimage={execCommand:function(n,t){var e;if(t=r.isArray(t)?t:[t],t.length){var o=this,f=[],u="",i;if(i=t[0],t.length==1)u='<img src="'+i.src+'" '+(i._src?' _src="'+i._src+'" ':"")+(i.width?'width="'+i.width+'" ':"")+(i.height?' height="'+i.height+'" ':"")+(i.floatStyle=="left"||i.floatStyle=="right"?' style="float:'+i.floatStyle+';"':"")+(i.title&&i.title!=""?' title="'+i.title+'"':"")+(i.border&&i.border!="0"?' border="'+i.border+'"':"")+(i.alt&&i.alt!=""?' alt="'+i.alt+'"':"")+(i.hspace&&i.hspace!="0"?' hspace = "'+i.hspace+'"':"")+(i.vspace&&i.vspace!="0"?' vspace = "'+i.vspace+'"':"")+"/>",i.floatStyle=="center"&&(u='<p style="text-align: center">'+u+"<\/p>"),f.push(u);else for(e=0;i=t[e++];)u="<p "+(i.floatStyle=="center"?'style="text-align: center" ':"")+'><img src="'+i.src+'" '+(i.width?'width="'+i.width+'" ':"")+(i._src?' _src="'+i._src+'" ':"")+(i.height?' height="'+i.height+'" ':"")+' style="'+(i.floatStyle&&i.floatStyle!="center"?"float:"+i.floatStyle+";":"")+(i.border||"")+'" '+(i.title?' title="'+i.title+'"':"")+" /><\/p>",f.push(u);o.execCommand("insertHtml",f.join(""),!0)}}};UM.plugins.justify=function(){$.each("justifyleft justifyright justifycenter justifyfull".split(" "),function(n,t){UM.commands[t]={execCommand:function(n){return this.document.execCommand(n)},queryCommandValue:function(n){var t=this.document.queryCommandValue(n);return t===!0||t==="true"?n.replace(/justify/,""):""},queryCommandState:function(n){return this.document.queryCommandState(n)?1:0}}})};UM.plugins.font=function(){var n=this,t={forecolor:"forecolor",backcolor:"backcolor",fontsize:"fontsize",fontfamily:"fontname"},u={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},e={forecolor:"color",fontsize:"size",fontfamily:"face"},f;n.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"},{name:"sans-serif",val:"sans-serif"}],fontsize:[10,12,16,18,24,32,48]});n.addOutputRule(function(n){r.each(n.getNodesByTagName("font"),function(n){var t,i,r;if(n.tagName=="font"){t=[];for(i in n.attrs)switch(i){case"size":r=n.attrs[i];$.each({"10":"1","12":"2","16":"3","18":"4","24":"5","32":"6","48":"7"},function(n,t){if(t==r)return r=n,!1});t.push("font-size:"+r+"px");break;case"color":t.push("color:"+n.attrs[i]);break;case"face":t.push("font-family:"+n.attrs[i]);break;case"style":t.push(n.attrs[i])}n.attrs={style:t.join(";")}}n.tagName="span";n.parentNode.tagName=="span"&&n.parentNode.children.length==1&&($.each(n.attrs,function(t,i){n.parentNode.attrs[t]=t=="style"?n.parentNode.attrs[t]+i:i}),n.parentNode.removeChild(n,!0))})});for(f in t)(function(f){UM.commands[f]={execCommand:function(n,r){var f,e;if(r!="transparent")if(f=this.selection.getRange(),f.collapsed)e=$("<span><\/span>").css(u[n],r)[0],f.insertNode(e).setStart(e,0).setCursor();else{if(n=="fontsize"&&(r={"10":"1","12":"2","16":"3","18":"4","24":"5","32":"6","48":"7"}[(r+"").replace(/px/,"")]),this.document.execCommand(t[n],!1,r),i.gecko&&$.each(this.$body.find("a"),function(n,t){var i=t.parentNode,r;i.lastChild===i.firstChild&&/FONT|SPAN/.test(i.tagName)&&(r=i.cloneNode(!1),r.innerHTML=t.innerHTML,$(t).html("").append(r).insertBefore(i),$(i).remove())}),!i.ie){var o=this.selection.getNative().getRangeAt(0),s=o.commonAncestorContainer,f=this.selection.getRange(),h=f.createBookmark(!0);$(s).find("a").each(function(n,t){var r=t.parentNode,i;r.nodeName=="FONT"&&(i=r.cloneNode(!1),i.innerHTML=t.innerHTML,$(t).html("").append(i))});f.moveToBookmark(h).select()}return!0}},queryCommandValue:function(t){var f=n.selection.getStart(),i=$(f).css(u[t]);return i===undefined&&(i=$(f).attr(e[t])),i?r.fixColor(t,i).replace(/px/,""):""},queryCommandState:function(n){return this.queryCommandValue(n)}}})(f)};UM.plugins.link=function(){this.setOpt("autourldetectinie",!1);i.ie&&this.options.autourldetectinie===!1&&this.addListener("keyup",function(n,i){var o=this,f=i.keyCode,e,r,u;(f==13||f==32)&&(e=o.selection.getRange(),r=e.startContainer,f==13?r.nodeName=="P"&&(u=r.previousSibling,u&&u.nodeType==1&&(u=u.lastChild,u&&u.nodeName=="A"&&!u.getAttribute("_href")&&t.remove(u,!0))):f==32&&r.nodeType==3&&/^\s$/.test(r.nodeValue)&&(r=r.previousSibling,r&&r.nodeName=="A"&&!r.getAttribute("_href")&&t.remove(r,!0)))});this.addOutputRule(function(n){$.each(n.getNodesByTagName("a"),function(n,t){var i=r.html(t.getAttr("_href"));/^(ftp|https?|\/|file)/.test(i)||(i="http://"+i);t.setAttr("href",i);t.setAttr("_href");t.getAttr("title")==""&&t.setAttr("title")})});this.addInputRule(function(n){$.each(n.getNodesByTagName("a"),function(n,t){t.setAttr("_href",r.html(t.getAttr("href")))})});UM.commands.link={execCommand:function(n,i){var e=this,u=e.selection.getRange(),f;u.collapsed?(f=u.startContainer,(f=t.findParentByTagName(f,"a",!0))?($(f).attr(i),u.selectNode(f).select()):u.insertNode($("<a>"+i.href+"<\/a>").attr(i)[0]).select()):(e.document.execCommand("createlink",!1,"_umeditor_link"),r.each(t.getElementsByTagName(e.body,"a",function(n){return n.getAttribute("href")=="_umeditor_link"}),function(n){$(n).text()=="_umeditor_link"&&$(n).text(i.href);t.setAttributes(n,i);u.selectNode(n).select()}))},queryCommandState:function(){return this.queryCommandValue("link")?1:0},queryCommandValue:function(){var t=this.selection.getStartElementPath(),n;return $.each(t,function(t,i){if(i.nodeName=="A")return n=i,!1}),n}};UM.commands.unlink={execCommand:function(){this.document.execCommand("unlink")}}};UM.commands.print={execCommand:function(){var r=this,n="editor_print_"+ +new Date,i,t;$('<iframe src="" id="'+n+'" name="'+n+'" frameborder="0"><\/iframe>').attr("id",n).css({width:"0px",height:"0px",overflow:"hidden",float:"left",position:"absolute",top:"-10000px",left:"-10000px"}).appendTo(r.$container.find(".edui-dialog-container"));i=window.open("",n,"");t=i.document;t.open();t.write("<html><head><\/head><body><div>"+this.getContent(null,null,!0)+"<\/div><script>setTimeout(function(){window.print();setTimeout(function(){window.parent.$('#"+n+"').remove();},100);},200);<\/script><\/body><\/html>");t.close()},notNeedUndo:1};UM.plugins.paragraph=function(){var n=this;n.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""});n.commands.paragraph={execCommand:function(n,t){return this.document.execCommand("formatBlock",!1,"<"+t+">")},queryCommandValue:function(){try{var n=this.document.queryCommandValue("formatBlock")}catch(t){}return n}}};UM.plugins.horizontal=function(){var n=this;n.commands.horizontal={execCommand:function(){var f,r,o,s,e,h;if(this.document.execCommand("insertHorizontalRule"),f=n.selection.getRange().txtToElmBoundary(!0),r=f.startContainer,t.isBody(f.startContainer))o=f.startContainer.childNodes[f.startOffset],o||(o=$("<p><\/p>").appendTo(f.startContainer).html(i.ie?"&nbsp;":"<br/>")[0]),f.setStart(o,0).setCursor();else{while(u.$inline[r.tagName]&&r.lastChild===r.firstChild)s=r.parentNode,s.appendChild(r.firstChild),s.removeChild(r),r=s;while(u.$inline[r.tagName])r=r.parentNode;r.childNodes.length==1&&r.lastChild.nodeName=="HR"?(e=r.lastChild,$(e).insertBefore(r),f.setStart(r,0).setCursor()):(e=$("hr",r)[0],t.breakParent(e,r),h=e.previousSibling,h&&t.isEmptyBlock(h)&&$(h).remove(),f.setStart(e.nextSibling,0).setCursor())}}}};UM.commands.cleardoc={execCommand:function(){var n=this,t=n.selection.getRange();n.body.innerHTML="<p>"+(e?"":"<br/>")+"<\/p>";t.setStart(n.body.firstChild,0).setCursor(!1,!0);setTimeout(function(){n.fireEvent("clearDoc")},0)}};UM.plugins.undo=function(){function l(n,t){if(n.length!=t.length)return 0;for(var i=0,r=n.length;i<r;i++)if(n[i]!=t[i])return 0;return 1}function d(n,t){return n.collapsed!=t.collapsed?0:!l(n.startAddress,t.startAddress)||!l(n.endAddress,t.endAddress)?0:1}function g(){this.list=[];this.index=0;this.hasUndo=!1;this.hasRedo=!1;this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return}while(this.list[this.index].content==this.list[this.index-1].content)if(this.index--,this.index==0)return this.restore(0);this.restore(--this.index)}};this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}};this.restore=function(){var n=this.editor,s=this.list[this.index],h=UM.htmlparser(s.content.replace(b,"")),e,o;n.options.autoClearEmptyNode=!1;n.filterInputRule(h,!0);n.options.autoClearEmptyNode=c;n.body.innerHTML=h.toHtml();n.fireEvent("afterscencerestore");i.ie&&r.each(t.getElementsByTagName(n.document,"td th caption p"),function(i){t.isEmptyNode(i)&&t.fillNode(n.document,i)});try{e=new f.Range(n.document,n.body).moveToAddress(s.address);i.ie&&e.collapsed&&e.startContainer.nodeType==1&&(o=e.startContainer.childNodes[e.startOffset],(!o||o.nodeType==1&&u.$empty[o])&&e.insertNode(n.document.createTextNode(" ")).collapse(!0));e.select(k[e.startContainer.nodeName.toLowerCase()])}catch(l){}this.update();this.clearKey();n.fireEvent("reset",!0)};this.getScene=function(){var n=this.editor,u=n.selection.getRange(),f=u.createAddress(!1,!0),r,t;return n.fireEvent("beforegetscene"),r=UM.htmlparser(n.body.innerHTML,!0),n.options.autoClearEmptyNode=!1,n.filterOutputRule(r,!0),n.options.autoClearEmptyNode=c,t=r.toHtml(),i.ie&&(t=t.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">")),n.fireEvent("aftergetscene"),{address:f,content:t}};this.save=function(n,t){clearTimeout(s);var i=this.getScene(t),r=this.list[this.index];r&&r.content==i.content&&(n?1:d(r.address,i.address))||(this.list=this.list.slice(0,this.index+1),this.list.push(i),this.list.length>p&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())};this.update=function(){this.hasRedo=!!this.list[this.index+1];this.hasUndo=!!this.list[this.index-1]};this.reset=function(){this.list=[];this.index=0;this.hasUndo=!1;this.hasRedo=!1;this.clearKey()};this.clearKey=function(){h=0;y=null}}function a(){this.undoManger.save()}var s,n=this,p=n.options.maxUndoCount||20,w=n.options.maxInputCount||20,b=new RegExp(t.fillChar+"|<\/hr>","gi"),k={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},c=n.options.autoClearEmptyNode,o;n.undoManger=new g;n.undoManger.editor=n;n.addListener("saveScene",function(){var n=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,n)});n.addListener("beforeexeccommand",a);n.addListener("afterexeccommand",a);n.addListener("reset",function(n,t){t||this.undoManger.reset()});n.commands.redo=n.commands.undo={execCommand:function(n){this.undoManger[n]()},queryCommandState:function(n){return this.undoManger["has"+(n.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1},notNeedUndo:1};var v={16:1,17:1,18:1,37:1,38:1,39:1,40:1},h=0,y,e=!1;n.addListener("ready",function(){t.on(this.body,"compositionstart",function(){e=!0});t.on(this.body,"compositionend",function(){e=!1})});n.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89,shift+ctrl+z"});o=!0;n.addListener("keydown",function(n,t){var i=this,u=t.keyCode||t.which;if(!v[u]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(e)return;if(!i.selection.getRange().collapsed){i.undoManger.save(!1,!0);o=!1;return}i.undoManger.list.length==0&&i.undoManger.save(!0);clearTimeout(s);function r(n){n.selection.getRange().collapsed&&n.fireEvent("contentchange");n.undoManger.save(!1,!0);n.fireEvent("selectionchange")}s=setTimeout(function(){if(e){var n=setInterval(function(){e||(r(i),clearInterval(n))},300);return}r(i)},200);y=u;h++;h>=w&&r(i)}});n.addListener("keyup",function(n,t){var i=t.keyCode||t.which;if(!v[i]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(e)return;o||(this.undoManger.save(!1,!0),o=!0)}})};UM.plugins.paste=function(){function u(n){var u=this.document;if(!u.getElementById("baidu_pastebin")){var f=this.selection.getRange(),e=f.createBookmark(),r=u.createElement("div");r.id="baidu_pastebin";i.webkit&&r.appendChild(u.createTextNode(t.fillChar+t.fillChar));this.body.appendChild(r);e.start.style.display="";r.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+$(e.start).position().top+"px";f.selectNodeContents(r).select(!0);setTimeout(function(){if(i.webkit)for(var s=0,h=u.querySelectorAll("#baidu_pastebin"),o;o=h[s++];)if(t.isEmptyNode(o))t.remove(o);else{r=o;break}try{r.parentNode.removeChild(r)}catch(c){}f.moveToBookmark(e).select(!0);n(r)},0)}}function f(u){var e,p,a,w,c,b,h,y,k,v,d,g,f,o,s,l;if(u.firstChild){for(p=t.getElementsByTagName(u,"span"),f=0;a=p[f++];)(a.id=="_baidu_cut_start"||a.id=="_baidu_cut_end")&&t.remove(a);if(i.webkit){for(v=u.querySelectorAll("div br"),f=0;w=v[f++];)c=w.parentNode,c.tagName=="DIV"&&c.childNodes.length==1&&(c.innerHTML="<p><br/><\/p>",t.remove(c));for(b=u.querySelectorAll("#baidu_pastebin"),f=0;h=b[f++];){for(y=n.document.createElement("p"),h.parentNode.insertBefore(y,h);h.firstChild;)y.appendChild(h.firstChild);t.remove(h)}for(k=u.querySelectorAll("meta"),f=0;o=k[f++];)t.remove(o);for(v=u.querySelectorAll("br"),f=0;o=v[f++];)/^apple-/i.test(o.className)&&t.remove(o)}if(i.gecko)for(d=u.querySelectorAll("[_moz_dirty]"),f=0;o=d[f++];)o.removeAttribute("_moz_dirty");if(!i.ie)for(g=u.querySelectorAll("span.Apple-style-span"),f=0;o=g[f++];)t.remove(o,!0);if(e=u.innerHTML,e=UM.filterWord(e),s=UM.htmlparser(e),n.options.filterRules&&UM.filterNode(s,n.options.filterRules),n.filterInputRule(s),i.webkit&&(l=s.lastChild(),l&&l.type=="element"&&l.tagName=="br"&&s.removeChild(l),r.each(n.body.querySelectorAll("div"),function(n){t.isEmptyBlock(n)&&t.remove(n)})),e={html:s.toHtml()},n.fireEvent("beforepaste",e,s),!e.html)return;n.execCommand("insertHtml",e.html,!0);n.fireEvent("afterpaste",e)}}var n=this;n.addListener("ready",function(){t.on(n.body,"cut",function(){var t=n.selection.getRange();!t.collapsed&&n.undoManger&&n.undoManger.save()});t.on(n.body,i.ie||i.opera?"keydown":"paste",function(t){(i.ie||i.opera)&&(!t.ctrlKey&&!t.metaKey||t.keyCode!="86")||u.call(n,function(n){f(n)})})})};UM.plugins.list=function(){var n=this;n.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}});this.addInputRule(function(n){r.each(n.getNodesByTagName("li"),function(n){n.children.length==0&&n.parentNode.removeChild(n)})});n.commands.insertorderedlist=n.commands.insertunorderedlist={execCommand:function(n){this.document.execCommand(n);var t=this.selection.getRange(),i=t.createBookmark(!0);return this.$body.find("ol,ul").each(function(n,t){var i=t.parentNode;i.tagName=="P"&&i.lastChild===i.firstChild&&($(t).children().each(function(n,t){var r=i.cloneNode(!1);$(r).append(t.innerHTML);$(t).html("").append(r)}),$(t).insertBefore(i),$(i).remove())}),t.moveToBookmark(i).select(),!0},queryCommandState:function(n){return this.document.queryCommandState(n)}}},function(){var n={textarea:function(n,t){var r=t.ownerDocument.createElement("textarea");return r.style.cssText="resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0",i.ie&&i.version<8&&(r.style.width=t.offsetWidth+"px",r.style.height=t.offsetHeight+"px",t.onresize=function(){r.style.width=t.offsetWidth+"px";r.style.height=t.offsetHeight+"px"}),t.appendChild(r),{container:r,setContent:function(n){r.value=n},getContent:function(){return r.value},select:function(){var n;i.ie?(n=r.createTextRange(),n.collapse(!0),n.select()):(r.setSelectionRange(0,0),r.focus())},dispose:function(){t.removeChild(r);t.onresize=null;r=null;t=null}}}};UM.plugins.source=function(){function c(i){return n.textarea(t,i)}var t=this,h=this.options,f=!1,r,o,s,e;h.sourceEditor="textarea";t.setOpt({sourceEditorFirst:!1});o=t.getContent;t.commands.source={execCommand:function(){var n,l,h,e,a;if(f=!f,f)s=t.selection.getRange().createAddress(!1,!0),t.undoManger&&t.undoManger.save(!0),i.gecko&&(t.body.contentEditable=!1),t.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;",t.fireEvent("beforegetcontent"),n=UM.htmlparser(t.body.innerHTML),t.filterOutputRule(n),n.traversal(function(n){if(n.type=="element")switch(n.tagName){case"td":case"th":case"caption":n.children&&n.children.length==1&&n.firstChild().tagName=="br"&&n.removeChild(n.firstChild());break;case"pre":n.innerText(n.innerText().replace(/&nbsp;/g," "))}}),t.fireEvent("aftergetcontent"),l=n.toHtml(!0),r=c(t.body.parentNode),r.setContent(l),h=function(n){return parseInt($(t.body).css(n))},$(r.container).width($(t.body).width()+h("padding-left")+h("padding-right")).height($(t.body).height()),setTimeout(function(){r.select()}),t.getContent=function(){return r.getContent()||"<p>"+(i.ie?"":"<br/>")+"<\/p>"};else{t.$body.css({position:"",left:"",top:""});e=r.getContent()||"<p>"+(i.ie?"":"<br/>")+"<\/p>";e=e.replace(new RegExp("[\\r\\t\\n ]*<\/?(\\w+)\\s*(?:[^>]*)>","g"),function(n,t){return t&&!u.$inlineWithA[t.toLowerCase()]?n.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):n.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")});t.setContent(e);r.dispose();r=null;t.getContent=o;a=t.body.firstChild;a||(t.body.innerHTML="<p>"+(i.ie?"":"<br/>")+"<\/p>");t.undoManger&&t.undoManger.save(!0);i.gecko&&(t.body.contentEditable=!0);try{t.selection.getRange().moveToAddress(s).select()}catch(v){}}this.fireEvent("sourcemodechanged",f)},queryCommandState:function(){return f|0},notNeedUndo:1};e=t.queryCommandState;t.queryCommandState=function(n){return(n=n.toLowerCase(),f)?n in{source:1,fullscreen:1}?e.apply(this,arguments):-1:e.apply(this,arguments)}}}();UM.plugins.enterkey=function(){var r,n=this,u=n.options.enterTag;n.addListener("keyup",function(u,f){var v=f.keyCode||f.which,o,h,c,a,s,e,l;if(v==13)if(o=n.selection.getRange(),h=o.startContainer,i.ie)n.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(r)){if(i.gecko)a=t.findParentByTagName(h,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0),a||(n.document.execCommand("formatBlock",!1,"<p>"),c=1);else if(h.nodeType==1){if(s=n.document.createTextNode(""),o.insertNode(s),e=t.findParentByTagName(s,"div",!0),e){for(l=n.document.createElement("p");e.firstChild;)l.appendChild(e.firstChild);e.parentNode.insertBefore(l,e);t.remove(e);o.setStartBefore(s).setCursor();c=1}t.remove(s)}n.undoManger&&c&&n.undoManger.save()}i.opera&&o.select()}});n.addListener("keydown",function(f,e){var l=e.keyCode||e.which,s;if(l==13){if(n.fireEvent("beforeenterkeydown")){t.preventDefault(e);return}if(n.fireEvent("saveScene",!0,!0),r="",s=n.selection.getRange(),!s.collapsed){var o=s.startContainer,a=s.endContainer,h=t.findParentByTagName(o,"td",!0),c=t.findParentByTagName(a,"td",!0);if(h&&c&&h!==c||!h&&c||h&&!c){e.preventDefault?e.preventDefault():e.returnValue=!1;return}}u=="p"&&(i.ie||(o=t.findParentByTagName(s.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),o||i.opera?(r=o.tagName,o.tagName.toLowerCase()=="p"&&i.gecko&&t.removeDirtyAttr(o)):(n.document.execCommand("formatBlock",!1,"<p>"),i.gecko&&(s=n.selection.getRange(),o=t.findParentByTagName(s.startContainer,"p",!0),o&&t.removeDirtyAttr(o)))))}})};UM.commands.preview={execCommand:function(){var t=window.open("","_blank",""),n=t.document;n.open();n.write("<html><head><\/head><body><div>"+this.getContent(null,null,!0)+"<\/div><\/body><\/html>");n.close()},notNeedUndo:1};UM.plugins.basestyle=function(){var n=this;n.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+shift+85",strikeThrough:"ctrl+shift+83"});n.addOutputRule(function(n){$.each(n.getNodesByTagName("b i u strike s"),function(n,t){switch(t.tagName){case"b":t.tagName="strong";break;case"i":t.tagName="em";break;case"u":t.tagName="span";t.setStyle("text-decoration","underline");break;case"s":case"strike":t.tagName="span";t.setStyle("text-decoration","line-through")}})});$.each(["bold","underline","superscript","subscript","italic","strikethrough"],function(t,r){n.commands[r]={execCommand:function(n){var i=this.selection.getRange(),t;return i.collapsed&&this.queryCommandState(n)!=1?(t=this.document.createElement({bold:"strong",underline:"u",superscript:"sup",subscript:"sub",italic:"em",strikethrough:"strike"}[n]),i.insertNode(t).setStart(t,0).setCursor(!1),!0):this.document.execCommand(n)},queryCommandState:function(n){if(i.gecko)return this.document.queryCommandState(n);var r=this.selection.getStartElementPath(),t=!1;return $.each(r,function(i,r){switch(n){case"bold":if(r.nodeName=="STRONG"||r.nodeName=="B")return t=1,!1;break;case"underline":if(r.nodeName=="U"||r.nodeName=="SPAN"&&$(r).css("text-decoration")=="underline")return t=1,!1;break;case"superscript":if(r.nodeName=="SUP")return t=1,!1;break;case"subscript":if(r.nodeName=="SUB")return t=1,!1;break;case"italic":if(r.nodeName=="EM"||r.nodeName=="I")return t=1,!1;break;case"strikethrough":if(r.nodeName=="S"||r.nodeName=="STRIKE"||r.nodeName=="SPAN"&&$(r).css("text-decoration")=="line-through")return t=1,!1}}),t}}})};UM.plugins.video=function(){function t(t,i,r,u,f,e){return e?'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+t+'" width="'+i+'" height="'+r+'"'+(f?' style="float:'+f+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':"<img "+(u?'id="'+u+'"':"")+' width="'+i+'" height="'+r+'" _url="'+t+'" class="edui-faked-video" src="'+n.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+n.options.UMEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(f?"float:"+f+";":"")+'" />'}function i(n,i){r.each(n.getNodesByTagName(i?"img":"embed"),function(n){if(n.getAttr("class")=="edui-faked-video"){var r=t(i?n.getAttr("_url"):n.getAttr("src"),n.getAttr("width"),n.getAttr("height"),null,n.getStyle("float")||"",i);n.parentNode.replaceChild(UM.uNode.createElement(r),n)}})}var n=this;n.addOutputRule(function(n){i(n,!0)});n.addInputRule(function(n){i(n)});n.commands.insertvideo={execCommand:function(i,u){var o,s,f,e,h;for(u=r.isArray(u)?u:[u],o=[],s="tmpVedio",f=0,h=u.length;f<h;f++)e=u[f],o.push(t(e.url,e.width||420,e.height||280,s+f,e.align,!1));n.execCommand("inserthtml",o.join(""),!0)},queryCommandState:function(){var t=n.selection.getRange().getClosedNode(),i=t&&t.className=="edui-faked-video";return i?1:0}}};UM.plugins.selectall=function(){var n=this;n.commands.selectall={execCommand:function(){var u=this,n=u.body,r=u.selection.getRange();r.selectNodeContents(n);t.isEmptyBlock(n)&&(i.opera&&n.firstChild&&n.firstChild.nodeType==1&&r.setStartAtFirst(n.firstChild),r.collapse(!0));r.select(!0)},notNeedUndo:1};n.addshortcutkey({selectAll:"ctrl+65"})};UM.plugins.removeformat=function(){var n=this;n.commands.removeformat={execCommand:function(){this.document.execCommand("removeformat")}}};UM.plugins.keystrokes=function(){var n=this,r=!0;n.addListener("keydown",function(u,f){var h=f.keyCode||f.which,e=n.selection.getRange(),s,o,v,l,a,y,c;if(!e.collapsed&&!(f.ctrlKey||f.shiftKey||f.altKey||f.metaKey)&&(h>=65&&h<=90||h>=48&&h<=57||h>=96&&h<=111||{13:1,8:1,46:1}[h])&&(s=e.startContainer,t.isFillChar(s)&&e.setStartBefore(s),s=e.endContainer,t.isFillChar(s)&&e.setEndAfter(s),e.txtToElmBoundary(),e.endContainer&&e.endContainer.nodeType==1&&(s=e.endContainer.childNodes[e.endOffset],s&&t.isBr(s)&&e.setEndAfter(s)),e.startOffset==0&&(s=e.startContainer,t.isBoundaryNode(s,"firstChild")&&(s=e.endContainer,e.endOffset==(s.nodeType==3?s.nodeValue.length:s.childNodes.length)&&t.isBoundaryNode(s,"lastChild"))))){n.fireEvent("saveScene");n.body.innerHTML="<p>"+(i.ie?"":"<br/>")+"<\/p>";e.setStart(n.body.firstChild,0).setCursor(!1,!0);n._selectionChange();return}if(h==8){if(e=n.selection.getRange(),r=e.collapsed,n.fireEvent("delkeydown",f))return;if(e.collapsed&&e.inFillChar()&&(o=e.startContainer,t.isFillChar(o)?(e.setStartBefore(o).shrinkBoundary(!0).collapse(!0),t.remove(o)):(o.nodeValue=o.nodeValue.replace(new RegExp("^"+t.fillChar),""),e.startOffset--,e.collapse(!0).select(!0))),o=e.getClosedNode()){n.fireEvent("saveScene");e.setStartBefore(o);t.remove(o);e.setCursor();n.fireEvent("saveScene");t.preventDefault(f);return}if(!i.ie&&(o=t.findParentByTagName(e.startContainer,"table",!0),v=t.findParentByTagName(e.endContainer,"table",!0),o&&!v||!o&&v||o!==v)){f.preventDefault();return}if(o=e.startContainer,e.collapsed&&o.nodeType==1&&(l=o.childNodes[e.startOffset-1],l&&l.nodeType==1&&l.tagName=="BR"&&(n.fireEvent("saveScene"),e.setStartBefore(l).collapse(!0),t.remove(l),e.select(),n.fireEvent("saveScene"))),i.chrome&&e.collapsed){while(e.startOffset==0&&!t.isEmptyBlock(e.startContainer))e.setStartBefore(e.startContainer);a=e.startContainer.childNodes[e.startOffset-1];a&&a.nodeName=="BR"&&(e.setStartBefore(a),n.fireEvent("saveScene"),$(a).remove(),e.setCursor(),n.fireEvent("saveScene"))}}if(i.gecko&&h==46&&(y=n.selection.getRange(),y.collapsed&&(o=y.startContainer,t.isEmptyBlock(o)))){for(c=o.parentNode;t.getChildCount(c)==1&&!t.isBody(c);)o=c,c=c.parentNode;o===c.lastChild&&f.preventDefault();return}});n.addListener("keyup",function(n,u){var a=u.keyCode||u.which,f,c=this,l,o,s,e,h;if(a==8){if(c.fireEvent("delkeyup"))return;if(f=c.selection.getRange(),f.collapsed){if(l=["h1","h2","h3","h4","h5","h6"],(e=t.findParentByTagName(f.startContainer,l,!0))&&t.isEmptyBlock(e)){if(o=e.previousSibling,o&&o.nodeName!="TABLE"){t.remove(e);f.setStartAtLast(o).setCursor(!1,!0);return}if(s=e.nextSibling,s&&s.nodeName!="TABLE"){t.remove(e);f.setStartAtFirst(s).setCursor(!1,!0);return}}t.isBody(f.startContainer)&&(e=t.createElement(c.document,"p",{innerHTML:i.ie?t.fillChar:"<br/>"}),f.insertNode(e).setStart(e,0).setCursor(!1,!0))}!r&&(f.startContainer.nodeType==3||f.startContainer.nodeType==1&&t.isEmptyBlock(f.startContainer))&&(i.ie?(h=f.document.createElement("span"),f.insertNode(h).setStartBefore(h).collapse(!0),f.select(),t.remove(h)):f.select())}})};UM.plugins.dropfile=function(){var n=this;n.setOpt("dropFileEnabled",!0);n.getOpt("dropFileEnabled")&&window.FormData&&window.FileReader&&n.addListener("ready",function(){n.$body.on("drop",function(t){try{var i=t.originalEvent.dataTransfer.files,r=!1;i&&($.each(i,function(t,i){var u,f;/^image/.test(i.type)&&(u=new XMLHttpRequest,u.open("post",n.getOpt("imageUrl"),!0),u.setRequestHeader("X-Requested-With","XMLHttpRequest"),f=new FormData,f.append(n.getOpt("imageFieldName")||"upfile",i),f.append("type","ajax"),u.send(f),u.addEventListener("load",function(t){var i=n.getOpt("imagePath")+t.target.response;i&&n.execCommand("insertimage",{src:i,_src:i})}),r=!0)}),r&&t.preventDefault())}catch(t){}}).on("dragover",function(n){n.originalEvent.dataTransfer.types[0]=="Files"&&n.preventDefault()})})},function(n){function f(t,r,u){if(t.prototype=n.extend2(n.extend({},r),(UM.ui[u]||i).prototype,!0),t.prototype.supper=(UM.ui[u]||i).prototype,UM.ui[u]&&UM.ui[u].prototype.defaultOpt){var f=UM.ui[u].prototype.defaultOpt,e=t.prototype.defaultOpt;t.prototype.defaultOpt=n.extend({},f,e||{})}return t}function e(i,r){n[t+r]=i;n.fn[t+r]=function(t){var r,u=Array.prototype.slice.call(arguments,1);return this.each(function(f,e){var s=n(e),o=s.edui();if(o||(i(!t||!n.isPlainObject(t)?{}:t,s),s.edui(o)),n.type(t)=="string")if(t=="this")r=o;else{if(r=o[t].apply(o,u),r!==o&&r!==undefined)return!1;r=null}}),r!==null?r:this}}var u;n.parseTmpl=function(n,t){var r="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+n.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(n,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(n,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj",r);return t?i(t):i};n.extend2=function(t){for(var f,r,i=arguments,e=n.type(i[i.length-1])=="boolean"?i[i.length-1]:!1,o=n.type(i[i.length-1])=="boolean"?i.length-1:i.length,u=1;u<o;u++){f=i[u];for(r in f)e&&t.hasOwnProperty(r)||(t[r]=f[r])}return t};n.IE6=!!window.ActiveXObject&&parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1])==6;var r=[],i=function(){},t="edui";i.prototype={on:function(t,i){this.root().on(t,n.proxy(i,this));return this},off:function(t,i){return this.root().off(t,n.proxy(i,this)),this},trigger:function(n,t){return this.root().trigger(n,t)===!1?!1:this},root:function(n){return this._$el||(this._$el=n)},destroy:function(){},data:function(n,i){return i!==undefined?(this.root().data(t+n,i),this):this.root().data(t+n)},register:function(t,i,u){r.push({evtname:t,$els:n.isArray(i)?i:[i],handler:n.proxy(u,i)})}};n.fn.edui=function(n){return n?this.data("eduiwidget",n):this.data("eduiwidget")};u=1;UM.ui={define:function(i,r,o){var s=UM.ui[i]=f(function(r,f){var o=function(){},e;if(n.extend(o.prototype,s.prototype,{guid:i+u++,widgetName:i}),e=new o,n.type(r)=="string")return e.init&&e.init({}),e.root().edui(e),e.root().find("a").click(function(n){n.preventDefault()}),e.root()[t+i].apply(e.root(),arguments);f&&e.root(f);e.init&&e.init(!r||n.isPlainObject(r)?n.extend2(r||{},e.defaultOpt||{},!0):r);try{e.root().find("a").click(function(n){n.preventDefault()})}catch(h){}return e.root().edui(e)},r,o);e(s,i)}};n(function(){n(document).on("click mouseup mousedown dblclick mouseover",function(t){n.each(r,function(i,r){r.evtname==t.type&&n.each(r.$els,function(i,u){u[0]===t.target||n.contains(u[0],t.target)||r.handler(t)})})})})}(l);UM.ui.define("button",{tpl:'<<%if(!texttype){%>div class="edui-btn edui-btn-<%=icon%> <%if(name){%>edui-btn-name-<%=name%><%}%>" unselectable="on" onmousedown="return false" <%}else{%>a class="edui-text-btn"<%}%><% if(title) {%> data-original-title="<%=title%>" <%};%>> '+'<% if(icon) {%><div unselectable="on" class="edui-icon-<%=icon%> edui-icon"><\/div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="edui-button-label"><%=text%><\/span><%}%>'+'<%if(caret && text){%><span class="edui-button-spacing"><\/span><%}%>'+'<% if(caret) {%><span unselectable="on" onmousedown="return false" class="edui-caret"><\/span><% };%><\/<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:!1,texttype:!1,click:function(){}},init:function(n){var t=this;return t.root($($.parseTmpl(t.tpl,n))).click(function(i){t.wrapclick(n.click,i)}),t.root().hover(function(){t.root().hasClass("disabled")||t.root().toggleClass("hover")}),t},wrapclick:function(n,t){return this.disabled()||(this.root().trigger("wrapclick"),$.proxy(n,this,t)()),this},label:function(n){return n===undefined?this.root().find(".edui-button-label").text():(this.root().find(".edui-button-label").text(n),this)},disabled:function(n){return n===undefined?this.root().hasClass("disabled"):(this.root().toggleClass("disabled",n),this.root().hasClass("disabled")&&this.root().removeClass("hover"),this)},active:function(n){return n===undefined?this.root().hasClass("active"):(this.root().toggleClass("active",n),this)},mergeWith:function(n){var t=this;t.data("$mergeObj",n);n.edui().data("$mergeObj",t.root());$.contains(document.body,n[0])||n.appendTo(t.root());t.on("click",function(){t.wrapclick(function(){n.edui().show()})}).register("click",t.root(),function(){n.hide()})}}),function(){UM.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ><\/div><\/div>',init:function(){var n=this.root($(this.tpl));this.data("$btnToolbar",n.find(".edui-btn-toolbar"))},appendToBtnmenu:function(n){var t=this.data("$btnToolbar");n=$.isArray(n)?n:[n];$.each(n,function(n,i){t.append(i)})}})}();UM.ui.define("menu",{show:function(n,t,i,r,u){(i=i||"position",this.trigger("beforeshow")!==!1)&&(this.root().css($.extend({display:"block"},n?{top:n[i]().top+(t=="right"?0:n.outerHeight())-(r||0),left:n[i]().left+(t=="right"?n.outerWidth():0)-(u||0)}:{})),this.trigger("aftershow"))},hide:function(n){var t;this.trigger("beforehide")!==!1&&((t=this.root().data("parentmenu"))&&(t.data("parentmenu")||n)&&t.edui().hide(),this.root().css("display","none"),this.trigger("afterhide"))},attachTo:function(n){var t=this;if(!n.data("$mergeObj")){n.data("$mergeObj",t.root());n.on("wrapclick",function(){t.show()});t.register("click",n,function(){t.hide()});t.data("$mergeObj",n)}}});UM.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" >'+"<%for(var i=0,ci;ci=data[i++];){%>"+'<%if(ci.divider){%><li class="edui-divider"><\/li><%}else{%>'+"<li <%if(ci.active||ci.disabled){%>class=\"<%= ci.active|| '' %> <%=ci.disabled||'' %>\" <%}%> data-value=\"<%= ci.value%>\">"+'<a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"><\/i><\/em><%= ci.label%><\/a>'+"<\/li><%}%>"+"<%}%>"+"<\/ul>",defaultOpt:{data:[],click:function(){}},init:function(n){var t=this,i={click:1,mouseover:1,mouseout:1};this.root($($.parseTmpl(this.tmpl,n))).on("click",'li[class!="disabled divider dropdown-submenu"]',function(i){$.proxy(n.click,t,i,$(this).data("value"),$(this))()}).find("li").each(function(r,u){var e=$(this),f;e.hasClass("disabled divider dropdown-submenu")||(f=n.data[r],$.each(i,function(n){f[n]&&e[n](function(i){$.proxy(f[n],u)(i,f,t.root)})}))})},disabled:function(n){$("li[class!=divider]",this.root()).each(function(){var t=$(this);n===!0?t.addClass("disabled"):$.isFunction(n)?t.toggleClass("disabled",n(li)):t.removeClass("disabled")})},val:function(n){var t;return $('li[class!="divider disabled dropdown-submenu"]',this.root()).each(function(){var i=$(this);if(n===undefined){if(i.find("em.edui-dropmenu-checked").length)return t=i.data("value"),!1}else i.find("em").toggleClass("edui-dropmenu-checked",i.data("value")==n)}),n===undefined?t:void 0},addSubmenu:function(n,t,i){i=i||0;var r=$("li[class!=divider]",this.root()),u=$('<li class="dropdown-submenu"><a tabindex="-1" href="#">'+n+"<\/a><\/li>").append(t);i>=0&&i<r.length?u.insertBefore(r[i]):i<0?u.insertBefore(r[0]):i>=r.length&&u.appendTo(r)}},"menu");UM.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"><\/div><%}%><%if(text){%><%=text%><%}%><\/div>'+'<div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"><\/div><\/div><\/div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(n){var t=this;return t.root($($.parseTmpl(t.tpl,n))),t.root().find(".edui-btn:first").click(function(){t.disabled()||$.proxy(n.click,t)()}),t.root().find(".edui-dropdown-toggle").click(function(){t.disabled()||t.trigger("arrowclick")}),t.root().hover(function(){t.root().hasClass("disabled")||t.root().toggleClass("hover")}),t},wrapclick:function(n,t){return this.disabled()||$.proxy(n,this,t)(),this},disabled:function(n){return n===undefined?this.root().hasClass("disabled"):(this.root().toggleClass("disabled",n).find(".edui-btn").toggleClass("disabled",n),this)},active:function(n){return n===undefined?this.root().hasClass("active"):(this.root().toggleClass("active",n).find(".edui-btn:first").toggleClass("active",n),this)},mergeWith:function(n){var t=this;t.data("$mergeObj",n);n.edui().data("$mergeObj",t.root());$.contains(document.body,n[0])||n.appendTo(t.root());t.root().delegate(".edui-dropdown-toggle","click",function(){t.wrapclick(function(){n.edui().show()})});t.register("click",t.root().find(".edui-dropdown-toggle"),function(){n.hide()})}});UM.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"><\/div><%}%><div class="edui-splitbutton-color-label" <%if (color) {%>style="background: <%=color%>"<%}%>><\/div><%if(text){%><%=text%><%}%><\/div>'+'<div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"><\/div><\/div><\/div>',defaultOpt:{color:""},init:function(n){var t=this;t.supper.init.call(t,n)},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label")}},"splitbutton");UM.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup"'+'<%if(!<%=stopprop%>){%>onmousedown="return false"<%}%>'+'><div class="edui-popup-body" unselectable="on" onmousedown="return false"><%=subtpl%><\/div>'+'<div class="edui-popup-caret"><\/div><\/div>',defaultOpt:{stopprop:!1,subtpl:"",width:"",height:""},init:function(n){return this.root($($.parseTmpl(this.tpl,n))),this},mergeTpl:function(n){return $.parseTmpl(this.tpl,{subtpl:n})},show:function(n,t){t||(t={});var i=t.fnname||"position";this.trigger("beforeshow")!==!1&&(this.root().css($.extend({display:"block"},n?{top:n[i]().top+(t.dir=="right"?0:n.outerHeight())-(t.offsetTop||0),left:n[i]().left+(t.dir=="right"?n.outerWidth():0)-(t.offsetLeft||0),position:"absolute"}:{})),this.root().find(".edui-popup-caret").css({top:t.caretTop||0,left:t.caretLeft||0,position:"absolute"}).addClass(t.caretDir||"up"),this.trigger("aftershow"))},hide:function(){this.root().css("display","none");this.trigger("afterhide")},attachTo:function(n,t){var i=this;if(!n.data("$mergeObj")){n.data("$mergeObj",i.root());n.on("wrapclick",function(){i.show(n,t)});i.register("click",n,function(){i.hide()});i.data("$mergeObj",n)}},getBodyContainer:function(){return this.root().find(".edui-popup-body")}});UM.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on"><span class="edui-scale-hand0"><\/span><span class="edui-scale-hand1"><\/span><span class="edui-scale-hand2"><\/span><span class="edui-scale-hand3"><\/span><span class="edui-scale-hand4"><\/span><span class="edui-scale-hand5"><\/span><span class="edui-scale-hand6"><\/span><span class="edui-scale-hand7"><\/span><\/div>',defaultOpt:{$doc:$(document),$wrap:$(document)},init:function(n){return n.$doc&&(this.defaultOpt.$doc=n.$doc),n.$wrap&&(this.defaultOpt.$wrap=n.$wrap),this.root($($.parseTmpl(this.tpl,n))),this.initStyle(),this.startPos=this.prePos={x:0,y:0},this.dragId=-1,this},initStyle:function(){r.cssRule("scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(n){var t=this,r=t.defaultOpt.$doc,i,u;switch(n.type){case"mousedown":i=n.target||n.srcElement;i.className.indexOf("edui-scale-hand")!=-1&&(t.dragId=i.className.slice(-1),t.startPos.x=t.prePos.x=n.clientX,t.startPos.y=t.prePos.y=n.clientY,r.bind("mousemove",$.proxy(t._eventHandler,t)));break;case"mousemove":t.dragId!=-1&&(t.updateContainerStyle(t.dragId,{x:n.clientX-t.prePos.x,y:n.clientY-t.prePos.y}),t.prePos.x=n.clientX,t.prePos.y=n.clientY,t.updateTargetElement());break;case"mouseup":t.dragId!=-1&&(t.dragId=-1,t.updateTargetElement(),u=t.data("$scaleTarget"),u.parent()&&t.attachTo(t.data("$scaleTarget")));r.unbind("mousemove",$.proxy(t._eventHandler,t))}},updateTargetElement:function(){var n=this,t=n.root(),i=n.data("$scaleTarget");i.css({width:t.width(),height:t.height()});n.attachTo(i)},updateContainerStyle:function(n,t){var f=this,i=f.root(),r,u=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];u[n][0]!=0&&(r=parseInt(i.offset().left)+t.x,i.css("left",f._validScaledProp("left",r)));u[n][1]!=0&&(r=parseInt(i.offset().top)+t.y,i.css("top",f._validScaledProp("top",r)));u[n][2]!=0&&(r=i.width()+u[n][2]*t.x,i.css("width",f._validScaledProp("width",r)));u[n][3]!=0&&(r=i.height()+u[n][3]*t.y,i.css("height",f._validScaledProp("height",r)))},_validScaledProp:function(n,t){var i=this.root(),r=this.defaultOpt.$doc,u=function(n,i,r){return n+i>r?r-i:t};t=isNaN(t)?0:t;switch(n){case"left":return t<0?0:u(t,i.width(),r.width());case"top":return t<0?0:u(t,i.height(),r.height());case"width":return t<=0?1:u(t,i.offset().left,r.width());case"height":return t<=0?1:u(t,i.offset().top,r.height())}},show:function(n){var t=this;n&&t.attachTo(n);t.root().bind("mousedown",$.proxy(t._eventHandler,t));t.defaultOpt.$doc.bind("mouseup",$.proxy(t._eventHandler,t));t.root().show();t.trigger("aftershow")},hide:function(){var n=this;n.root().unbind("mousedown",$.proxy(n._eventHandler,n));n.defaultOpt.$doc.unbind("mouseup",$.proxy(n._eventHandler,n));n.root().hide();n.trigger("afterhide")},attachTo:function(n){var t=this,r=n.offset(),u=t.root(),i=t.defaultOpt.$wrap,f=i.offset();t.data("$scaleTarget",n);t.root().css({position:"absolute",width:n.width(),height:n.height(),left:r.left-f.left-parseInt(i.css("border-left-width"))-parseInt(u.css("border-left-width")),top:r.top-f.top-parseInt(i.css("border-top-width"))-parseInt(u.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}});UM.ui.define("colorpicker",{tpl:function(n){for(var i="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(","),r='<div unselectable="on" onmousedown="return false" class="edui-colorpicker<%if (name){%> edui-colorpicker-<%=name%><%}%>" >'+'<table unselectable="on" onmousedown="return false"><tr><td colspan="10">'+n.lang_themeColor+'<\/td> <\/tr><tr class="edui-colorpicker-firstrow" >',t=0;t<i.length;t++)t&&t%10==0&&(r+="<\/tr>"+(t==60?'<tr><td colspan="10">'+n.lang_standardColor+"<\/td><\/tr>":"")+"<tr"+(t==60?' class="edui-colorpicker-firstrow"':"")+">"),r+=t<70?'<td><a unselectable="on" onmousedown="return false" title="'+i[t]+'" class="edui-colorpicker-colorcell" data-color="#'+i[t]+'" style="background-color:#'+i[t]+";border:solid #ccc;"+(t<10||t>=60?"border-width:1px;":t>=10&&t<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"><\/a><\/td>':"";return r+"<\/tr><\/table><\/div>"},init:function(n){var t=this;t.root($($.parseTmpl(t.supper.mergeTpl(t.tpl(n)),n)));t.root().on("click",function(n){t.trigger("pickcolor",$(n.target).data("color"))})}},"popup"),function(){var n="edui-combobox-item",i="edui-combobox-item-hover",r="edui-combobox-checked-icon",t="edui-combobox-item-label";UM.ui.define("combobox",function(){return{tpl:'<ul class="dropdown-menu edui-combobox-menu<%if (comboboxName!==\'\') {%> edui-combobox-<%=comboboxName%><%}%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu">'+"<%if(autoRecord) {%>"+"<%for( var i=0, len = recordStack.length; i<len; i++ ) {%>"+"<%var index = recordStack[i];%>"+'<li class="<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false">'+'<span class="edui-combobox-icon" unselectable="on" onmousedown="return false"><\/span>'+'<label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%><\/label>'+"<\/li>"+"<%}%>"+"<%if( i ) {%>"+'<li class="edui-combobox-item-separator"><\/li>'+"<%}%>"+"<%}%>"+"<%for( var i=0, label; label = items[i]; i++ ) {%>"+'<li class="<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false">'+'<span class="edui-combobox-icon" unselectable="on" onmousedown="return false"><\/span>'+'<label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%><\/label>'+"<\/li>"+"<%}%>"+"<\/ul>",defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:!0,recordCount:5},init:function(i){var u=this;$.extend(u._optionAdaptation(i),u._createItemMapping(i.recordStack,i.items),{itemClassName:n,iconClass:r,labelClassName:t});this._transStack(i);u.root($($.parseTmpl(u.tpl,i)));this.data("options",i).initEvent()},initEvent:function(){var n=this;n.initSelectItem();this.initItemActive()},initSelectItem:function(){var i=this,r="."+t;i.root().delegate("."+n,"click",function(){var t=$(this),n=t.attr("data-item-index");return i.trigger("comboboxselect",{index:n,label:t.find(r).text(),value:i.data("options").value[n]}).select(n),i.hide(),!1})},initItemActive:function(){var t={mouseenter:"addClass",mouseleave:"removeClass"};if($.IE6)this.root().delegate("."+n,"mouseenter mouseleave",function(n){$(this)[t[n.type]](i)}).one("afterhide",function(){})},select:function(n){var t=this.data("options").itemCount,i=this.data("options").autowidthitem;return(i&&!i.length&&(i=this.data("options").items),t==0)?null:(n<0?n=t+n%t:n>=t&&(n=t-1),this.trigger("changebefore",i[n]),this._update(n),this.trigger("changeafter",i[n]),null)},selectItemByLabel:function(n){var i=this.data("options").itemMapping,r=this,t=null;$.isArray(n)||(n=[n]);$.each(n,function(n,u){return t=i[u],t!==undefined?(r.select(t),!1):void 0})},_transStack:function(n){var i=[],t=-1,r=-1;$.each(n.recordStack,function(u,f){t=n.itemMapping[f];$.isNumeric(t)&&(i.push(t),f==n.selected&&(r=t))});n.recordStack=i;n.selected=r;i=null},_optionAdaptation:function(n){if(!("itemStyles"in n)){n.itemStyles=[];for(var t=0,i=n.items.length;t<i;t++)n.itemStyles.push("")}return n.autowidthitem=n.autowidthitem||n.items,n.itemCount=n.items.length,n},_createItemMapping:function(n,t){var i={},r={recordStack:[],mapping:{}};return $.each(t,function(n,t){i[t]=n}),r.itemMapping=i,$.each(n,function(n,t){i[t]!==undefined&&(r.recordStack.push(i[t]),r.mapping[t]=i[t])}),r},_update:function(n){var t=this.data("options"),i=[],r=null;$.each(t.recordStack,function(t,r){r!=n&&i.push(r)});i.unshift(n);i.length>t.recordCount&&(i.length=t.recordCount);t.recordStack=i;t.selected=n;r=$($.parseTmpl(this.tpl,t));this.root().html(r.html());r=null;i=null}}}(),"menu")}(),function(){UM.ui.define("buttoncombobox",function(){return{defaultOpt:{label:"",title:""},init:function(n){var t=this,i=$.eduibutton({caret:!0,name:n.comboboxName,title:n.title,text:n.label,click:function(){t.show(this.root())}});t.supper.init.call(t,n);t.on("changebefore",function(n,t){i.eduibutton("label",t)});t.data("button",i);t.attachTo(i)},button:function(){return this.data("button")}}}(),"combobox")}();UM.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" ><div class="edui-modal-header"><div class="edui-close" data-hide="modal"><\/div>'+'<h3 class="edui-title"><%=title%><\/h3>'+"<\/div>"+'<div class="edui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%>'+'<%if(height){%>height:<%=height%>px;<%}%>">'+" <\/div>"+"<% if(cancellabel || oklabel) {%>"+'<div class="edui-modal-footer"><div class="edui-modal-tip"><\/div>'+'<%if(oklabel){%><div class="edui-btn edui-btn-primary" data-ok="modal"><%=oklabel%><\/div><%}%>'+'<%if(cancellabel){%><div class="edui-btn" data-hide="modal"><%=cancellabel%><\/div><%}%>'+"<\/div>"+"<%}%><\/div>",defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:!0,keyboard:!0},init:function(n){var t=this;if(t.root($($.parseTmpl(t.tpl,n||{}))),t.data("options",n),n.okFn)t.on("ok",$.proxy(n.okFn,t));if(n.cancelFn)t.on("beforehide",$.proxy(n.cancelFn,t));t.root().delegate('[data-hide="modal"]',"click",$.proxy(t.hide,t)).delegate('[data-ok="modal"]',"click",$.proxy(t.ok,t));$('[data-hide="modal"],[data-ok="modal"]',t.root()).hover(function(){$(this).toggleClass("hover")})},toggle:function(){var n=this;return n[n.data("isShown")?"hide":"show"]()},show:function(){var n=this;(n.trigger("beforeshow"),n.data("isShown"))||(n.data("isShown",!0),n.escape(),n.backdrop(function(){n.autoCenter();n.root().show().focus().trigger("aftershow")}))},showTip:function(n){$(".edui-modal-tip",this.root()).html(n).fadeIn()},hideTip:function(){$(".edui-modal-tip",this.root()).fadeOut(function(){$(this).html("")})},autoCenter:function(){$.IE6||this.root().css("margin-left",-(this.root().width()/2))},hide:function(){var n=this;(n.trigger("beforehide"),n.data("isShown"))&&(n.data("isShown",!1),n.escape(),n.hideModal())},escape:function(){var n=this;if(n.data("isShown")&&n.data("options").keyboard)n.root().on("keyup",function(t){t.which==27&&n.hide()});else n.data("isShown")||n.root().off("keyup")},hideModal:function(){var n=this;n.root().hide();n.backdrop(function(){n.removeBackdrop();n.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(n){var t=this;t.data("isShown")&&t.data("options").backdrop&&(t.$backdrop=$('<div class="edui-modal-backdrop" />').click(t.data("options").backdrop=="static"?$.proxy(t.root()[0].focus,t.root()[0]):$.proxy(t.hide,t)));t.trigger("afterbackdrop");n&&n()},attachTo:function(n){var t=this;if(!n.data("$mergeObj")){n.data("$mergeObj",t.root());n.on("click",function(){t.toggle(n)});t.data("$mergeObj",n)}},ok:function(){var n=this;(n.trigger("beforeok"),n.trigger("ok",n)!==!1)&&n.hide()},getBodyContainer:function(){return this.root().find(".edui-modal-body")}});UM.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"><\/div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"><\/div><\/div>',init:function(n){var t=this;t.root($($.parseTmpl(t.tpl,n||{})))},content:function(n){var t=this,i=$(n.currentTarget).attr("data-original-title");t.root().find(".edui-tooltip-inner").text(i)},position:function(n){var i=this,t=$(n.currentTarget);i.root().css($.extend({display:"block"},t?{top:t.outerHeight(),left:(t.outerWidth()-i.root().outerWidth())/2}:{}))},show:function(n){if(!$(n.currentTarget).hasClass("disabled")){var t=this;t.content(n);t.root().appendTo($(n.currentTarget));t.position(n);t.root().css("display","block").addClass("in bottom")}},hide:function(){var n=this;n.root().removeClass("in bottom").css("display","none")},attachTo:function(n){function i(n){var t=this;$.contains(document.body,t.root()[0])||t.root().appendTo(n);t.data("tooltip",t.root());n.each(function(){if($(this).attr("data-original-title"))$(this).on("mouseenter",$.proxy(t.show,t)).on("mouseleave click",$.proxy(t.hide,t))})}var t=this;$.type(n)==="undefined"?$("[data-original-title]").each(function(n,r){i.call(t,$(r))}):n.data("tooltip")||i.call(t,n)}});UM.ui.define("tab",{init:function(n){var t=this,i=n.selector;if($.type(i)){t.root($(i,n.context));t.data("context",n.context);$(i,t.data("context")).on("click",function(n){t.show(n)})}},show:function(n){var t=this,i=$(n.target),o=i.closest("ul"),r,u,f,n,e;(r=i.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""),e=i.parent("li"),e.length&&!e.hasClass("active"))&&((u=o.find(".active:last a")[0],n=$.Event("beforeshow",{target:i[0],relatedTarget:u}),t.trigger(n),n.isDefaultPrevented())||(f=$(r,t.data("context")),t.activate(i.parent("li"),o),t.activate(f,f.parent(),function(){t.trigger({type:"aftershow",relatedTarget:u})})))},activate:function(n,t,i){if(n===undefined)return $(".edui-tab-item.active",this.root()).index();var r=t.find("> .active");r.removeClass("active");n.addClass("active");i&&i()}});UM.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ><\/div>',init:function(n){var t=this;return t.root($($.parseTmpl(t.tpl,n))),t}}),function(){var f={},n={},e=[],s=null,u={},t={},o={};r.extend(UM,{defaultWidth:500,defaultHeight:500,registerUI:function(n,t){r.each(n.split(/\s+/),function(n){f[n]=t})},setEditor:function(t){n[t.id]||(n[t.id]=t)},registerWidget:function(n,i,r){u[n]=$.extend2(i,{$root:"",_preventDefault:!1,root:function(n){return this.$root||(this.$root=n)},preventDefault:function(){this._preventDefault=!0},clear:!1});r&&(t[n]=r)},getWidgetData:function(n){return u[n]},setWidgetBody:function(n,i,f){var e,o;if(f._widgetData||(f._widgetData={},f.getWidgetData=function(n){return this._widgetData[n]},f.getWidgetCallback=function(n){return t[n]}),e=u[n],!e)return null;e=f._widgetData[n];e||(e=u[n],e=f._widgetData[n]=$.type(e)=="function"?e:r.clone(e));e.root(i.edui().getBodyContainer());e.initContent(f,i);e._preventDefault||e.initEvent(f,i);e.width&&i.width(e.width);o=t[n];o&&!o.init&&(t[n]=function(){var n=Array.prototype.slice.call(arguments,0);o.apply(f,[f,i].concat(n))},t[n].init=!0)},setActiveWidget:function(n){s=n},getEditor:function(t,i){return n[t]||(n[t]=this.createEditor(t,i))},clearCache:function(t){n[t]&&delete n[t]},delEditor:function(t){var i;(i=n[t])&&i.destroy()},ready:function(n){e.push(n)},createEditor:function(n,t){function u(){var r=this.createUI("#"+n,i),t;i.key=n;i.ready(function(){$.each(e,function(n,t){$.proxy(t,i)()})});t=i.options;t.minFrameWidth=t.initialFrameWidth?t.initialFrameWidth:t.initialFrameWidth=i.$body.width()||UM.defaultWidth;r.css({width:t.initialFrameWidth,zIndex:i.getOpt("zIndex")});UM.browser.ie&&UM.browser.version===6&&document.execCommand("BackgroundImageCache",!1,!0);i.render(n);$.eduitooltip&&$.eduitooltip("attachTo").css("z-index",i.getOpt("zIndex")+1);r.find("a").click(function(n){n.preventDefault()});i.fireEvent("afteruiready")}var i=new UM.Editor(t),r=this;return i.langIsReady?$.proxy(u,r)():i.addListener("langReady",$.proxy(u,r)),i},createUI:function(n,t){var u=$(n),r=$('<div class="edui-container"><div class="edui-editor-body"><\/div><\/div>').insertBefore(u),e;return t.$container=r,t.container=r[0],t.$body=u,i.ie&&i.ie9above&&(e=$('<span style="padding:0;margin:0;height:0;width:0"><\/span>'),e.insertAfter(r)),$.each(f,function(n,i){var r=i.call(t,n);r&&(o[n]=r)}),r.find(".edui-editor-body").append(u).before(this.createToolbar(t.options,t)),r.find(".edui-toolbar").append($('<div class="edui-dialog-container"><\/div>')),r},createToolbar:function(n){var i=$.eduitoolbar(),r=i.edui(),t;return n.toolbar&&n.toolbar.length?(t=[],$.each(n.toolbar,function(n,i){$.each(i.split(/\s+/),function(n,i){if(i=="|")$.eduiseparator&&t.push($.eduiseparator());else{var r=o[i];i=="fullscreen"?r&&t.unshift(r):r&&t.push(r)}});t.length&&r.appendToBtnmenu(t)})):i.find(".edui-btn-toolbar").remove(),i}})}();UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal",function(n){var i=this,t=$.eduibutton({icon:n,click:function(){i.execCommand(n)},title:this.getLang("labelMap")[n]||""});return this.addListener("selectionchange",function(){var i=this.queryCommandState(n);t.edui().disabled(i==-1).active(i==1)}),t}),function(){function n(n){var t=this;if(!n)throw new Error("invalid params, notfound editor");t.editor=n;i[n.uid]=this;n.addListener("destroy",function(){delete i[n.uid];t.editor=null})}var r={},u=["width","height","position","top","left","margin","padding","overflowX","overflowY"],f={},e={},o={},i={};UM.registerUI("fullscreen",function(t){var i=this,r=$.eduibutton({icon:"fullscreen",title:i.options.labelMap&&i.options.labelMap[t]||i.getLang("labelMap."+t),click:function(){i.execCommand(t)}});return i.addListener("selectionchange",function(){var n=this.queryCommandState(t);r.edui().disabled(n==-1).active(n==1)}),i.addListener("ready",function(){i.options.fullscreen&&n.getInstance(i).toggle()}),r});UM.commands.fullscreen={execCommand:function(){n.getInstance(this).toggle()},queryCommandState:function(){return this._edui_fullscreen_status},notNeedUndo:1};n.prototype={toggle:function(){var n=this.editor,t=this.isFullState();n.fireEvent("beforefullscreenchange",!t);this.update(!t);t?this.revert():this.enlarge();n.fireEvent("afterfullscreenchange",!t);n.body.contentEditable==="true"&&n.fireEvent("fullscreenchanged",!t);n.fireEvent("selectionchange")},enlarge:function(){this.saveSataus();this.setDocumentStatus();this.resize()},revert:function(){var n=this.editor.options,t=/%$/.test(n.initialFrameHeight)?"100%":n.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width");$.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+t+' ? "'+t+'px" : "auto"');this.revertContainerStatus();this.revertContentAreaStatus();this.revertDocumentStatus()},update:function(n){this.editor._edui_fullscreen_status=n},resize:function(){var u=null,f=0,e=0,r=0,s=0,i=this.editor,h=this,o=null,n=null;this.isFullState()&&(u=$(window),e=u.width(),f=u.height(),n=this.getEditorHolder(),r=parseInt(t.getComputedStyle(n,"border-width"),10)||0,r+=parseInt(t.getComputedStyle(i.container,"border-width"),10)||0,s+=parseInt(t.getComputedStyle(n,"padding-left"),10)+parseInt(t.getComputedStyle(n,"padding-right"),10)||0,$.IE6&&n.style.setExpression("height",null),o=this.getBound(),$(i.container).css({width:e+"px",height:f+"px",position:$.IE6?"absolute":"fixed",top:o.top,left:o.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"}),$(n).css({width:e-2*r-s+"px",height:f-2*r-(i.options.withoutToolbar?0:$(".edui-toolbar",i.container).outerHeight())-$(".edui-bottombar",i.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"}))},saveSataus:function(){for(var f=this.editor.container.style,n=null,i={},t=0,e=u.length;t<e;t++)n=u[t],i[n]=f[n];r[this.editor.uid]=i;this.saveContentAreaStatus();this.saveDocumentStatus()},saveContentAreaStatus:function(){var n=$(this.getEditorHolder());f[this.editor.uid]={width:n.css("width"),overflowX:n.css("overflowX"),overflowY:n.css("overflowY"),height:n.css("height")}},saveDocumentStatus:function(){var n=$(this.getEditorDocumentBody());e[this.editor.uid]={overflowX:n.css("overflowX"),overflowY:n.css("overflowY")};o[this.editor.uid]={overflowX:$(this.getEditorDocumentElement()).css("overflowX"),overflowY:$(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){$(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var n=this.getEditorHolder(),t=this.getContentAreaStatus();this.supportMin()&&(delete t.height,n.style.height=null);$(n).css(t)},revertDocumentStatus:function(){var n=this.getDocumentStatus();$(this.getEditorDocumentBody()).css("overflowX",n.body.overflowX);$(this.getEditorDocumentElement()).css("overflowY",n.html.overflowY)},setDocumentStatus:function(){$(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"});$(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return!!this.editor._edui_fullscreen_status},getEditorStatus:function(){return r[this.editor.uid]},getContentAreaStatus:function(){return f[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:e[this.editor.uid],html:o[this.editor.uid]}},supportMin:function(){var n=null;return this._support||(n=document.createElement("div"),this._support="minWidth"in n.style,n=null),this._support},getBound:function(){var n={html:!0,body:!0},t={top:0,left:0},i=null;return $.IE6?(i=this.editor.container.offsetParent,i&&!n[i.nodeName.toLowerCase()]&&(n=i.getBoundingClientRect(),t.top=-n.top,t.left=-n.left),t):t},getStyleValue:function(n){return parseInt(t.getComputedStyle(this.getEditorHolder(),n))}};$.extend(n,{listen:function(){var t=null;if(!n._hasFullscreenListener){n._hasFullscreenListener=!0;$(window).on("resize",function(){t!==null&&(window.clearTimeout(t),t=null);t=window.setTimeout(function(){for(var n in i)i[n].resize();t=null},50)})}},getInstance:function(t){return i[t.uid]||new n(t),i[t.uid]}});n.listen()}();UM.registerUI("link image map insertvideo",function(n){var t=this,f,u,o={insertvideo:"video"}[n]||n,i={title:t.options.labelMap&&t.options.labelMap[n]||t.getLang("labelMap."+n),url:t.options.UMEDITOR_HOME_URL+"dialogs/"+o+"/"+o+".js"},e=$.eduibutton({icon:n,title:this.getLang("labelMap")[n]||""});return r.loadFile(document,{src:i.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var r=UM.getWidgetData(n),o,s;r.buttons&&(o=r.buttons.ok,o&&(i.oklabel=o.label||t.getLang("ok"),o.exec&&(i.okFn=function(){return $.proxy(o.exec,null,t,u)()})),s=r.buttons.cancel,s&&(i.cancellabel=s.label||t.getLang("cancel"),s.exec&&(i.cancelFn=function(){return $.proxy(s.exec,null,t,u)()})));r.width&&(i.width=r.width);r.height&&(i.height=r.height);u=$.eduimodal(i);u.attr("id","edui-dialog-"+n).find(".edui-modal-body").addClass("edui-dialog-"+n+"-body");u.edui().on("beforehide",function(){var n=t.selection.getRange();n.equals(f)&&n.select()}).on("beforeshow",function(){var i=this.root(),e=null,r=null;f=t.selection.getRange();i.parent()[0]||t.$container.find(".edui-dialog-container").append(i);$.IE6&&(e={width:$(window).width(),height:$(window).height()},r=i.parents(".edui-toolbar")[0].getBoundingClientRect(),i.css({position:"absolute",margin:0,left:(e.width-i.width())/2-r.left,top:100-r.top}));UM.setWidgetBody(n,u,t)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",t.getOpt("zIndex")+1).appendTo(t.$container.find(".edui-dialog-container"));u.css("zIndex",t.getOpt("zIndex")+2)}).on("beforeok",function(){try{f.select()}catch(n){}}).attachTo(e)}),t.addListener("selectionchange",function(){var t=this.queryCommandState(n);e.edui().disabled(t==-1).active(t==1)}),e});UM.registerUI("emotion",function(n){var t=this,u=t.options.UMEDITOR_HOME_URL+"dialogs/"+n+"/"+n+".js",i=$.eduibutton({icon:n,title:this.getLang("labelMap")[n]||""});return r.loadFile(document,{src:u,tag:"script",type:"text/javascript",defer:"defer"},function(){var f={url:u},r=UM.getWidgetData(n);r.width&&(f.width=r.width);r.height&&(f.height=r.height);$.eduipopup(f).css("zIndex",t.options.zIndex+1).edui().on("beforeshow",function(){var i=this.root();i.parent().length||t.$container.find(".edui-dialog-container").append(i);UM.setWidgetBody(n,i,t)}).attachTo(i,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8});t.addListener("selectionchange",function(){var n=this.queryCommandState("emotion");i.edui().disabled(n==-1).active(n==1)})}),i});UM.registerUI("imagescale",function(){var n=this,t;n.setOpt("imageScaleEnabled",!0);i.webkit&&n.getOpt("imageScaleEnabled")&&(n.addListener("click",function(){var e=n.selection.getRange(),r=e.getClosedNode(),i,u,f;if(r&&r.tagName=="IMG"){if(!t){t=$.eduiscale({$wrap:n.$container}).css("zIndex",n.options.zIndex);n.$container.append(t);i=function(){t.edui().hide()};u=function(n){var t=n.target||n.srcElement;t&&t.className.indexOf("edui-scale")==-1&&i(n)};t.edui().on("aftershow",function(){$(document).bind("keydown",i);$(document).bind("mousedown",u);n.selection.getNative().removeAllRanges()}).on("afterhide",function(){$(document).unbind("keydown",i);$(document).unbind("mousedown",u);var r=t.edui().getScaleTarget();r.parentNode&&n.selection.getRange().selectNode(r).select()}).on("mousedown",function(i){n.selection.getNative().removeAllRanges();var r=i.target||i.srcElement;r&&r.className.indexOf("edui-scale-hand")==-1&&(f=setTimeout(function(){t.edui().hide()},200))}).on("mouseup",function(n){var t=n.target||n.srcElement;t&&t.className.indexOf("edui-scale-hand")==-1&&clearTimeout(f)})}t.edui().show($(r))}else t&&t.css("display")!="none"&&t.edui().hide()}),n.addListener("click",function(t,i){if(i.target.tagName=="IMG"){var r=new f.Range(n.document,n.body);r.selectNode(i.target).select()}}))});UM.registerUI("autofloat",function(){var n=this,e=n.getLang(),f,u;(n.setOpt({topOffset:0}),f=n.options.autoFloatEnabled!==!1,u=n.options.topOffset,f)&&n.ready(function(){function w(){return UM.ui?1:(alert(e.autofloatMsg),0)}function b(){var n=document.body.style;n.backgroundImage='url("about:blank")';n.backgroundAttachment="fixed"}function d(){if(!h){var e=t.getXY(f),r=t.getComputedStyle(f,"position"),o=t.getComputedStyle(f,"left");f.style.width=f.offsetWidth+"px";f.style.zIndex=n.options.zIndex*1+1;f.parentNode.insertBefore(s,f);c||p&&i.ie?(f.style.position!="absolute"&&(f.style.position="absolute"),f.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-a+u+"px"):f.style.position!="fixed"&&(f.style.position="fixed",f.style.top=u+"px",(r=="absolute"||r=="relative")&&parseFloat(o)&&(f.style.left=e.x+"px"))}}function v(){s.parentNode&&s.parentNode.removeChild(s);f.style.cssText=l}function o(){var t=k(n.container),i=n.options.toolbarTopOffset||0;t.top<0&&t.bottom-f.offsetHeight>i?d():v()}var c=i.ie&&i.version<=6,p=i.quirks,l,s=document.createElement("div"),f,a,k=function(n){var i,r,u;try{i=n.getBoundingClientRect()}catch(f){i={left:0,top:0,height:0,width:0}}for(r={left:Math.round(i.left),top:Math.round(i.top),height:Math.round(i.bottom-i.top),width:Math.round(i.right-i.left)};(u=n.ownerDocument)!==document&&(n=t.getWindow(u).frameElement);)i=n.getBoundingClientRect(),r.left+=i.left,r.top+=i.top;return r.bottom=r.top+r.height,r.right=r.left+r.width,r},h=!1,y=r.defer(function(){o()},i.ie?200:100,!0);if(n.addListener("destroy",function(){t.un(window,["scroll","resize"],o);n.removeListener("keydown",y)}),w(n)){f=$(".edui-toolbar",n.container)[0];n.addListener("afteruiready",function(){setTimeout(function(){a=$(f).offset().top},100)});l=f.style.cssText;s.style.height=f.offsetHeight+"px";c&&b();t.on(window,["scroll","resize"],o);n.addListener("keydown",y);n.addListener("beforefullscreenchange",function(n,t){t&&(v(),h=t)});n.addListener("fullscreenchanged",function(n,t){t||o();h=t});n.addListener("sourcemodechanged",function(){setTimeout(function(){o()},0)});n.addListener("clearDoc",function(){setTimeout(function(){o()},0)})}})});UM.registerUI("source",function(n){var t=this,i;return t.addListener("fullscreenchanged",function(){t.$container.find("textarea").width(t.$body.width()-10).height(t.$body.height())}),i=$.eduibutton({icon:n,click:function(){t.execCommand(n)},title:this.getLang("labelMap")[n]||""}),this.addListener("selectionchange",function(){var t=this.queryCommandState(n);i.edui().disabled(t==-1).active(t==1)}),i});UM.registerUI("paragraph fontfamily fontsize",function(n){function f(n,t){var i=$("<span>").html(n).css({display:"inline",position:"absolute",top:-1e7,left:-1e5}).appendTo(document.body),r=i.width();return i.remove(),i=null,r<50?n:(n=n.slice(0,t?-4:-1),!n.length)?"...":f(n+"...",!0)}function o(n){var i=[];for(var t in n.items)n.value.push(t),i.push(t),n.autowidthitem.push(f(t));return n.items=i,n.autoRecord=!1,n}function s(n){for(var t=null,r=[],i=0,u=n.items.length;i<u;i++)t=n.items[i].val,r.push(t.split(/\s*,\s*/)[0]),n.itemStyles.push("font-family: "+t),n.value.push(t),n.autowidthitem.push(f(r[i]));return n.items=r,n}function h(n){var i=null,r=[],t,u;for(n.itemStyles=[],n.value=[],t=0,u=n.items.length;t<u;t++)i=n.items[t],r.push(i),n.itemStyles.push("font-size: "+i+"px");return n.value=n.items,n.items=r,n.autoRecord=!1,n}var t=this,e=t.options.labelMap&&t.options.labelMap[n]||t.getLang("labelMap."+n),i={label:e,title:e,comboboxName:n,items:t.options[n]||[],itemStyles:[],value:[],autowidthitem:[]},u=null,r=null;switch(n){case"paragraph":i=o(i);break;case"fontfamily":i=s(i);break;case"fontsize":i=h(i)}u=$.eduibuttoncombobox(i).css("zIndex",t.getOpt("zIndex")+1);r=u.edui();r.on("comboboxselect",function(i,r){t.execCommand(n,r.value)}).on("beforeshow",function(){u.parent().length===0&&u.appendTo(t.$container.find(".edui-dialog-container"))});return this.addListener("selectionchange",function(){var i=this.queryCommandState(n),t=this.queryCommandValue(n);r.button().edui().disabled(i==-1).active(i==1);t&&(t=t.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/),r.selectItemByLabel(t))}),r.button().addClass("edui-combobox")});UM.registerUI("forecolor backcolor",function(n){function e(){return t.getComputedStyle(f[0],"background-color")}var i=this,u=null,f=null,r=null;return this.addListener("selectionchange",function(){var t=this.queryCommandState(n);r.edui().disabled(t==-1).active(t==1)}),r=$.eduicolorsplitbutton({icon:n,caret:!0,name:n,title:i.getLang("labelMap")[n],click:function(){i.execCommand(n,e())}}),f=r.edui().colorLabel(),u=$.eduicolorpicker({name:n,lang_clearColor:i.getLang("clearColor")||"",lang_themeColor:i.getLang("themeColor")||"",lang_standardColor:i.getLang("standardColor")||""}).on("pickcolor",function(t,r){window.setTimeout(function(){f.css("backgroundColor",r);i.execCommand(n,r)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",i.getOpt("zIndex")+1),r.edui().on("arrowclick",function(){u.parent().length||i.$container.find(".edui-dialog-container").append(u);u.edui().show(r,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8})}).register("click",r,function(){u.edui().hide()}),r})});
/*
//# sourceMappingURL=umeditor.min.js.map
*/