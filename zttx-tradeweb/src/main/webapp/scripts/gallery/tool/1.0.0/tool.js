define("gallery/tool/1.0.0/tool",["gallery/underscore/1.6.0/underscore","arale/dialog/1.2.5/dialog","gallery/template/1.0.1/template"],function(a,b,c){var d=a("gallery/underscore/1.6.0/underscore"),e=a("arale/dialog/1.2.5/dialog"),f=a("gallery/template/1.0.1/template");"undefined"==typeof window.console&&(window.console={},$.each(["log","error","dir"],function(a,b){"undefined"==typeof window.console[b]&&(window.console[b]=function(){})}));var g={SUCCESS:126e3,VALIDERR:126047,unparam:function(a){var b,c,d={},e=a.indexOf("?")>-1?a.split("?")[1]:a,f=e.split("&");for(c=0;c<f.length;c++)b=f[c].split("="),d[b[0]]=decodeURIComponent(b[1]).replace(/\+/g," ");return d},isIE:function(){return/msie/.test(navigator.userAgent.toLowerCase())},isIE6:function(){return/msie 6\.0/i.test(navigator.userAgent.toLowerCase())},ajax:function(a){function b(){d&&$("[type='submit']",a.form).removeAttr("disabled").css({backgroundColor:e})}var c=this,d=!("submit"!=a.type||!a.form),e="";if(d){var f=$("[type='submit']",a.form);e=f.css("backgroundColor"),f.attr({disabled:"true"}).css({backgroundColor:"#ccc"})}$.ajax({url:a.url,method:a.method||"post",data:a.data||{},dataType:"json",timeout:a.timeout||3e3,success:function(d){b(),d.code==c.SUCCESS?a.successFn&&$.isFunction(a.successFn)&&a.successFn(d):c.remind("error",d.message)},statusCode:{403:function(){c.remind("error","安全密钥已过期，请重新刷新页面！",function(){b()})},404:function(){c.remind("error","page not found",function(){b()})},500:function(){c.remind("error","服务器内部出错",function(){b()})}},error:function(a,d){("timeout"==d||"error"==d)&&c.remind("error","请求超时",function(){b()})}})},remind:function(a,b,c,d){$.isFunction(c)&&(d=c),c=c||1600,this._remindFn(a,b,c,d)},_remindFn:function(a,b,c,g){var h="success,error";if(-1!=d.indexOf(h.split(","),a)){var i='<div style="border: #bababa solid 1px;background: #fff;box-shadow: 0 0 3px rgba(0,0,0,.4);"><div style="font-size: 18px;line-height: 42px;padding: 10px 15px;"><i style="display: inline-block;height: 42px;margin-right: 10px;vertical-align: middle;width: 42px;{{style}}"></i><span>{{message}}</span></div></div>',j=f.compile(i),k=j({type:a,message:b,style:function(){var b="";return"success"==a?b="background: url(/images/common/remind_icon.png) 0 0 no-repeat;":"error"==a&&(b="background: url(/images/common/remind_icon.png) 0 -50px no-repeat;"),b}()}),l=new e({content:k,hasMask:!1,classPrefix:"remindDialog",closeTpl:"",width:"auto"});l.after("show",function(){setTimeout(function(){l.hide(),$.isFunction(g)&&g()},c)}),l.show()}},confirmDialog:function(a){var b=d.uniqueId("confirmDialog_"),c=a.title||"提示",f=a.content||"",g=/<([^>]*)>/;g.test(f)||(f='<p class="ta-c mt20 fz14">'+f+"</p>");var h='<div id="confirmDialog_'+b+'">'+'<div class="ui-head"><h3>'+c+"</h3></div>"+'<div class="confirm_bd">'+f+'<div class="operate"><a class="confirm_btn" href="javascript:;">确定</a>';h+=0==a.hasCancel?"</div></div></div>":'<a class="cancel_btn" href="javascript:;">取消</a></div></div></div>';var i=new e({content:h,effect:a.effect||"fade",width:a.width||256,classPrefix:a.classPrefix||"ui-dialog"}).before("show",function(){a.beforeFn&&$.isFunction(a.beforeFn)&&a.beforeFn()}).show();$(document).on("click","#confirmDialog_"+b+" .confirm_btn",function(b){b.preventDefault(),0==a.isClose||i.hide(),a.clickFn&&$.isFunction(a.clickFn)&&a.clickFn(i)}),$(document).on("click","#confirmDialog_"+b+" .cancel_btn",function(){a.hideFn&&$.isFunction(a.hideFn)&&a.hideFn(i),i.hide()})},selectBox:function(a){if(!this.isIE6()){var b=$(a).parent();b.find("select").length>1&&$(a).wrap('<div class="inline-block"></div>'),b=$(a).parent(),b.hasClass("pr")||b.addClass("pr"),$(a).css({opacity:0,position:"absolute",left:0,top:0,filter:"alpha(opacity=0)"});var c="",d=$(a).attr("name"),e=$(a).attr("id");if(d)c=d;else{if(!e)return console.error("没找到select的name或者ID值"),void 0;c=e}$('<div id="'+c+'_div" class="common_select_box"><span class="fn-text-overflow">'+$(a).find("option:selected").text()+'</span><i class="arrow"></i></div>').insertBefore($(a)),$("#"+c+"_div .arrow").css("top",$(a).outerHeight()/2-3),$("#"+c+"_div").css({width:$(a).outerWidth()-2,height:$(a).outerHeight()-2,"line-height":$(a).outerHeight()-2+"px"}),$("#"+c+"_div span").css("width",$(a).outerWidth()-20),$(a).on("change",function(){$("#"+c+"_div span").html($(a).find("option:selected").text())})}},selectComplexBox:function(a){var b=$(a).data("height")||30;seajs.use(["select"],function(c){var d=new c({trigger:$(a),width:$(a).outerWidth(),triggerTpl:'<div class="common_select_box"><span class="fn-text-overflow" data-role="trigger-content"></span><i class="arrow"></i></div>',maxHeight:200}).before("render",function(){var c=this.get("trigger");c.css("height",b),c.css("line-height",b+"px"),c.find(".arrow").css("top",b/2-3),c.find("span").css("width",$(a).outerWidth()-20),$(a).data("select",d)});d.on("change",function(){$(a).trigger("change")}),d.render()})},renderSelect:function(a){if("string"==$.type(a)){var b=$(a).attr("name");$("#"+b+"_div span").html($(a).find("option:selected").text())}"array"==$.type(a)&&$.each(a,function(a,b){var c=$(b).attr("name");$("#"+c+"_div span").html($(b).find("option:selected").text())});var b=$(a).attr("name");$("#"+b+"_div span").html($(a).find("option:selected").text())},uploadFiles:function(a){var b=this;"string"==$.type(a.ids)?$("#"+a.ids).bind("change",function(){b._uploadFile($(this).attr("id"),a.url,a.successFn)}):"array"==$.type(a.ids)&&$.each(a.ids,function(c,d){$("#"+d).bind("change",function(){b._uploadFile($(this).attr("id"),a.url,a.successFn)})})},_uploadFile:function(a,b,c){var d=this;seajs.use(["ajaxFileUpload"],function(){var f=window.uploadLodingDialog||new e({content:'<div style="padding:10px;background: #fff;border:1px solid #ddd;"><h3 style="line-height: 2;">文件上传中..请稍后</h3><img src="/images/common/012.gif" /></div>',classPrefix:"zttx-dialog",closeTpl:"",width:"auto"});f.after("show",function(){$.ajaxFileUpload({url:b||"/common/showImg",secureuri:!1,fileElementId:a,dataType:"json",success:function(b){f.hide(),$("#"+a).bind("change",function(){d._uploadFile(a)}),b.code==zttx.SUCCESS?c(a,b):d.remind("error",b.message)}})}),f.show(),window.uploadLodingDialog=f})},scrollArea:function(a){seajs.use("jscroll",function(){$(a).jscrollbar({width:"5"})})},baseCalendar:function(a){seajs.use(["my97DatePicker"],function(){$(a.elem).addClass(a.className||"hasDatepicker"),$(a.elem).on("click",function(){if(a.fromNow){var b=$.extend(a.json||{},{minDate:"%y-%M-%d"});WdatePicker(b)}else WdatePicker(a.json||{})})})},rangeCalendar:function(a,b,c){var c="undefined"==typeof c?"hasDatepicker":c;$("#"+a.elem).add("#"+b.elem).addClass(c),seajs.use(["my97DatePicker"],function(){$("#"+a.elem).on("focus",function(){a.fromNow?WdatePicker({maxDate:"#F{$dp.$D('"+b.elem+"')}",minDate:"%y-%M-%d"}):WdatePicker({maxDate:"#F{$dp.$D('"+b.elem+"')}"})}),$("#"+b.elem).on("focus",function(){b.endNow?WdatePicker({minDate:"#F{$dp.$D('"+a.elem+"')}",maxDate:"%y-%M-%d"}):WdatePicker({minDate:"#F{$dp.$D('"+a.elem+"')}"})})})},setErrMsg:function(a){$.each(a,function(a,b){var c=null;c=$("#"+b.errName).length>0?$("#"+b.errName,form):$("[name='"+b.errName+"']",form);var d=c.parents(".ui-form-item");d.addClass("ui-form-item-error");var e=$(".ui-form-explain",d);0==e.length?$('<div class="ui-form-explain">'+b.errMsg+"</div>").appendTo(d):e.html(b.errMsg),c.attr("data-explain","")});var b=null;b=$("#"+a[0].errName).length>0?$("#"+a[0].errName,form):$("[name='"+a[0].errName+"']",form);var c=b.parents(".ui-form-item")&&b.parents(".ui-form-item").offset().top;$(document).scrollTop(c)},resetValidatorError:function(a){var a=a?a:"";$(a+" .ui-form-item").removeClass("ui-form-item-error"),$(a+" .ui-form-explain").html("")},trimLongString:function(a,b,c){var d="",e=c||"...";return"string"==$.type(a)&&(d=a),b>0&&b<d.length&&(d=d.slice(0,b)+e),d},createFormHiddenFn:function(a){for(var b="",c=a.str.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");b+='<input type="hidden" name="'+e[0]+'" value="'+decodeURIComponent(e[1])+'" />'}a.editor&&(b+='<textarea name="'+a.editor.name+'">'+$(a.editor.selector).val()+"</textarea>"),$(a.form).html(b)},getCharLength:function(a){if("string"==$.type(a)){var a=a.replace(/[^\x00-\xff]/g,"**");return a.length}return a},getImageDomainPath:function(a,b,c){var d=a.split("."),e=d[d.length-1];return b&&c?a+"_"+parseInt(b)+"x"+parseInt(c)+"."+e:a},placeholder:function(a){var b="placeholder"in document.createElement("input");if(!b){var c=$(a);if(!c.is(":hidden")){var d="text"==c.attr("type")||"textarea"==c.prop("tagName").toLowerCase(),e=c.attr("placeholder"),f=c.val();if(d&&e){var g=c.css("padding-left");if(!c.data("label")){var h=$("<label>"+e+"</label>");h.css({position:"absolute",left:c.offset().left+parseInt(g),top:c.offset().top,width:c.outerWidth(),height:c.outerHeight(),color:"#999",display:"none",cursor:"text"}),h.on("click",function(){$(this).hide(),$(a).focus()}),"text"==c.attr("type")&&h.css({"line-height":c.outerHeight()+"px"}),h.appendTo($("body")),c.data("label",h)}""==f&&$(a).data("label").show(),c.focus(function(){$(a).data("label").hide()}),c.blur(function(){""===c.val()&&$(a).data("label").show()})}}}},isAmount:function(a){return/^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/.test(a)},previewPic:function(a){var b="";if(window.navigator.userAgent.indexOf("MSIE")>=1){a.obj.select();var c=document.selection.createRange().text;b="<img src="+c+" />",$(a.previewBox).html(b)}else{if("undefined"==typeof FileReader)return alert("监测到您的浏览器不支持FileReader对象!"),void 0;var d=new FileReader;d.readAsDataURL(a.f[0]),d.onload=function(c){b="<img src="+c.target.result+" />",$(a.previewBox).html(b)}}}};c.exports=g});
